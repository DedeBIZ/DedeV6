<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('freelist_edit');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    function ChangeListStyle() {
      var itxt = document.getElementById("myinnertext");
      var myems = document.getElementsByName("liststyle");
      if (myems[0].checked) itxt.value = document.getElementById("list1").innerHTML;
      else if (myems[1].checked) itxt.value = document.getElementById("list2").innerHTML;
      else if (myems[2].checked) itxt.value = document.getElementById("list3").innerHTML;
      else if (myems[3].checked) itxt.value = document.getElementById("list4").innerHTML;
      itxt.value = itxt.value.replace("<br>", "<br>");
      itxt.value = itxt.value.toLowerCase();
    }
    function ShowHide(objname) {
      var obj = document.getElementById(objname);
      if (obj.style.display == "block" || obj.style.display == "")
        obj.style.display = "none";
      else
        obj.style.display = "block";
    }
    function SelectTemplets(fname) {
      var pos = GetWinPos(800,600);
      window.open("./dialog/select_templets.php?&activepath=<?php echo urlencode($cfg_templets_dir)?>&f=" + fname, "poptempWin", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
    }
    function CheckSubmit() {
      if (document.form1.title.value == "") {
        ShowMsg("<?php echo Lang('freelist_err_title_isempty');?>");
        document.form1.title.focus();
        return false;
      }
      return true;
    }
  </script>
  <link rel="stylesheet" href="css/codemirror.css">
  <script src="js/codemirror.js"></script>
  <script src="js/mode/xml/xml.js"></script>
  <script src="js/mode/javascript/javascript.js"></script>
  <script src="js/mode/css/css.js"></script>
  <script src="js/mode/htmlmixed/htmlmixed.js"></script>
</head>
<body>
  <center>
    <table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
      <form action="freelist_edit.php" method="post" name="form1" onSubmit="return CheckSubmit();">
        <input type="hidden" name="dopost" value="save">
        <input type="hidden" name="aid" value="<?php echo $row['aid']?>">
        <tr>
          <td bgcolor="#f8f8f8">
            <table width="98%" cellpadding="0" cellspacing="0" class="table-borderless">
              <tr>
                <td width="30%"><a href="freelist_main.php"><?php echo Lang('freelist_main');?></a> &gt; <?php echo Lang('freelist_edit');?></td>
                <td width="70%" align="right"></td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td class="p-0">
            <table width="100%" align="right" cellpadding="0" cellspacing="1" class="table-borderless">
              <tr>
                <td class="p-0">
                  <table width="100%" cellspacing="1" cellpadding="0">
                    <tr>
                      <td colspan="2"><i class="fa fa-question-circle" title="<?php echo Lang('help');?>"></i> <?php echo Lang('freelist_tip');?></td>
                    </tr>
                    <tr>
                      <td width="260"><?php echo Lang('title');?>：</td>
                      <td><input type="text" name="title" id="title" value="<?php echo $row['title']?>" style="width:260px"></td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('freelist_listdir');?>：</td>
                      <td><input type="text" name="listdir" id="listdir" value="<?php echo $row['listdir']?>" style="width:260px"><?php echo Lang('freelist_listdir_tip');?></td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('freelist_defaultpage');?>：</td>
                      <td>
                        <input type="text" name="defaultpage" id="defaultpage" value="<?php echo $row['defaultpage']?>" style="width:260px">
                        <label><input type="checkbox" name="nodefault" id="nodefault" value="1" <?php if ($row['nodefault']==1) echo "checked";?>> <?php echo Lang('freelist_defaultpage_tip');?></label>
                      </td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('freelist_namerule');?>：</td>
                      <td><input type="text" name="namerule" id="namerule" value="<?php echo $row['namerule']?>" style="width:260px"></td>
                    </tr>
                    <tr>
                      <td height="36"><?php echo Lang('template');?>：</td>
                      <td>
                        <input type="text" name="templet" id="templet" value="<?php echo $row['templet']?>" style="width:260px">
                        <button type="button" name="set4" onClick="SelectTemplets('form1.templet');" class="btn btn-success btn-sm"><?php echo Lang('browser');?></button>
                      </td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('freelist_maxpage');?>：</td>
                      <td><input type="text" name="maxpage" id="maxpage" value="<?php echo $row['maxpage'];?>" style="width:60px"></td>
                    </tr>
                    <tr>
                      <td></td>
                      <td><?php echo Lang('freelist_maxpage_tip');?></td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('keywords');?>：</td>
                      <td><input type="text" name="keywords" id="keywords" value="<?php echo $row['keywords'];?>" style="width:260px"></td>
                    </tr>
                    <tr>
                      <td><?php echo Lang('description');?>：</td>
                      <td><textarea name="description" id="description" style="width:360px;height:50px"><?php echo $row['description']?></textarea></td>
                    </tr>
                  </table>
                </td>
              </tr>
              <tr>
                <td bgcolor="#f8fcf2"><?php echo Lang('freelist_style_tip');?></td>
              </tr>
              <tr>
                <td><?php echo Lang('typeid');?>：
                  <?php
                  $typeid = $ctag->GetAtt('typeid');
                  echo "<select name='typeid' style='width:160px'>";
                  echo "<option value='0'>".Lang('unlimited')."</option>";
                  $dsql->SetQuery("Select id,typename, channeltype From #@__arctype");
                  $dsql->Execute();
                  while($lrow = $dsql->GetObject()){
                    $disable = '';
               	    if ($lrow->channeltype < -1)
               	    {
               		    $disable = 'disabled';
                  	}
               	    if ($lrow->id==$typeid) echo "<option value='{$lrow->id}' selected $disable>{$lrow->typename}</option>";
               	    else echo "<option value='{$lrow->id}' $disable>{$lrow->typename}</option>";
                  }
                  echo "</select>";
		              ?>
                </td>
              </tr>
              <tr>
                <td><?php echo Lang('channel');?>：
                  <?php
                  $channel  = $ctag->GetAtt('channel');
                  echo "<select name='channel' style='width:160px'><option value='0'>".Lang('unlimited')."</option>";
                  $dsql->SetQuery("Select id,typename From #@__channeltype where id>0");
                  $dsql->Execute();
                  while($nrow = $dsql->GetObject())
                  {
                  	if ($nrow->id==$channel) echo "<option value='{$nrow->id}' selected>{$nrow->typename}</option>";
                  	else echo "<option value='{$nrow->id}'>{$nrow->typename}</option>";
                  }
                  echo "</select>";
                  ?><?php echo Lang('freelist_channel_tip');?>
                </td>
              </tr>
              <tr>
                <td><?php echo Lang('freelist_att');?>：
                  <?php
                  $att  = $ctag->GetAtt('att');
                  echo "<select name='att' style='width:160px'>";
                  echo "<option value='0'>".Lang('unlimited')."</option>";
                  $dsql->SetQuery("Select * From #@__arcatt");
                  $dsql->Execute();
                  while($nrow = $dsql->GetObject())
                  {
                  	if ($att==$nrow->att)
                  	{
                  		echo "<option value='{$nrow->att}' selected>{$nrow->attname}</option>";
                  	} else {
                  		echo "<option value='{$nrow->att}'>{$nrow->attname}</option>";
                  	}
                  }
                  echo "</select>";
		              ?>
                  <?php echo Lang('subday');?>：<input type="text" name="subday" id="subday" size="6" value="<?php echo $ctag->GetAtt('subday')?>"> <?php echo Lang('freelist_subday_tip');?>
                </td>
              </tr>
              <tr>
                <td>
                  <?php echo Lang('freelist_pagesize');?>：<input type="text" name="pagesize" id="pagesize" value="<?php echo $ctag->GetAtt('pagesize')?>" size="4">
                  <?php echo Lang('freelist_col');?>：<input type="text" name="col" id="col" value="<?php  $col = $ctag->GetAtt('col'); $v = ( empty($col) ? '1' :  $col ); echo $v;?>" size="4">
                  <?php echo Lang('freelist_titlelen');?>：<input type="text" name="titlelen" id="titlelen" value="<?php echo $ctag->GetAtt('titlelen')?>" size="4"><?php echo Lang('freelist_titlelen_tip');?>
                </td>
              </tr>
              <tr>
                <td>
                  <?php
                	$setype = $ctag->GetAtt('type');
                	if ($setype=='') $setype = 'X';
                	?>
                  <?php echo Lang('advanced_filtering');?>：
                  <label><input type="checkbox" name="types[]" id="type1" value="image" <?php if (preg_match("#image#i",$setype)) echo ' checked';?>> <?php echo Lang('freelist_advfiltering_image');?></label>
                  <label><input type="checkbox" name="types[]" id="type2" value="commend" <?php if (preg_match("#commend#i", $setype)) echo ' checked';?>> <?php echo Lang('freelist_advfiltering_commend');?></label>
                  <label><input type="checkbox" name="types[]" id="type3" value="spec" class="inputbut" <?php if (preg_match("#spec#i", $setype)) echo ' checked';?>> <?php echo Lang('freelist_advfiltering_spec');?></label>
                  <?php echo Lang('keywords');?>：<input type="text" name="keywordarc" id="keywordarc" value="<?php echo $ctag->GetAtt('keyword')?>"><?php echo Lang('freelist_keywords_tip');?>
                </td>
              </tr>
              <tr>
                <td><?php echo Lang('sortrank');?>：
                  <?php
                  $orderby = $ctag->GetAtt('orderby');
                  $sorta = "sortrank,置顶权限值;pubdate,发布时间;senddate,录入时间;click,点击量;id,文档id,lastpost,最后评论时间;postnum,评论总数;rand,随机获取";
                  $sortas = explode(';',$sorta);
                  foreach($sortas as $v)
                  {
                  	$vs = explode(',',$v);
                  	$vs[0] = trim($vs[0]);
                  	$sortarrs[$vs[0]] = $vs[1];
                  }
                  ?>
                  <select name="orderby" id="orderby" style="width:160px">
                    <?php
                  	echo "<option value=\"$orderby\" selected>{$sortarrs[$orderby]}</option>";
                  	?>
                    <option value="sortrank"><?php echo Lang('freelist_orderby_sortrank');?></option>
                    <option value="pubdate"><?php echo Lang('freelist_orderby_pubdate');?></option>
                    <option value="senddate"><?php echo Lang('freelist_orderby_senddate');?></option>
                    <option value="click"><?php echo Lang('freelist_orderby_click');?></option>
                    <option value="id"><?php echo Lang('freelist_orderby_id');?></option>
                    <option value="lastpost"><?php echo Lang('freelist_orderby_lastpost');?></option>
                    <option value="postnum"><?php echo Lang('freelist_orderby_postnum');?></option>
                  </select>
                  <label><input type="radio" name="order" value="desc" <?php if ($ctag->GetAtt('orderway')=='desc') echo "checked";?>> <?php echo Lang('freelist_orderby_desc');?></label>
                  <label><input type="radio" name="order" value="asc" <?php if ($ctag->GetAtt('orderway')=='asc') echo "checked";?>> <?php echo Lang('freelist_orderby_asc');?></label>
                </td>
              </tr>
              <tr>
                <td><?php echo Lang('freelist_innervar');?>：[<a href='javascript:ShowHide("innervar");'><i class="fa fa-question-circle" title="<?php echo Lang('help');?>"></i> <?php echo Lang('freelist_innervar_tip');?></a>]</td>
              </tr>
              <tr>
                <td><textarea name="innertext" cols="80" rows="6" id="myinnertext" style="width:80%;height:120px"><?php echo $ctag->GetInnerText()?></textarea></td>
              </tr>
              <tr>
                <td id="innervar" style="display:none">
                  <span><i class="fa fa-question-circle" title="<?php echo Lang('help');?>"></i> <?php echo Lang('freelist_innervar_tip_detail');?></span>
                </td>
              </tr>
              <tr>
                <td align="center" class="py-2"><button name="Submit2" type="submit" id="Submit2" class="btn btn-success btn-sm"><?php echo Lang('save');?></button></td>
              </tr>
            </table>
          </td>
        </tr>
      </form>
    </table>
  </center>
  <script>
    var editor = CodeMirror.fromTextArea(document.getElementById('myinnertext'), {
      lineNumbers: true,
      lineWrapping: true,
      mode: 'text/html'
    });
  </script>
</body>
</html>