<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('diy_edit');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/diy.js"></script>
  <style>
    .style1 {
      color: #dc3545
    }
    .style2 {
      color: #545b62;
      display: none;
    }
  </style>
  <script>
    function checkSubmit() {
      if (document.form1.typename.value == '') {
        ShowMsg("<?php echo Lang('diy_err_name_isempty');?>");
        return false;
      }
      return true;
    }
    //删除
    function DelNote(gourl) {
      if (!window.confirm("<?php echo Lang('diy_delete_confirm');?>")) { return false; }
      location.href = gourl;
    }
  </script>
</head>
<body>
  <table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
    <form name="form1" action="diy_edit.php" method="post" onSubmit="return checkSubmit();">
      <input type="hidden" name="diyid" value="<?php echo $diyid;?>">
      <input type="hidden" name="dopost" value="save">
      <tr>
        <td bgcolor="#f8f8f8" colspan="2"><a href="diy_main.php"><?php echo Lang('diy_main');?></a> &gt; <?php echo Lang('diy_edit');?></td>
      </tr>
      <tr>
        <td width="260">diyid：<span class="style2" id="help1"><?php echo Lang('diy_diyid_tip');?></span></td>
        <td>
          <?php echo $diyid;?>
          <i class="fa fa-question-circle" title="<?php echo Lang('help');?>" onClick="showHide2('help1')" style="cursor:hand"></i>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('diy_name2');?><br>
          <span class="style2" id="help3"><?php echo Lang('diy_name_tip');?></span></td>
        <td>
          <input type="text" name="name" id="name" value="<?php echo $row['name']?>" style="width:160px"> * <i class="fa fa-question-circle" title="<?php echo Lang('help');?>" onClick="showHide2('help3')" style="cursor:hand"></i>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('diy_table');?>：<br>
          <span class="style2" id="help5"><?php echo Lang('diy_table_tip');?></span></td>
        <td>
          <input type="text" name="table" id="table" value="<?php echo $row['table'];?>" disabled="1" style="width:160px"> * <i class="fa fa-question-circle" title="<?php echo Lang('help');?>" onClick="showHide2('help5')" style="cursor:hand"></i>
        </td>
      </tr>
      <tr>
        <td bgcolor="#f8f8f8"><?php echo Lang('diy_field_config');?>：<?php echo Lang('diy_field_config_tip');?></td>
        <td bgcolor="#f8f8f8">
          <button type="button" name="fset" id="fset" onClick="location.href='diy_field_add.php?diyid=<?php echo $diyid;?>'" class="btn btn-success btn-sm"
           ><?php echo Lang('diy_add_field');?></button>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <table width="100%" align="center" cellpadding="1" cellspacing="1">
            <tr  align="center" bgcolor="#f8fcf2">
              <td width="28%"><?php echo Lang('diy_itemname');?></td>
              <td width="18%"><?php echo Lang('diy_fieldname');?></td>
              <td width="20%"><?php echo Lang('diy_fieldtype');?></td>
              <td width="18%"><?php echo Lang('diy_formtype');?></td>
              <td><?php echo Lang('operation');?></td>
            </tr>
            <?php 
            $ds = file(DedeInclude('/inc/fieldtype.txt'));
            foreach($ds as $d){
            	$dds = explode(',',trim($d));
            	$fieldtypes[$dds[0]] = $dds[1];
            }
            $fieldset = stripslashes($row['info']);
            $dtp = new DedeBIZ\Template\DedeTagParse();
            $dtp->SetNameSpace("field","<",">");
            $dtp->LoadSource($fieldset);
            if (is_array($dtp->CTags)){
            foreach($dtp->CTags as $ctag)
            {
            ?>
            <tr align="center">
              <td>
                <?php 
          			$itname = $ctag->GetAtt('itemname');
          			if ($itname=='') echo "没指定";
          			else echo $itname;
          			?>
              </td>
              <td><?php echo $ctag->GetTagName()?></td>
              <td>
                <?php 
          			$ft = $ctag->GetAtt('type');
          			if (isset($fieldtypes[$ft])) echo $fieldtypes[$ft];
          			else  echo "系统专用类型";
          			?>
              </td>
              <td>
                <?php 
          			$ft = $ctag->GetAtt('autofield');
          			if ($ft==''||$ft==0) echo "固化表单";
          			else  echo "自动表单";
          		 ?>
              </td>
              <td>
                <a href="diy_field_edit.php?diyid=<?php echo $diyid;?>&fname=<?php echo $ctag->GetTagName()?>" class="btn btn-success btn-sm"><i class="fa fa-code"></i> <?php echo Lang('edit');?></a>
                <a href="diy_field_edit.php?diyid=<?php echo $diyid;?>&action=delete&fname=<?php echo $ctag->GetTagName()?>" class="btn btn-success btn-sm"><i class="fa fa-globe"></i> <?php echo Lang('delete');?></a>
              </td>
            </tr>
            <?php }}?>
          </table>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('templist');?>：</td>
        <td><input type="text" name="listtemplate" id="listtemplate" style="width:160px" value="<?php echo $row['listtemplate'];?>"></td>
      </tr>
      <tr>
        <td><?php echo Lang('temparticle');?>：</td>
        <td><input type="text" name="viewtemplate" id="viewtemplate" style="width:160px" value="<?php echo $row['viewtemplate'];?>"></td>
      </tr>
      <tr>
        <td><?php echo Lang('posttemplate');?>：</td>
        <td><input type="text" name="posttemplate" id="posttemplate" style="width:160px" value="<?php echo $row['posttemplate'];?>"></td>
      </tr>
      <tr>
        <td><?php echo Lang('diy_public');?>：</td>
        <td>
          <label><input type="radio" name="public" value="2" <?php echo $row['public'] == 2 ? 'checked' : '';?>> <?php echo Lang('diy_public_2');?></label>
          <label><input type="radio" name="public" value="1" <?php echo $row['public'] == 1 ? 'checked' : '';?>> <?php echo Lang('diy_public_1');?></label>
          <label><input type="radio" name="public" value="0" <?php echo $row['public'] == 0 ? 'checked' : '';?>> <?php echo Lang('diy_public_0');?></label>
        </td>
      </tr>
      <tr>
        <td align="center" colspan="2" bgcolor="#f8f8f8" class="py-2">
          <button type="submit" name="button" id="button" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
          <button type="button" class="btn btn-success btn-sm" id="button2" onclick="location='diy_main.php';"><?php echo Lang('back');?></button>
        </td>
      </tr>
    </form>
  </table>
</body>
</html>