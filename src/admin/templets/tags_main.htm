<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title><?php echo Lang('tags_main');?></title>
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/admin.min.css">
		<?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
		<script src="../static/web/js/jquery.min.js"></script>
		<script src="../static/web/js/bootstrap.bundle.min.js"></script>
		<script src="../static/web/js/style.js"></script>
		<style>
			.col-form-label {
				padding-top: 0
			}
		</style>
		<script>
			function checkall(form, prefix, checkall) {
				var checkall = checkall ? checkall : 'all';
				for (var i = 0; i < form.elements.length; i++) {
					var e = form.elements[i];
					if (e.name && e.name != checkall && (!prefix || (prefix && e.name.match(prefix)))) {
						e.checked = form.elements[checkall].checked;
					}
				}
			}
			function UpdateOne(tid) {
				location = "tags_main.php?action=update&count=" + document.getElementById('count' + tid).value + "&tid=" + tid;
			}
			function DeleteOne(tid) {
				location = "tags_main.php?action=delete&ids=" + tid;
			}
			function UpdateKwDes(tid, tag) {
				$.get("tags_main.php?action=get_one&tid=" + tid, function(data) {
					let rs = JSON.parse(data);
					let title = rs.title ? rs.title : "";
					let keywords = rs.keywords ? rs.keywords : "";
					let description = rs.description ? rs.description : "";
					ShowMsg(`
				<div class="form-group row">
					<label for="iptTitle" class="col-sm-3 col-form-label"><?php echo Lang('tag');?></label>
					<div class="col-sm-9"><input type="text" name="title" class="form-control" disabled value="${tag}"></div>
				</div>
				<div class="form-group row">
					<label for="iptKw" class="col-sm-3 col-form-label"><?php echo Lang('title');?></label>
					<div class="col-sm-9"><input type="text" name="title" id="iptTitle" class="form-control" placeholder="例如：DedeBIZ商业组件" value="${title}"></div>
				</div>
				<div class="form-group row">
					<label for="iptKw" class="col-sm-3 col-form-label"><?php echo Lang('keywords');?></label>
					<div class="col-sm-9"><input type="text" name="kw" id="iptKw" class="form-control" placeholder="例如：DedeBIZ Dede商业" value="${keywords}"></div>
				</div>
				<div class="form-group row">
					<label for="iptDes" class="col-sm-3 col-form-label"><?php echo Lang('description');?></label>
					<div class="col-sm-9"><textarea id="iptDes" name="des" class="form-control" placeholder="<?php echo Lang('tags_main_description_tip');?>">${description}</textarea></div>
				</div>
				`, {
						footer: `<button type="button" class="btn btn-outline-success btn-sm" onclick="UpdateKwDesDo(${tid}, '~modalID~')"><?php echo Lang('setting');?></button>`,
					});
				})
			}
			function UpdateKwDesDo(tid, mdlID) {
				let title = $("#iptTitle").val();
				let kw = $("#iptKw").val();
				let des = $("#iptDes").val();
				$.post("tags_main.php?action=set_one", {
					tid: tid,
					title: title,
					kw: kw,
					des: des,
				}, function(data) {
					let rs = JSON.parse(data);
					if (rs.code === 200) {
						location.reload();
					}

				})
			}
		</script>
	</head>
	<body>
		<div class="main">
			<table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
				<tr>
					<td colspan="8" bgcolor="#f8f8f8">
						<table width="100%" align="center" cellpadding="0" cellspacing="0" class="table-borderless">
							<tr>
								<td align="left"><?php echo Lang('tags_main');?></td>
								<td align="right">
									<form name="form1" action="tags_main.php?action=fetch" method="post" style="display:inline-block">
										<input type="text" name="startaid" placeholder="<?php echo Lang('start_id');?>">
										<input type="text" name="endaid" placeholder="<?php echo Lang('end_id');?>">
										<button name="submit" type="submit" class="btn btn-success btn-sm"><?php echo Lang('tags_fetch');?></button>
										<small><?php echo Lang('tags_fetch_tip');?></small>
									</form>
									<form name="form2" action="tags_main.php" style="display:inline-block">
										<input type="text" name="tag" value="<?php echo $tag;?>" placeholder="<?php echo Lang('input_keywords_tip');?>" style="width:160px">
										<button type="submit" name="sb" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
										<a href="makehtml_taglist.php" name="sb" class="btn btn-success btn-sm"><?php echo Lang('make');?></a>
									</form>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr align="center" bgcolor="#f8fcf2">
					<td width="8%"><?php echo Lang('select');?></td>
					<td width="5%">id</td>
					<td width="30%"><?php echo Lang('tag');?></td>
					<td width="10%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=count&orderway=<?php echo $neworderway;?>"><?php echo Lang('click');?></a></td>
					<td width="10%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=total&orderway=<?php echo $neworderway;?>"><?php echo Lang('number_of_documents');?></a></td>
					<td width="10%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=addtime&orderway=<?php echo $neworderway;?>"><?php echo Lang('addtime');?></a></td>
					<td width="10%"><?php echo Lang('uptime');?></td>
					<td width="22%"><?php echo Lang('operation');?></td>
				</tr>
				<form name="form3" action="tags_main.php?action=delete" method="post">
					{dede:datalist empty='<tr><td colspan="8"><center>~lang:none_result~</center></td></tr>'}
					<?php
					$fields['addtime'] = GetDateMk($fields['addtime']);
					$fields['uptime'] = GetDateMk($fields['uptime']);
					$fields['tag'] = dede_htmlspecialchars($fields['tag']);
					?>
					<tr align="center" onmousemove="javascript:this.bgColor='#f8fcf2';" onmouseout="javascript:this.bgColor='#ffffff';">
						<td><input type="checkbox" name="ids[]" value="<?php echo $fields['id'];?>"></td>
						<td>{dede:field.id/}</td>
						<td><a href="../apps/tags.php?/<?php echo $fields['id'];?>/" target="_blank">{dede:field.tag/}</a></td>
						<td><input type="text" value="<?php echo $fields['count'];?>" id="count<?php echo $fields['id'];?>" size='5'></td>
						<td><?php echo $fields['total'];?></td>
						<td><?php echo $fields['addtime'];?></td>
						<td><?php echo $fields['uptime'];?></td>
						<td>
							<a href='javascript:UpdateKwDes(<?php echo $fields['id'];?>,"<?php echo $fields['tag'];?>");' class="btn btn-success btn-sm"><?php echo Lang('setting');?></a>
							<a href="javascript:UpdateOne(<?php echo $fields['id'];?>);" class="btn btn-success btn-sm"><?php echo Lang('update');?></a>
							<a href="makehtml_taglist.php?tagid=<?php echo $fields['id'];?>" class="btn btn-success btn-sm"><?php echo Lang('make');?></a>
							<a href="javascript:DeleteOne(<?php echo $fields['id'];?>);" class="btn btn-success btn-sm"><?php echo Lang('delete');?></a>
						</td>
					</tr>
					{/dede:datalist}
					<tr>
						<td align="center" class="py-2">
							<label><input type="checkbox" onclick="checkall(this.form,'ids')" name="all"> <?php echo Lang('select_all');?></label>
							<button type="button" onclick="document.form3.submit()" class="btn btn-danger btn-sm"><?php echo Lang('delete');?></button>
						</td>
						<td align="center" colspan="7">{dede:pagelist/}</td>
					</tr>
				</form>
			</table>
		</div>
	</body>
</html>