<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=<?php echo $cfg_soft_lang; ?>">
	<title>标签管理</title>
	<script src="../static/js/jquery.js" language="javascript" type="text/javascript"></script>
	<script src="/static/js/bootstrap.bundle.js"></script>
	<link rel="stylesheet" href="../static/css/bootstrap.min.css">
	<script src="../static/js/style.js"></script>
	<link href="../static/font-awesome/css/font-awesome.min.css" rel="stylesheet">
	<link href="css/base.css" rel="stylesheet" type="text/css" />
	<style>
		.col-form-label {
			padding-top: 0;
		}
	</style>
	<script language="javascript">
		function checkall(form, prefix, checkall) {
			var checkall = checkall ? checkall : 'all';
			for (var i = 0; i < form.elements.length; i++) {
				var e = form.elements[i];
				if (e.name && e.name != checkall && (!prefix || (prefix && e.name.match(prefix)))) {
					e.checked = form.elements[checkall].checked;
				}
			}
		}
		function UpdateOne(tid) {
			location = "tags_main.php?action=update&count=" + document.getElementById('count' + tid).value + "&tid=" + tid;
		}
		function DeleteOne(tid) {
			location = "tags_main.php?action=delete&ids=" + tid;
		}
		function UpdateKwDes(tid, tag) {
			$.get("tags_main.php?action=get_one&tid=" + tid, function (data) {
				let rs = JSON.parse(data);
				let title = rs.title ? rs.title : "";
				let keywords = rs.keywords ? rs.keywords : "";
				let description = rs.description ? rs.description : "";
				ShowMsg(`
				<div class="form-group row">
					<label for="iptTitle" class="col-sm-3 col-form-label">标签</label>
					<div class="col-sm-9">
					<input name="title" type="text" class="form-control" disabled
					value="${tag}">
					</div>
				</div>
				<div class="form-group row">
					<label for="iptKw" class="col-sm-3 col-form-label">标题</label>
					<div class="col-sm-9">
					<input name="title" type="text" class="form-control" id="iptTitle"
					placeholder="例如：DedeBIZ织梦商业组件" value="${title}">
					</div>
				</div>
				<div class="form-group row">
					<label for="iptKw" class="col-sm-3 col-form-label">关键词</label>
					<div class="col-sm-9">
					<input name="kw" type="text" class="form-control" id="iptKw"
					placeholder="例如：DedeBIZ 织梦 Dede商业" value="${keywords}">
					</div>
				</div>
				<div class="form-group row">
					<label for="iptDes" class="col-sm-3 col-form-label">描述</label>
					<div class="col-sm-9">
					<textarea id="iptDes" name="des" class="form-control" row=3
					placeholder="例如：国内流行的内容管理系统（CMS）多端全媒体解决方案">${description}</textarea>
					</div>
				</div>
				`, {
					footer: `<button type="button" class="btn btn-outline-success" onclick="UpdateKwDesDo(${tid}, '~modalID~')">设置</button>`,
				});
			})
		}
		function UpdateKwDesDo(tid, mdlID) {
			let title = $("#iptTitle").val();
			let kw = $("#iptKw").val();
			let des = $("#iptDes").val();
			$.post("tags_main.php?action=set_one", {
				tid: tid,
				title: title,
				kw: kw,
				des: des,
			}, function (data) {
				let rs = JSON.parse(data);
				if (rs.code === 200) {
					location.reload();
				}

			})
		}
	</script>
</head>
<body>
	<div class="bodytitle mt-3">
		<div class="bodytitleleft"></div>
		<div class="bodytitletxt" style="padding-left:10px"><a href="tags_main.php">标签管理</a></div>
	</div>
	<div class="main">
		<form name='form1' action="tags_main.php?action=fetch" method="post" style="margin-bottom:10px">
			<table width="98%" border="0" cellspacing="1" align="center" class="table maintable" style="background:#CFCFCF;">
				<tr>
					<td height="26" align="left" bgcolor="#F0FBBD" background="images/wbg.gif" style="padding-left:10px"><strong>提取Tag</strong></td>
				</tr>
				<tr>
					<td height="30" align="center" bgcolor="#Ffffff">
						开始id:
						<input type="text" name="startaid" />
						结束id:
						<input type="text" name="endaid" />
						&nbsp;
						<button name="submit" type="submit" class="btn btn-success">获取标签</button>
						<small>（tag以文档关键词为准）</small>
					</td>
				</tr>
			</table>
		</form>
		<table width="98%" border="0" cellpadding="1" cellspacing="1" align="center"
			class="table maintable table-bordered" style="background:#CFCFCF;">
			<tr>
				<td height="26" colspan="7" bgcolor="#F0F0F0">
					<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table-borderless">
						<tr>
							<td align="left" style="padding-left:10px"><strong>标签维护</strong></td>
							<form name='form2' action="tags_main.php">
								<td width="40%" align="right">
									搜索：
									<input type='text' name='tag' size='10' value="<?php echo $tag;?>">
									<button type='submit' name='sb' class="btn btn-success btn-sm">确定</button>
									&nbsp; <a href="makehtml_taglist.php" name='sb' class="btn btn-success btn-sm">更新标签</a>
								</td>
							</form>
						</tr>
					</table>
				</td>
			</tr>
			<tr align="center" bgcolor="#FBFCE2" height="26">
				<td width="5%">删</td>
				<td width="20%">标签</td>
				<td width="10%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=count&orderway=<?php echo $neworderway;?>">点击</a>
				</td>
				<td width="10%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=total&orderway=<?php echo $neworderway;?>">文档数</a>
				</td>
				<td width="15%"><a href="tags_main.php?tag=<?php echo $tag;?>&orderby=addtime&orderway=<?php echo $neworderway;?>">添加时间</a>
				</td>
				<td width="15%">更新时间</td>
				<td width="20%">操作</td>
			</tr>
			<form name='form3' action="tags_main.php?action=delete" method="post">
				{dede:datalist}
				<?php
	$fields['addtime'] = GetDateMk($fields['addtime']);
	$fields['uptime'] = GetDateMk($fields['uptime']);
	$fields['tag'] = dede_htmlspecialchars($fields['tag']);
?>
				<tr align="center" bgcolor="#FFFFFF" onMouseMove="javascript:this.bgColor='#FCFDEE';"
					onMouseOut="javascript:this.bgColor='#FFFFFF';">
					<td height="26">
						<input type="checkbox" name="ids[]" value="<?php echo $fields['id']; ?>" class='np' />
					</td>
					<td>
						<a href="../apps/tags.php?/<?php echo urlencode($fields['tag']); ?>/" target="_blank">{dede:field.tag/}</a>
					</td>
					<td>
						<input type="text" value="<?php echo $fields['count']; ?>" id="count<?php echo $fields['id']; ?>" size='5' />
					</td>
					<td>
						<?php echo $fields['total']; ?>
					</td>
					<td>
						<?php echo $fields['addtime']; ?>
					</td>
					<td>
						<?php echo $fields['uptime']; ?>
					</td>
					<td>
						<a href='javascript:UpdateKwDes(<?php echo $fields['id']; ?>, "<?php echo $fields['tag']; ?>");' class="btn btn-success btn-sm">关键词描述</a>
						<a href='javascript:UpdateOne(<?php echo $fields['id']; ?>);' class="btn btn-success btn-sm">更新</a>
						<a href='makehtml_taglist.php?tid=<?php echo $fields['id'];?>' class="btn btn-success btn-sm">生成HTML</a>
						<a href='javascript:DeleteOne(<?php echo $fields['id']; ?>);' class="btn btn-success btn-sm">删</a>
					</td>
				</tr>
				{/dede:datalist}
				<tr bgcolor="#F0FBBD">
					<td align="center" bgcolor="#F8FEE0" height="26">
						<label>
							<input type="checkbox" onclick="checkall(this.form, 'ids')" name="all" class="np" />
							<br>全选
						</label>
					</td>
					<td height="26" colspan="7" align="center" bgcolor="#F8FEE0">
						{dede:pagelist /}
					</td>
				</tr>
			</form>
			<tr align="center" bgcolor="#FAFDF0">
				<td height="36" colspan="8">
					<button type='button' onclick="document.form3.submit()" class="btn btn-success">删除所选</button>
				</td>
			</tr>
		</table>
	</div>
</body>
</html>