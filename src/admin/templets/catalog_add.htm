<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('catalog_main');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="js/main.js"></script>
  <script>
  var channelArray = new Array();
  <?php
  $i = 0;
  foreach($channelArray as $k=> $arr)
    {
      echo "channelArray[$k] = \"{$arr['nid']}\";";
    }
  ?>
  function Nav() {
    if (window.navigator.userAgent.indexOf("MSIE") >= 1) return 'IE';
    else if (window.navigator.userAgent.indexOf("Firefox") >= 1) return 'FF';
    else return "OT";
  }
  function SelectTemplets(fname) {
    var pos = GetWinPos(800,600);
    window.open("./dialog/select_templets.php?f=" + fname, "poptempWin", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
  }
  function ShowHide(objname) {
    var obj = document.getElementById(objname);
    if (obj.style.display != "none")
    obj.style.display = "none";
    else {
      if (Nav() == 'IE') obj.style.display = "block";
      else obj.style.display = "table-row";
    }
  }
  function ShowObj(objname) {
    var obj = document.getElementById(objname);
    if (Nav() == 'IE') obj.style.display = "block";
    else obj.style.display = "table";
  }
  function HideObj(objname) {
    var obj = document.getElementById(objname);
    obj.style.display = "none";
  }
  function ShowItem1() {
    ShowObj('head1'); ShowObj('needset');
    HideObj('head2'); HideObj('adset');
    HideObj('head3'); HideObj('ctset');
  }
  function ShowItem2() {
    ShowObj('head2'); ShowObj('adset');
    HideObj('head1'); HideObj('needset');
    HideObj('head3'); HideObj('ctset');
  }
  function ShowItem3() {
    ShowObj('head3'); ShowObj('ctset');
    HideObj('head1'); HideObj('needset');
    HideObj('head2'); HideObj('adset');
  }
  function CheckTypeDir() {
    var upinyin = document.getElementById('upinyin');
    var tpobj = document.getElementById('typedir');
    if (upinyin.checked) tpobj.style.display = "none";
    else tpobj.style.display = "block";
  }
  function ParTemplet(obj) {
    var sevvalue = channelArray[obj.value];
    var tobj = document.getElementById('smclass');
    var tempindex = document.getElementsByName('tempindex');
    var templist = document.getElementsByName('templist');
    var temparticle = document.getElementsByName('temparticle');
    var dfstyle = document.getElementsByName('dfstyle');
    var dfstyleValue = dfstyle[0].value;
    tempindex[0].value = dfstyleValue + "/index_" + sevvalue + ".htm";
    templist[0].value = dfstyleValue + "/list_" + sevvalue + ".htm";
    temparticle[0].value = dfstyleValue + "/article_" + sevvalue + ".htm";
    if (obj.value < 0) {
      if (Nav() == 'IE') tobj.style.display = "block";
      else tobj.style.display = "table-row";
    } else {
      tobj.style.display = "none";
    }
  }
  function checkSubmit() {
    if (document.form1.typename.value == "") {
      alert("<?php echo Lang('catalog_typename_isempty');?>");
      document.form1.typename.focus();
      return false;
    }
    return true;
  }
  function CheckPathSet() {
    var surl = document.getElementById("siteurl");
    var sreid = document.getElementById("reid");
    var mysel = document.getElementById("truepath3");
    if (surl.value != "") {
      if (sreid.value == "0" || sreid.value == "") {
        mysel.checked = true;
      }
    }
  }
  function CheckCross() {
    var cross2 = document.getElementById('cross2');
    var crossid = document.getElementById('crossid');
    if (cross2.checked) crossid.style.display = 'block';
    else crossid.style.display = 'none';
  }
  </script>
</head>
<body>
  <table width="98%" align="center" cellpadding="0" cellspacing="0" class="mt-3 mb-3">
    <tr>
      <td>
        <table width="100%" cellspacing="0" cellpadding="0">
          <tr>
            <td><i class="fa fa-map-marker"></i> <a href="catalog_main.php"><?php echo Lang('catalog_main');?></a> &gt; <?php echo Lang('catalog_add');?></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <table width="98%" align="center" cellpadding="0" cellspacing="0" class="mb-3">
    <tr>
      <form name="form1" action="catalog_add.php" method="post" onSubmit="return checkSubmit()">
        <input type="hidden" name="dopost" value="save">
        <input type="hidden" name="reid" id="reid" value="<?php echo $id;?>">
        <input type="hidden" name="topid" id="topid" value="<?php echo $topid;?>">
        <?php
        if ($id>0)
        {
          echo " <input type='hidden' name='moresite' value='{$myrow['moresite']}'>";
          echo " <input type='hidden' name='siteurl' value='{$myrow['siteurl']}'>";
          echo " <input type='hidden' name='sitepath' value='{$myrow['sitepath']}'>";
        }
        ?>
        <td height="90" align="center" bgcolor="#fff">
          <table width="100%" cellspacing="0" id="head1" cellpadding="0">
            <tr>
              <td colspan="2" bgcolor="#fff" align="left">
                <table cellpadding="0" cellspacing="0">
                  <tr>
                    <td width="90" height="28" align="center" class="biz-itemnote1"><?php echo Lang('normal_options');?></td>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem2()"><?php echo Lang('advanced_options');?></a></td>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem3()"><?php echo Lang('catalog_content');?></a></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
          <table width="100%" cellspacing="0" id="head2" cellpadding="0" style="display:none">
            <tr>
              <td colspan="2" bgcolor="#fff" align="left">
                <table  cellpadding="0" cellspacing="0">
                  <tr>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem1()"><?php echo Lang('normal_options');?></a></td>
                    <td width="90" height="28" align="center" class="biz-itemnote1"><?php echo Lang('advanced_options');?></td>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem3()"><?php echo Lang('catalog_content');?></a></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
          <table width="100%" cellspacing="0" id="head3" cellpadding="0" style="display:none">
            <tr>
              <td colspan="2" bgcolor="#fff" align="left">
                <table  cellpadding="0" cellspacing="0">
                  <tr>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem1()"><?php echo Lang('normal_options');?></a></td>
                    <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem2()"><?php echo Lang('advanced_options');?></td>
                    <td width="90" height="28" align="center" class="biz-itemnote1"><?php echo Lang('catalog_content');?></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
          <table width="100%" id="needset" cellspacing="0" cellpadding="0" class="table biz-border">
            <tr>
              <td width="260" class="bline"><?php echo Lang('support_submission');?>：</td>
              <td class="bline">
                <label><input type="radio" name="issend" value="1" <?php if ($issend==1) echo " checked='checked' ";?>> <?php echo Lang('support');?></label>
                <label><input type="radio" name="issend" value="0" <?php if ($issend==0) echo " checked='checked' ";?>> <?php echo Lang('unsupport');?></label>
              </td>
            </tr>
            <tr>
              <td width="260" class="bline"><?php echo Lang('catalog_is_hidden');?>：</td>
              <td class="bline">
                <label><input type="radio" name="ishidden" value="0" checked="checked"> <?php echo Lang('show');?></label>
                <label><input type="radio" name="ishidden" value="1"> <?php echo Lang('hidden');?></label>
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('mychannel');?>：</td>
              <td class="bline">
                <select name="channeltype" id="channeltype" style="width:160px" onChange="ParTemplet(this)">
                  <?php
                  foreach($channelArray as $k=>$arr)
                  {
                    if ($k==$channelid) {
                      $nid = $arr['nid'];
                      echo " <option value='{$k}' selected>{$arr['typename']}|{$arr['nid']}</option>";
                    } else {
                      echo " <option value='{$k}'>{$arr['typename']}|{$arr['nid']}</option>";
                    }
                  }
                  ?>
                </select>
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_typename');?>：</td>
              <td class="bline"><input type="text" name="typename" style="width:260px"></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_cnoverview');?>：</td>
              <td class="bline"><input type="text" name="cnoverview" style="width:260px"></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_enname');?>：</td>
              <td class="bline"><input type="text" name="enname" style="width:260px"></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_enoverview');?>：</td>
              <td class="bline"><input type="text" name="enoverview" style="width:260px"></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_bigpic');?>：</td>
              <td>
                <input type="text" name="bigpic" style="width:260px">
                <input type="button" class="btn btn-success btn-sm" value="<?php echo Lang('browser');?>" onClick="SelectImage('form1.bigpic');">
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_litimg');?>：</td>
              <td>
                <input type="text" name="litimg" style="width:260px">
                <input type="button" class="btn btn-success btn-sm" value="<?php echo Lang('browser');?>" onClick="SelectImage('form1.litimg');">
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('sortrank');?>：</td>
              <td class="bline"><input type="text" name="sortrank" class="pubinputs" style="width:60px"><?php echo Lang('sortrank_msg');?></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('corank');?>：</td>
              <td class="bline">
                <select name="corank" id="corank" style="width:160px">
                  <?php
                  $dsql->SetQuery("Select * from `#@__arcrank` where `rank` >= 0");
                  $dsql->Execute('cc');
                  while($row = $dsql->GetObject('cc')){
                    if ($corank==$row->rank) echo "<option value='".$row->rank."' selected>".$row->membername."</option>";
                    else {
                      if ($corank==0){
                        echo "<option value='".$row->rank."'>".$row->membername."</option>";
                      }
                    }
                  }
                  ?>
                </select>
                <?php echo Lang('corank_msg');?>
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_nextdir');?>：</td>
              <td class="bline">
                <?php
                $pardir = '{cmspath}'.$cfg_arcdir;
                if (!empty($typedir)) $pardir = $typedir.'/';
                $pardir = preg_replace("#\/{1,}#", '/', $pardir);
                echo $pardir;
                ?>
                <input type="hidden" name="nextdir" id="nextdir" value="<?php echo $pardir?>">
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('catalog_typedir');?>：</td>
              <td class="p-0">
                <table cellspacing="1" cellpadding="1" class="table-borderless">
                  <tr>
                    <td><input type="text" name="typedir" id="typedir" class="pubinputs" style="width:260px"></td>
                    <td><label for="upinyin"><input type="checkbox" name="upinyin" id="upinyin" value="1" onClick="CheckTypeDir()"> <?php echo Lang('pinyin');?></label></td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_referpath');?>：</td>
              <td class="bline">
                <label><input type="radio" name="referpath" value="parent" checked="chekced"> <?php echo Lang('catalog_parent');?></label>
                <?php
                if ($moresite==0){
                ?>
                <label><input type="radio" name="referpath" value="cmspath"> <?php echo Lang('cmspath');?></label>
                <label><input type="radio" name="referpath" value="basepath"> <?php echo Lang('basepath');?></label>
                <?php }?>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('catalog_list_option');?>：</td>
              <td>
                <label><input type="radio" name="isdefault" value="1" checked="checked"> <?php echo Lang('catalog_list_option_1');?></label>
                <label><input type="radio" name="isdefault" value="0"> <?php echo Lang('catalog_list_option_0');?></label>
                <label><input type="radio" name="isdefault" value="-1"> <?php echo Lang('catalog_list_option_-1');?></label>
              </td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_default_name');?>：</td>
              <td class="bline"><input type="text" name="defaultname" value="index.html" style="width:260px"></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_ispart');?>：</td>
              <td class="bline">
                <label><input type="radio" name="ispart" value="0" checked="checked"> <?php echo Lang('catalog_ispart_0');?></label><br>
                <label><input type="radio" name="ispart" value="1"> <?php echo Lang('catalog_ispart_1');?></label> <br>
                <label><input type="radio" name="ispart" id="ispart2" value="2"> <?php echo Lang('catalog_ispart_2');?></label>
              </td>
            </tr>
            <tr id="helpvarco" style="display:none">
              <td height="80" bgcolor="#f8f8f8"><?php echo Lang('catalog_cross_help');?>：</td>
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_cross_help_body');?></td>
            </tr>
            <tr>
              <td><?php echo Lang('catalog_cross');?>：<i class="fa fa-question-circle" title="<?php echo Lang('help');?>" onClick="ShowHide('helpvarco')" style="cursor:pointer"></i> <?php echo Lang('catalog_cross_tip');?></td>
              <td>
                <label><input type="radio" name="cross" id="cross0" value="0" onClick="CheckCross()" checked="1"> <?php echo Lang('catalog_cross_0');?></label>
                <label><input type="radio" name="cross" id="cross1" value="1" onClick="CheckCross()"> <?php echo Lang('catalog_cross_1');?></label>
                <label><input type="radio" name="cross" id="cross2" value="2" onClick="CheckCross()"> <?php echo Lang('catalog_cross_2');?></label>
                <br>
                <textarea name="crossid" id="crossid" style="display:none"></textarea>
              </td>
            </tr>
            <tr id="smclass" style="<?php echo ($channelid<0 ? '' : 'display:none');?>">
              <td class="bline"><?php echo Lang('catalog_smalltype');?></td>
              <td class="bline">
                <select name="smalltype[]" multiple="yes" style="width:160px;height:100px">
                  <?php
                  $sql = "SELECT * FROM `#@__sys_enum` WHERE egroup LIKE 'infotype' ORDER BY disorder ASC, id DESC";
                  $dsql->Execute('s',$sql);
                  while($arr = $dsql->GetArray('s'))
                  {
                    if ($arr['evalue']%500==0) {
                      echo "<option value='{$arr['evalue']}'>{$arr['ename']}</option>";
                    }
                    else if (preg_match("#\.#", $arr['evalue']))
                    {
                      echo "<option value='{$arr['evalue']}'>└───{$arr['ename']}</option>";
                    } else {
                      echo "<option value='{$arr['evalue']}'>└─{$arr['ename']}</option>";
                    }
                  }
                  ?>
                </select><?php echo Lang('catalog_smalltype_tip');?>
              </td>
            </tr>
          </table>
          <table width="100%" cellspacing="0" cellpadding="0" id="adset" class="table biz-border" style="display:none">
            <?php
            if ($id==0)
            {
            ?>
            <tr>
              <td class="bline" width="260"><?php echo Lang('catalog_moresite');?>：</td>
              <td class="bline">
                <label><input type="radio" name="moresite" value="1"> <?php echo Lang('enable');?></label>
                <label><input type="radio" name="moresite" value="0" checked="checked"> <?php echo Lang('disable');?></label>
              </td>
            </tr>
            <tr>
              <td bgcolor="#f8f8f8"><?php echo Lang('explain');?>：</td>
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_moresite_explain');?></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_siteurl');?>：</td>
              <td class="bline"><input type="text" name="siteurl" id="siteurl" onChange="CheckPathSet();" style="width:260px"><?php echo Lang('catalog_siteurl_tip');?></td>
            </tr>
            <tr>
              <td class="bline"><?php echo Lang('catalog_site_baseurl');?>：</td>
              <td class="bline"><?php echo Lang('catalog_site_baseurl_tip');?></td>
            </tr>
            <?php }?>
            <tr id="helpvar1" style="display:none">
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_rule_var');?>：</td>
              <td bgcolor="#f8f8f8">
                <?php
                $chns = "";
                foreach($channelArray as $k=>$arr)
                {
                  $chns .= "{$arr['typename']}({$arr['nid']})、";
                }
                echo Lang('catalog_rule_var_tip',array('channels'=>$chns,'templates_dir'=>$cfg_templets_dir));
                ?>
                <input type="hidden" value="{style}" name="dfstyle" class="pubinputs">
              </td>
            </tr>
            <tr>
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_rule_option');?>：</td>
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_rule_option_tip');?></td>
            </tr>
            <tr>
              <td><?php echo Lang('tempindex');?>：</td>
              <td>
                <input type="text" name="tempindex" value="{style}/index_<?php echo $nid?>.htm" style="width:260px">
                <button type="button" name="set1" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.tempindex')"><?php echo Lang('browser');?></button>
                <i class="fa fa-question-circle" title="<?php echo Lang('help');?>" onClick="ShowHide('helpvar1')" style="cursor:pointer"></i>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('templist');?>：</td>
              <td>
                <input type="text" name="templist" value="{style}/list_<?php echo $nid?>.htm" style="width:260px">
                <button type="button" name="set3" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.templist')"><?php echo Lang('browser');?></button>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('temparticle');?>：</td>
              <td>
                <input type="text" name="temparticle" value="{style}/article_<?php echo $nid?>.htm" style="width:260px">
                <button type="button" name="set4" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.temparticle')"><?php echo Lang('browser');?></button>
              </td>
            </tr>
            <tr id="helpvar2" style="display:none">
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_support_val');?>：</td>
              <td bgcolor="#f8f8f8">
                <?php echo Lang('catalog_support_val_tip');?>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('catalog_namerule');?>：</td>
              <td>
                <input type="text" name="namerule" tid="namerule" value="<?php echo $cfg_df_namerule;?>" style="width:260px">
                <i class="fa fa-question-circle"  title="<?php echo Lang('help');?>" onClick="ShowHide('helpvar2')" style="cursor:pointer"></i>
              </td>
            </tr>
            <tr id="helpvar3" style="display:none">
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_support_val');?>：</td>
              <td bgcolor="#f8f8f8"><?php echo Lang('catalog_support_val_tip2');?></td>
            </tr>
            <tr>
              <td><?php echo Lang('catalog_namerule2');?>：</td>
              <td>
                <input type="text" name="namerule2" id="namerule2" value="{typedir}/{tid}-{page}.html" style="width:260px">
                <i class="fa fa-question-circle"  title="<?php echo Lang('help');?>" onClick="ShowHide('helpvar3')" style="cursor:pointer"></i>
              </td>
            </tr>
            <tr>
              <td height="60"><?php echo Lang('catalog_seotitle');?>：</td>
              <td><input type="text" name="seotitle" id="seotitle" style="width:260px"><?php echo Lang('catalog_seotitle_tip');?></td>
            </tr>
            <tr>
              <td height="60"><?php echo Lang('keywords');?>：</td>
              <td><textarea name="keywords" id="keywords" style="width:360px;height:50px"></textarea></td>
            </tr>
            <tr>
              <td height="60"><?php echo Lang('description');?>：</td>
              <td height="60"><textarea name="description" id="description" style="width:360px;height:50px"></textarea></td>
            </tr>
          </table>
          <table width="100%" cellspacing="0" cellpadding="0" id="ctset" class="table biz-border" style="display:none">
            <tr>
              <td><?php echo Lang('catalog_body_tip');?></td>
            </tr>
            <tr>
              <td><?php GetEditor("content","","450","Default","print","false");?></td>
            </tr>
          </table>
          <table width="100%" cellspacing="0" cellpadding="0" bgcolor="#f8f8f8" class="mb-3 biz-border border-top-0">
            <tr>
              <td align="center" class="py-2">
                <button type="submit" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
                <a href="catalog_main.php" class="btn btn-success btn-sm"><?php echo Lang('back');?></a>
              </td>
            </tr>
          </table>
        </td>
      </form>
    </tr>
  </table>
</body>
</html>