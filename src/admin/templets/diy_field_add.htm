<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>自定义表单增加字段</title>
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="../static/web/css/admin.css">
		<script src="../static/web/js/jquery.min.js"></script>
		<script src="../static/web/js/bootstrap.bundle.min.js"></script>
		<script src="js/main.js"></script>
		<style>.nw{float:left;width:160px}.cls{clear:both}</style>
		<script>
			var notAllow = " <?php echo $f;?> ";
			function GetFields()
			{
				var theform = document.form1;
				var fieldname = theform.fieldname.value;
				var itemname = theform.itemname.value;
				var dtype = 'text';
				var enums = document.getElementsByName('dtype');
				for(i=0;i<enums.length;i++)
				{
					if (enums[i].checked) dtype = enums[i].value;
				}
				var isnull = theform.isnull.value;
				var vdefault = theform.vdefault.value;
				var maxlength = theform.maxlength.value;
				var vinnertext = theform.vinnertext.value;
				var spage = (theform.spage[0].checked ? theform.spage[0].value : theform.spage[1].value);
				var sisnull = (isnull==0 ? "false" : "true");
				if (itemname=="")
				{
					ShowMsg("表单提示名称不能为空");
					theform.itemname.focus();
					return false;
				}
				if (fieldname=="") 
				{
					ShowMsg("字段名称不能为空");
					theform.fieldname.focus();
					return false;
				}
				if (notAllow.indexOf(" "+fieldname+" ") >-1 ) 
				{
					ShowMsg("字段名称不合法，如下字段名已经存在，建议在名称后加上数字以区分：\n"+notAllow);
					return false;
				}
				if ((dtype=="radio" || dtype=="select" || dtype=="checkbox") && vdefault=="")
				{
					ShowMsg("您选择的select或radio、checkbox类型，必须默认值设置选择的项目（用英文逗号）");
					return false;
				}
				if (spage=="no") spage = "";
				revalue =  "<field:"+fieldname+" itemname=\""+itemname+"\" autofield=\"1\" type=\""+dtype+"\" isnull=\""+sisnull+"\" default=\""+vdefault+"\" ";
				revalue += " maxlength=\""+maxlength+"\" page=\""+spage+"\">"+vinnertext+"</field:"+fieldname+">";
				document.form1.fieldstring.value = revalue;
				return true;
			}
		</script>
	</head>
	<body>
		<table width="98%" cellpadding="1" cellspacing="1" align="center" class="table maintable my-3">
			<form name="form1" action="diy_field_add.php" method="post" onSubmit="return GetFields();">
				<input type="hidden" name="action" value="save">
				<input type="hidden" name="diyid" value="<?php echo $diyid?>">
				<input type="hidden" name="fieldstring" value="">
				<tr>
					<td bgcolor="#f5f5f5" colspan="2">
						<table width="98%" cellspacing="0" cellpadding="0" class="table table-borderless">
							<tr>
								<td width="30%"><a href="diy_main.php">自定义表单管理</a> &gt; 增加新字段</td>
								<td width="70%" align="right"><button type="button" name="ss1" onClick="location='diy_edit.php?diyid=<?php echo $diyid;?>&dopost=edit';" class="btn btn-success btn-sm">当前表单信息</button></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td colspan="2">
						<div class="alert alert-danger mb-0">所有填写的文档不允许包含双引号[&quot;]，否则配置将无法写入</div>
					</td>
				</tr>
				<tr>
					<td width="30%">表单提示文字：发布文档时显示的提示文字</td>
					<td><input type="text" name="itemname" id="itemname"> *</td>
				</tr>
				<tr>
					<td>字段名称：只能用英文字母或数字，数据表的真实字段名，如果数据类型是联动类型，该项应该填写联动类型的<a href="stepselect_main.php" target="_blank">[组名称]</a></td>
					<td><input type="text" name="fieldname" id="fieldname"> *</td>
				</tr>
				<tr>
					<td>文档是否需要分页符：如果文档需要分页符，不论何种文档，都可以用#P#副标题#e#作为分页符号实现文档分页，但一个模型里仅允许一个这样的字段</td>
					<td>
						<input type="hidden" name="isnull" value="1">
						<label><input type="radio" name="spage" value="split"> 是</label>
						<label><input type="radio" name="spage" value="no" checked="1"> 否</label>
					</td>
				</tr>
				<tr>
					<td>数据类型：</td>
					<td>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype1" value="text" checked="1"> 单行文本(varchar)</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype2" value="textchar"> 单行文本(char)</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype3" value="multitext"> 多行文本</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype4" value="htmltext"> 网页文本</label></div>
						<br class="cls">
						<div class="nw"><label><input type="radio" name="dtype" id="dtype6" value="int"> 整数类型</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype7" value="float"> 小数类型</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype8" value="datetime"> 时间类型</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype13" value="select"> option下拉框</label></div>
						<br class="cls">
						<div class="nw"><label><input type="radio" name="dtype" id="dtype14" value="radio"> radio选项卡</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype15" value="checkbox"> checkbox多选框</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype9" value="img"> 图片</label></div>
						<div class="nw"><label><input type="radio" name="dtype" id="dtype12" value="addon"> 附件类型</label></div>
					</td>
				</tr>
				<tr>
					<td>默认值：如果定义数据类型为select、radio、checkbox时，此处填写被选择的项目（英文逗号分开，如“天涯,叙述”）</td>
					<td><textarea name="vdefault" id="vdefault" class="biz-textarea-xl"></textarea></td>
				</tr>
				<tr>
					<td>最大长度：文本数据必须填写，大于255为text类型</td>
					<td><input type="text" name="maxlength" id="maxlength" value="250" class="biz-input-xs"></td>
				</tr>
				<tr>
					<td>自定义网页表单：</td>
					<td>自定义网页表单模板中用~name~表示提示文字，~form~表示表单元素</td>
				</tr>
				<tr>
					<td></td>
					<td><textarea name="vinnertext" id="vinnertext" class="biz-textarea-xl"></textarea></td>
				</tr>
				<tr>
					<td colspan="2" bgcolor="#f5f5f5" align="center" class="py-2">
						<button type="submit" class="btn btn-success btn-sm">保存</button>
						<button type="reset" class="btn btn-success btn-sm">重置</button>
					</td>
				</tr>
			</form>
		</table>
	</body>
</html>