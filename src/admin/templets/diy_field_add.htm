<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=<?php echo $cfg_soft_lang; ?>">
<title>增加字段</title>
<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
<link rel="stylesheet" href="../static/web/css/admin.css">
<script language="javascript" src="../static/web/js/jquery.min.js"></script>
<script src="../static/web/js/bootstrap.bundle.min.js"></script>
<script language='javascript' src="js/main.js"></script>
<script language="javascript">
var notAllow = " <?php echo $f; ?> ";
function GetFields()
{
	var theform = document.form1;
	var fieldname = theform.fieldname.value;
	var itemname = theform.itemname.value;
	var dtype = 'text';
	var enums = document.getElementsByName('dtype');
	for(i=0;i<enums.length;i++)
	{
		if(enums[i].checked) dtype = enums[i].value;
	}
	var isnull = theform.isnull.value;
	var vdefault = theform.vdefault.value;
	var maxlength = theform.maxlength.value;
	var vinnertext = theform.vinnertext.value;
	var spage = (theform.spage[0].checked ? theform.spage[0].value : theform.spage[1].value);
	var sisnull = (isnull==0 ? "false" : "true");
	
	if(itemname=="")
	{
		ShowMsg("表单提示名称不能为空");
		theform.itemname.focus();
		return false;
	}
	
	if(fieldname=="") 
	{
		ShowMsg("字段名称不能为空");
		theform.fieldname.focus();
		return false;
	}
	
	if(notAllow.indexOf(" "+fieldname+" ") >-1 ) 
	{
		ShowMsg("字段名称不合法，如下字段名已经存在，建议在名称后加上数字以区分：\n"+notAllow);
		return false;
	}
	
	if((dtype=="radio" || dtype=="select" || dtype=="checkbox") && vdefault=="")
	{
		ShowMsg("您选择的select或radio、checkbox类型，必须默认值设置选择的项目（用逗号[,]分开）");
		return false;
	}
	
	if(spage=="no") spage = "";
	
	revalue =  "<field:"+fieldname+" itemname=\""+itemname+"\" autofield=\"1\" type=\""+dtype+"\" isnull=\""+sisnull+"\" default=\""+vdefault+"\" ";
	revalue += " maxlength=\""+maxlength+"\" page=\""+spage+"\">\r\n"+vinnertext+"</field:"+fieldname+">\r\n";
	document.form1.fieldstring.value = revalue;
 
  return true;
  
}
</script>
<style>
td{ padding:6px; padding-left:6px; line-height:26px }
.STYLE1 {color: #FF3300}
.STYLE2 {color: #666666}
.nw { float:left; width:150px; }
.cls { clear:both; }
</style>
</head>
<body>
<table width="98%" border="0" cellpadding="1" cellspacing="1" align="center" class="table maintable mt-3">
  <form name="form1" action="diy_field_add.php" method="post" onSubmit="return GetFields();">
  <input type='hidden' name='action' value='save'>
  <input type='hidden' name='diyid' value='<?php echo $diyid?>'>
	<input type='hidden' name='fieldstring' value=''>
    <tr> 
      <td height="26" colspan="2" background="../static/web/img/tbg.gif">
        <table width="98%" border="0" cellspacing="0" cellpadding="0" class="table table-borderless">
          <tr> 
            <td width="30%"><a href="diy_main.php">自定义表单管理</a> &gt; 增加新字段</td>
            <td align="right">
			        <button type="button" name="ss1" onClick="location='diy_edit.php?diyid=<?php echo $diyid; ?>&dopost=edit';" class="btn btn-success btn-sm">当前表单信息</button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2" bgcolor="#ffffff"><span class="STYLE1">所有填写的内容不允许包含双引号[&quot;]，否则配置将无法写入</span></td>
    </tr>
    <tr> 
      <td bgcolor="#ffffff">表单提示文字：<br>
        <span class="STYLE2">发布内容时显示的提示文字</span>
      </td>
      <td bgcolor="#ffffff"><input name="itemname" type="text" id="itemname" class="pubinputs"> *</td>
    </tr>
    <tr> 
      <td width="28%" bgcolor="#ffffff">字段名称：<br>
      <span class="STYLE2">只能用英文字母或数字，数据表的真实字段名，如果数据类型是联动类型，该项应该填写联动类型的<a href='stepselect_main.php' target='_blank'>[组名称]</a></span>
      </td>
      <td width="72%" bgcolor="#ffffff"> <input name="fieldname" type="text" id="fieldname" class="pubinputs"> *</td>
    </tr>
    <tr> 
      <td bgcolor="#ffffff">内容是否需要分页符：<br>
        <span class="STYLE2">如果内容需要分页符，不论何种内容，都可以用#P#副标题#e#作为分页符号实现内容分页，但一个模型里仅允许一个这样的字段!</span>
      </td>
      <td bgcolor="#ffffff">
      	<input name="isnull" type="hidden" value="1">
        <label><input name="spage" type="radio"  value="split" class='np' />
         是</label>
         &nbsp; 
         <label><input name="spage" type="radio"  value="no" class='np' checked='1' />
         否</label>
      </td>
    </tr>
    <tr> 
      <td bgcolor="#ffffff">数据类型：</td>
      <td bgcolor="#ffffff">
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype1' value="text" checked='1'> 单行文本(varchar)</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype2' value="textchar"> 单行文本(char)</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype3' value="multitext"> 多行文本</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype4' value="htmltext"> HTML文本</label></div>
<br class='cls' />
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype6' value="int"> 整数类型</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype7' value="float"> 小数类型</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype8' value="datetime"> 时间类型</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype13' value="select"> 使用option下拉框</label></div>
<br class='cls' />
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype14' value="radio"> 使用radio选项卡</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype15' value="checkbox"> Checkbox多选框</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype9' value="img"> 图片</label></div>
<div class='nw'><label><input type='radio' class='np' name='dtype' id='dtype12' value="addon"> 附件类型</label></div>
       </td>
    </tr>
    <tr> 
      <td bgcolor="#ffffff">默认值：<br>
        <span class="STYLE2">如果定义数据类型为select、radio、checkbox时，此处填写被选择的项目（用“,”分开，如“男,女,人妖”）</span>
      </td>
      <td bgcolor="#ffffff"> <textarea name="vdefault" type="text" id="vdefault" style="width:70%;height:60px"></textarea></td>
    </tr>
    <tr> 
      <td bgcolor="#ffffff">最大长度：<br>
        <span class="STYLE2">文本数据必须填写，大于255为text类型</span>
      </td>
      <td bgcolor="#ffffff"><input name="maxlength" type="text" id="maxlength" class="pubinputs" value="250" style="width:80px"></td>
    </tr>
    <tr>
      <td bgcolor="#ffffff">自定义表单HTML：</td>
      <td bgcolor="#ffffff">自定义表单HTML模板中用~name~表示提示文字，~form~表示表单元素</td>
    </tr>
    <tr> 
      <td align="center" bgcolor="#ffffff"></td>
      <td bgcolor="#ffffff"><textarea name="vinnertext" cols="45" rows="5" id="vinnertext" style="width:70%;height:120px"></textarea></td>
    </tr>
    <tr> 
      <td height="26" colspan="2" bgcolor="#F9FDF0">
	     <table width="100%" border="0" cellspacing="0" cellpadding="0" class="table table-borderless">
          <tr> 
            <td width="30%" height="36"></td>
            <td width="10%"><button type="submit" class="btn btn-success">确定</button></td>
            <td><button type="reset" class="btn btn-success">重置</button></td>
          </tr>
        </table>
      </td>
    </tr>
  </form>
</table>
</body>
</html>