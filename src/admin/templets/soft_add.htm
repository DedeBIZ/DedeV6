<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=<?php echo $cfg_soft_lang; ?>">
  <title>增加软件集</title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.css">
  <script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut; ?>';</script>
  <script language="javascript" src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script language="javascript" src="../static/web/js/webajax.js"></script>
  <link rel="stylesheet" href="../static/web/css/daterangepicker.css">
  <script type="text/javascript" src="../static/web/js/moment.min.js"></script>
  <script type="text/javascript" src="../static/web/js/daterangepicker.js"></script>
  <link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
  <script language="javascript" src="js/main.js"></script>
  <link rel="stylesheet" href="../static/web/css/cropper.min.css">
  <script src="../static/web/js/cropper.min.js"></script>
  <script language="javascript">
    function checkSubmit() {
      if (document.form1.title.value == '') {
        ShowMsg('软件名称不能为空');
        document.form1.title.focus();
        return false;
      }
      if (document.form1.typeid.value == 0) {
        ShowMsg('请选择档案的主类别');
        return false;
      }
    }
    var startNum = 0;
    function MakeUpload() {
      var upfield = document.getElementById("uploadfield");
      var endNum = parseInt(document.form1.picnum.value) + startNum - 1;
      if (endNum > 30) endNum = 30;
      for (startNum; startNum <= endNum; startNum++) {
        upfield.innerHTML += "<div style='line-height:36px'>软件地址" + startNum + "：<input type='text' name='softurl" + startNum + "' value='http://' style='width:260px'> 服务器名称：<input type='text' name='servermsg" + startNum + "' style='width:160px'></div>";
      }
    }
    function ShowHideAddr() {
      document.getElementById('morelink').style.display = (document.getElementById('morelink').style.display == 'block' ? 'none' : 'block');
      document.getElementById('morelink').style.height = '100%';
      document.getElementById('btsh3').value = (document.getElementById('morelink').style.display == 'block' ? '隐藏地址' : '显示地址');
    }
  </script>
<style>
body{background:#fff}
img{vertical-align:baseline}
table{border-collapse:separate}
.style1 {color:#555}
</style>
</head>
<body>
  <form name="form1" action="soft_add.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmit();">
    <input type="hidden" name="dopost" value="save">
    <input type="hidden" name="channelid" value="<?php echo $channelid?>">
    <input type="hidden" name="cid" value="<?php echo $cid; ?>">
    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" class="mt-3">
      <tr>
        <td width="60%" height="30"><img src="../static/web/img/book1.gif"><a href="catalog_do.php?cid=<?php echo $cid?>&channelid=<?php echo $channelid?>&dopost=listArchives">软件列表</a> &gt; 发布软件</td>
        <td align="right"><a href="catalog_main.php" class="btn btn-success btn-sm">栏目管理</a><a href="soft_config.php" class="btn btn-success btn-sm">下载频道参数设定</a></td>
      </tr>
    </table>
    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" id="head1">
      <tr>
        <td colspan="2">
          <table border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td width="86" height="26" align="center" background="../static/web/img/itemnote1.gif">常规信息</td>
              <td width="86" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem2()">高级参数</a></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" id="head2" style="display:none">
      <tr>
        <td colspan="2">
          <table height="26" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td width="86" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem1()">常规信息</a></td>
              <td width="86" align="center" background="../static/web/img/itemnote1.gif">高级参数</td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" border="0" align="center" cellpadding="2" cellspacing="2" id="needset" style="border:1px solid #dee2e6;background:#ffffff;">
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;软件名称：</td>
              <td width="400"><input name="title" type="text" id="title" style="width:380px"></td>
              <td width="90">&nbsp;简略标题：</td>
              <td><input name="shorttitle" type="text" id="shorttitle" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td width="400%" height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;自定义属性：</td>
              <td><?php
              $dsql->SetQuery("Select * From `#@__arcatt` order by sortid asc");
              $dsql->Execute();
              while($trow = $dsql->GetObject())
              {
          	    if($trow->att=='j')
          	    echo "<label><input class='np' type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' onclick='ShowUrlTr()'> {$trow->attname}[{$trow->att}]</label> ";
          	    else
          	    echo "<label><input class='np' type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'> {$trow->attname}[{$trow->att}]</label> ";
              }
            	?></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline" id="redirecturltr" style="display:none">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;跳转网址：</td>
              <td><input name="redirecturl" type="text" id="redirecturl" value="" style="width:300px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td width="400%" height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;Tag标签：</td>
              <td><input name="tags" type="text" id="tags" value="" onChange="$Obj('keywords').value=this.value;" style="width:300px">（','号分开，单个标签小于12字节）</td>
              <td width="60">权重：</td>
              <td><input name="weight" type="text" id="weight" value="<?php echo $maxWright['cc']; ?>" style="width:60px">（越小越靠前）</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id="pictable">
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;缩略图：</td>
              <td>
                <input name="picname" type="text" id="picname" style="width:300px">
                <label><input type='checkbox' class='np' name='ddisremote' value='1' id='ddisremote' />&nbsp;远程</label>
                <span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
                <button type="button" name="Submit2" onClick="SelectImage('form1.picname','small');" class='btn btn-success btn-sm'>选择图片</button>
                <button id="btnClearAll" type="button" class="btn btn-success btn-sm delete">清空</button>
              </td>
              <td width="150" align="center"><img id="litPic" src="../static/web/img/defaultpic.jpg" style="height:80px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;软件来源：</td>
              <td width="250">
                <input name="source" type="text" id="source" style="width:160px">
                <button name="selsource" type="button" id="selsource" class="btn btn-success btn-sm">选择</button>
              </td>
              <td width="60">作者：</td>
              <td>
                <input name="writer" type="text" id="writer" style="width:160px">
                <button name="selwriter" type="button" id="selwriter" class="btn btn-success btn-sm">选择</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="600" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;软件主栏目：</td>
              <td>
                <span id='typeidct'>
                <?php
                $typeOptions = GetOptionList($cid,$cuserLogin->getUserChannel(),$channelid);
                echo "<select name='typeid' id='typeid' style='width:160px'>";
                echo "<option value='0'>请选择栏目</option>";
                echo $typeOptions;
                echo "</select>";
                ?>
                </span>
                <img src='../static/web/img/menusearch.gif' style='cursor:pointer' onClick="ShowCatMap(event, this, <?php echo $channelid; ?>, 'typeid')" title='快捷选择'>
                <?php
                if($cfg_need_typeid2=='Y')
                {
                  echo "<a href='javascript:AddTypeid2();' class='btn btn-success btn-sm'>选择副栏目</a>";
                }
                ?>
              </td>
              <td width="90" align="center">消费金币：</td>
              <td><input name="needmoney" type="text" id="needmoney" value="<?php echo $softconfig['dfywboy']; ?>" style="width:120px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id='typeid2tr' style='display:none'>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;副栏目：</td>
              <td>
                <span id='typeid2ct'></span>
                <input type='text' name='typeid2' id='typeid2' value='' style='width:260px;' />
                <img src='../static/web/img/menusearch2.gif' onClick="ShowCatMap(event, this, <?php echo $channelid; ?>, 'typeid2')" title='选择副栏目' style='cursor:pointer'>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;关键词：</td>
              <td>
                <input type='text' name="keywords" id="keywords" value="" style="width:360px">
                <button type="button" name="Submit" class='btn btn-success btn-sm' onClick="SelectKeywords('form1.keywords');">浏览</button>
              </td>
              <td>
                <label><input name="autokey" type="checkbox" onClick="ShowHide('keywords');" ; class="np" id="autokey" value="1" <?php if($cfg_arc_autokeyword=='Y') echo ' checked'; ?>>&nbsp;自动获取，手动填写用","分开</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;描述：</td>
              <td><textarea name="description" id="description" style="width:360px;height:50px"></textarea></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="1100" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;文件类型：</td>
              <td>
                <select name="filetype" id="filetype" style="width:120px">
                  <option value=".exe" selected>.exe</option>
                  <option value=".zip">.zip</option>
                  <option value=".rar">.rar</option>
                  <option value=".iso">.iso</option>
                  <option value=".gz">.gz</option>
                  <option value="其它">其它</option>
                </select>
              </td>
              <td width="90">软件等级：</td>
              <td><select name="softrank" id="softrank" style="width:120px">
                  <option value="1">一星</option>
                  <option value="2">二星</option>
                  <option value="3" selected>三星 </option>
                  <option value="4">四星</option>
                  <option value="5">五星</option>
                </select>
              </td>
              <td width="90">&nbsp;软件属性：</td>
              <td>
                <select name="softtype" id="softtype" style="width:120px">
                  <option value="国产软件" selected>国产软件</option>
                  <option value="国外软件">国外软件</option>
                  <option value="汉化补丁">汉化补丁</option>
                </select>
              </td>
              <td width="90">界面语言：</td>
              <td>
                <select name="language" id="language" style="width:120px">
                  <option value="简体中文" selected>简体中文</option>
                  <option value="英文软件">英文软件</option>
                  <option value="繁体中文">繁体中文</option>
                  <option value="其它类型">其它类型</option>
                </select>
              </td>
              <td width="90">授权方式：</td>
              <td>
                <select name="accredit" id="accredit" style="width:120px">
                  <option value="共享软件" selected>共享软件</option>
                  <option value="免费软件">免费软件</option>
                  <option value="开源软件">开源软件</option>
                  <option value="商业软件">商业软件</option>
                  <option value="破解软件">破解软件</option>
                  <option value="游戏外挂">游戏外挂</option>
                </select>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;运行环境：</td>
              <td><input type='text' name='os' value='Win2003,WinXP,Win2000,Win9X' style='width:260px'></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;官方网址：</td>
              <td width="310"><input name="officialUrl" type="text" id="officialUrl" value="http://" style="width:300px"></td>
              <td width="90">演示地址：</td>
              <td><input name="officialDemo" type="text" id="officialDemo" value="http://" style="width:300px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;软件大小：</td>
              <td>
                <input name="softsize" type="text" id="softsize" style="width:60px">
                <select name="unit" id="unit">
                  <option value="MB" selected>MB</option>
                  <option value="KB">KB</option>
                  <option value="GB">GB</option>
                </select>
                <label><input name="autosize" type="checkbox" class="np" id="autosize" value="1" checked>自动获得（必须包含一个本地软件）</label> 
              </td>
              <td width="90">需会员权限：</td>
              <td align="left">
                <select name="daccess" id="daccess" style="width:160px">
                <?php
                $dsql->SetQuery("Select * from `#@__arcrank` where `rank`>=0 ");
                $dsql->Execute();
                while($row = $dsql->GetArray())
                {
                  if($row['rank']==0) $row['membername'] = "不限会员";
                  if($row['rank'] == $softconfig['dfrank']) echo "<option value='{$row['rank']}' selected>{$row['membername']}</option>";
                  else echo "<option value='{$row['rank']}'>{$row['membername']}</option>";
                }
                ?>
                </select>
                <a href="soft_config.php" class="btn btn-success btn-sm">软件频道设置</a>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><?php PrintAutoFieldsAdd(stripslashes($cInfos['fieldset']),'autofield'); ?></td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;本地地址：</td>
              <td>
                <input name="softurl1" type="text" id="softurl1" style="width:300px">
                <button class='btn btn-success btn-sm' name="sel1" type="button" id="sel1" onClick="SelectSoft('form1.softurl1')">选取</button>
              </td>
              <td width="90">服务器名称：</td>
              <td><input name="servermsg1" type="text" id="servermsg1" value="本地下载" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <?php
      if($softconfig['moresitedo'] == 0 && trim($softconfig['sites']) != '')
      {
      ?>
      <tr>
        <td height="26" bgcolor="#f8f8f8" class="bline2">&nbsp;预设的镜像服务器：</td>
      </tr>
      <tr class="bline">
        <td>（服务器地址 + 软件地址 = 软件真实地址）</a><br>
          <?php
    	    $sites = explode("\n", $softconfig['sites']);
    	    $startNum = 2;
    	    foreach($sites as $site)
    	    {
    		  $site = trim($site);
    		  if(empty($site)) continue;
    		  list($siteurl, $sitename) = explode('|', $site);
    		  $siteurl = trim($siteurl);
    		  $sitename = trim($sitename);
          ?>
          <?php echo $sitename; ?>：
          <input type='hidden' name='forconfig<?php echo $startNum; ?>' value='1'>
          <input type='text' name='softurlfirst<?php echo $startNum; ?>' style='width:260px' value='<?php echo $siteurl; ?>'> +
          <input type='text' name='softurl<?php echo $startNum; ?>' style='width:160px' value=''> =
          <input type='text' name='servermsg<?php echo $startNum; ?>' style='width:160px' value='<?php echo $sitename; ?>'>
          <label><input type='checkbox' name='need<?php echo $startNum; ?>' class='np' value='1' checked> 启用</label>
          <br>
          <?php
          $startNum++;
          }
		      echo "<script language='javascript'>startNum = $startNum;</script>";
		      ?>
        </td>
      </tr>
      <?php
      }
      ?>
      <tr>
        <td height="26" bgcolor="#f8f8f8" class="bline2">&nbsp;手动指定地址：</td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0" class="bline">
            <tr>
              <td width="90">&nbsp;其它地址：</td>
              <td>
                <input  type="text" name="picnum" id="picnum" value="5" style="width:60px">
                <button type="button" name="kkkup" class="btn btn-success btn-sm" id="kkkup2" onClick="MakeUpload();">增加地址</button>
                <button type="button" class='btn btn-success btn-sm' name="Submit3" id="btsh3" onClick="ShowHideAddr();">隐藏地址</button>（最多为30个链接）
              </td>
            </tr>
          </table>
          <div id="morelink" style="display:block">
            <div id="uploadfield" style="width:800px"></div>
          </div>
        </td>
      </tr>
      <tr>
        <td height="26" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;附加选项：</td>
              <td>
                <label><input name="remote" type="checkbox" class="np" id="remote" value="1" <?php if($cfg_rm_remote=='Y') echo ' checked'; ?>>&nbsp;下载远程图片和资源&nbsp;</label>
                <label><input name="dellink" type="checkbox" class="np" id="dellink" value="1" <?php if($cfg_arc_dellink=='Y') echo ' checked'; ?>>&nbsp;删除非站内链接</label>
                <a href="javascript:OpenMyWin('article_allowurl_edit.php');" class="btn btn-success btn-sm">设置</a>&nbsp;
                <label><input name="autolitpic" type="checkbox" class="np" id="autolitpic" value="1" <?php if($cfg_arc_autopic=='Y') echo ' checked'; ?>>&nbsp;提取第一个图片为缩略图</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="100">
        <?php
        GetEditor('body', '', 250, 'Small');
	      ?>
        </td>
      </tr>
    </table>
    <!--高级参数-->
    <table width="98%" border="0" align="center" cellpadding="2" cellspacing="2" id="adset" style="display:none;border:1px solid #dee2e6;background:#ffffff;">
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90" height="26" width="250">&nbsp;评论选项：</td>
              <td width="250">
                <label><input type='radio' name='notpost' class='np' value='0' <?php if($cfg_feedback_forbid=='N') echo "checked='1' "; ?> /> 允许评论</label>
                &nbsp;
                <label><input type='radio' name='notpost' class='np' value='1' <?php if($cfg_feedback_forbid=='Y') echo "checked='1' "; ?> /> 禁止评论</label>
              </td>
              <td width="90">发布选项：</td>
              <td>
                <label><input name="ishtml" type="radio" class="np" value="1" checked>
                生成HTML</label>
                <label><input type="radio" name="ishtml" class="np" value="0">
                仅动态浏览</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90" height="26">&nbsp;文章排序：</td>
              <td width="250">
                <select name="sortup" id="sortup" style="width:160px">
                  <option value="0" selected>默认排序</option>
                  <option value="7">置顶一周</option>
                  <option value="30">置顶一个月</option>
                  <option value="90">置顶三个月</option>
                  <option value="180">置顶半年</option>
                  <option value="360">置顶一年</option>
                </select>
              </td>
              <td width="90">标题颜色：</td>
              <td>
                <input name="color" type="text" id="color" style="width:120px">
                <button name="modcolor" type="button" id="modcolor" class="btn btn-success btn-sm" onClick="ShowColor(event,this)">选取</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;阅读权限：</td>
              <td width="250">
                <select name="arcrank" id="arcrank" style="width:160px">
                  <option value='0'>已审核状态</option>
                  <option value='-1'>未审核状态</option>
                </select>
              </td>
              <td width="90">文件名称：</td>
              <td><input type="text" name="filename" id="filename" style="width:120px">（不包括后缀名如.html等）</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;发布时间：</td>
              <td width="250">
                <?php
                $nowtime = GetDateTimeMk(time());
                echo "<input type='text' name='pubdate' value='$nowtime' id='pubdate' class='datepicker' style='width:160px'>";
			          ?>
              </td>
              <td width="90">浏览次数：</td>
              <td><input type="text" name="click" value="<?php echo ($cfg_arc_click=='-1' ? mt_rand(50,200):$cfg_arc_click); ?>" style="width:120px"></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" border="0" cellspacing="0" cellpadding="0" align="center" bgcolor="#f8f8f8" style="border:1px solid #dee2e6;border-top:0" class="mb-3">
      <tr height="36">
        <td align="center" style="padding:.6rem">
          <button type="submit" class="btn btn-success">保存</button>
          <button type="button" onClick="location.reload();" class="btn btn-success">重置</button>
        </td>
      </tr>
    </table>
  </form>
  <script language='javascript'>InitPage();</script>
</body>
</html>