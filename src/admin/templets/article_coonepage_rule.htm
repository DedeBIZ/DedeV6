<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=<?php echo $cfg_soft_lang; ?>">
	<title>单页采集规则管理</title>
	<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
	<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
	<link rel="stylesheet" href="../static/web/css/admin.css">
	<script language="javascript" src="../static/web/js/jquery.min.js"></script>
	<script src="../static/web/js/bootstrap.bundle.min.js"></script>
	<script language='javascript' src='js/main.js'></script>
	<script language="javascript" src="../static/web/js/webajax.js"></script>
	<script language="javascript">
		function ShowAddNode() {
			$DE('addNode').style.display = 'block';
		}
		function CloseAddNode() {
			$DE('addNode').style.display = 'none';
		}
		function CloseEditNode() {
			$DE('editNode').style.display = 'none';
		}
		//编辑
		function EditNode(nid) {
			$DE('editNode').style.display = 'block';
			fetch('article_coonepage_rule.php?action=editload&id=' + nid).then(resp=>resp.text()).then((d)=>{
				$DE('editNodeBody').innerHTML = d;
			});
		}
		//获得选中文件的文件名
		function getCheckboxItem() {
			var allSel = "";
			if (document.form2.ids.value) return document.form2.ids.value;
			for (i = 0; i < document.form2.ids.length; i++) {
				if (document.form2.ids[i].checked) {
					allSel = (allSel == '' ? document.form2.ids[i].value : allSel + "," + document.form2.ids[i].value);
				}
			}
			return allSel;
		}
		function selAll() {
			for (i = 0; i < document.form2.ids.length; i++) {
				if (!document.form2.ids[i].checked) {
					document.form2.ids[i].checked = true;
				}
			}
		}
		function noSelAll() {
			for (i = 0; i < document.form2.ids.length; i++) {
				if (document.form2.ids[i].checked) {
					document.form2.ids[i].checked = false;
				}
			}
		}
		//删除节点
		function DelNode(selid) {
			if (selid == 0) selid = getCheckboxItem();
			if (selid != '') {
				if (window.confirm("您确定要删除这些条目吗")) location = "article_coonepage_rule.php?ids=" + selid + "&action=del";
			} else {
				ShowMsg("您没选择任何条目");
			}
		}

	</script>
	<style>
		#addNode {
			position: absolute;
			left: 20px;
			top: 20px;
			width: 430px;
			z-index: 2;
			background-color: #F2FDDB;
			border: 1px solid #889D8F;
			padding: 6px;
			display: none
		}
		#editNode {
			position: absolute;
			left: 20px;
			top: 20px;
			width: 430px;
			z-index: 1;
			background-color: #F2FDDB;
			border: 1px solid #889D8F;
			padding: 6px;
			display: none
		}
	</style>
</head>
<body>
	<table width="100%" cellpadding="2" align="center" cellspacing="1" class="table maintable mt-3 mb-3">
		<tr bgcolor="#F3FAD3">
			<td height="26" colspan="6">
				<div style="float:left;padding-left:6px">单页采集规则管理：</div>
				<div style="float:right;padding-right:10px"><a href='javascript:ShowAddNode();'
						class="btn btn-success btn-sm">增加新网址</a>
				</div>
			</td>
		</tr>
		<form name="form2">
			<tr align="center" bgcolor="#F9FCEF" height="26">
				<td width="8%">ID</td>
				<td width="8%">选择</td>
				<td width="20%">网址</td>
				<td width="12%">编码</td>
				<td width="20%">网站名称</td>
				<td width="12%">操作</td>
			</tr>
			{dede:datalist empty='<tr><td colspan="6"><center>暂无内容</center></td></tr>'}
			<tr align='center'
				onMouseOut="javascript:this.bgColor='#ffffff';" height="26">
				<td><?php echo $fields['id']?></td>
				<td><input name="ids" type="checkbox" id="ids" value="<?php echo $fields['id']?>" class="np"></td>
				<td align='left'>
					<?php echo $fields['url']; ?>
				</td>
				<td><?php echo $fields['lang']; ?></td>
				<td><?php echo $fields['title']; ?></td>
				<td>
					<a href="javascript:EditNode(<?php echo $fields['id']?>)" class="btn btn-success btn-sm">编辑</a>
					<a href="javascript:DelNode(<?php echo $fields['id']?>)" class="btn btn-success btn-sm">删除</a>
				</td>
			</tr>
			{/dede:datalist}
			<tr bgcolor="#F9FCEF">
				<td height="26" colspan="6">
					<a href="javascript:selAll()" class="btn btn-success btn-sm">全选</a>
					<a href="javascript:noSelAll()" class="btn btn-success btn-sm">取消</a>
					<a href="javascript:DelNode(0)" class="btn btn-success btn-sm">删除</a>
				</td>
			</tr>
		</form>
		<tr align="right" bgcolor="#F3FAD3">
			<td height="36" colspan="6" align="center">{dede:pagelist listsize='6'/}</td>
		</tr>
	</table>
	<!--下面是隐藏的栏目增加修改表单-->
	<div id="editNode">
		<span id='editNodeBody'>请稍候，正在载入</span>
	</div>

	<div id="addNode">
		<form name='addform' action='article_coonepage_rule.php' method='post'>
			<input type='hidden' name='action' value='add'>
			<table width="430" cellspacing="0" cellpadding="0">
				<tr>
					<td width="102" height="30">网站名称：</td>
					<td width="302"><input name="title" type="text" id="title" style="width:260px"></td>
					<td width="26" align="center"><a href="javascript:CloseAddNode()" class="mr-3"><i class="fa fa-window-close-o" aria-hidden="true"></i></a></td>
				</tr>
				<tr>
					<td height="30">原内容编码：</td>
					<td colspan="2">
						<label><input type="radio" name="lang" value="utf-8" checked="checked"> UTF-8 </label>
						<label><input type="radio" name="lang" value="gb2312"> GB2312/GBK</label>
					</td>
				</tr>
				<tr>
					<td height="30">用作文章来源：</td>
					<td colspan="2">
						<label><input type="radio" name="issource" value="0"> 否 </label>
						<label><input name="issource" type="radio" value="1" checked="checked"> 是</label>
					</td>
				</tr>
				<tr>
					<td height="30">网站网址：</td>
					<td colspan="2"><input name="url" type="text" id="url" style="width:260px"></td>
				</tr>
				<tr>
					<td height="30"></td>
					<td colspan="2">使用不带http及任何附加目录的网址<br>
						如：news.dedebiz.com</td>
				</tr>
				<tr>
					<td height="30">采集规则：</td>
					<td colspan="2">仅针对文章内容，格式：前面HTML{@body}后面HMTL</td>
				</tr>
				<tr>
					<td height="90"></td>
					<td colspan="2"><textarea name="rule" style="width:300px;height:80px">{@body}</textarea></td>
				</tr>
				<tr>
					<td colspan="3" align="center" class="py-3">
						<button class="btn btn-success btn-sm" type="submit" name="Submit" value="">保存规则</button>
						<button type="reset" class="btn btn-success btn-sm" name="Submit2">重置</button>
					</td>
				</tr>
			</table>
		</form>
	</div>
</body>
</html>