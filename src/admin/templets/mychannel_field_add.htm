<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('mychannel_field_add');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <style>
    .style1 {
      color: #FF3300
    }
    .style2 {
      color: #545b62
    }
    .nw {
      float: left;
      width: 150px;
    }
    .cls {
      clear: both;
    }
  </style>
  <script>
  var notAllow = " <?php echo $f;?> ";
  function GetFields()
  {
  	var theform = document.form1;
  	var fieldname = theform.fieldname.value;
  	var itemname = theform.itemname.value;
  	var dtype = 'text';
  	var enums = document.getElementsByName('dtype');
  	for(i=0;i<enums.length;i++)
  	{
  		if (enums[i].checked) dtype = enums[i].value;
  	}
  	var isnull = theform.isnull.value;
  	var vdefault = theform.vdefault.value;
  	var maxlength = theform.maxlength.value;
  	var vinnertext = theform.vinnertext.value;
  	var spage = (theform.spage[0].checked ? theform.spage[0].value : theform.spage[1].value);
  	var sisnull = (isnull==0 ? "false" : "true");
  	var autofield = (theform.autofield[0].checked ? theform.autofield[0].value : theform.autofield[1].value);
  	var islist = (theform.islist.checked ? 1 : 0);
    var notsend = (theform.notsend.checked ? 1 : 0);
    var automake = theform.relation_automake.checked ? 1 : 0;
  	if (itemname=="")
  	{
  		ShowMsg("<?php echo Lang('mychannel_err_itemname_isempty');?>");
  		theform.itemname.focus();
  		return false;
  	}
  	if (fieldname=="") 
  	{
  		ShowMsg("<?php echo Lang('mychannel_err_fieldname_isempty');?>");
  		theform.fieldname.focus();
  		return false;
  	}
  	if (notAllow.indexOf(" "+fieldname+" ") >-1 ) 
  	{
  		ShowMsg("<?php echo Lang('mychannel_err_fieldname_not_allow');?>\n"+notAllow);
  		return false;
  	}
  	if ((dtype=="radio" || dtype=="select" || dtype=="checkbox") && vdefault=="")
  	{
  		ShowMsg("<?php echo Lang('mychannel_err_fieldname_dtype');?>");
  		return false;
  	}
    if (spage=="no") spage = "";
    relstr = "";
    if (dtype==="relation") {
      relstr = " automake=\""+automake+"\" channel=\""+$("#channeltype").val()+"\"";
    }
  	revalue =  "<field:"+fieldname+" itemname=\""+itemname+"\" autofield=\""+autofield+"\" notsend=\""+notsend+"\" type=\""+dtype+"\"";
  	revalue += relstr + " isnull=\""+sisnull+"\" islist=\""+islist+"\" default=\""+vdefault+"\" ";
  	revalue += " maxlength=\""+maxlength+"\" page=\""+spage+"\">"+vinnertext+"</field:"+fieldname+">";
  	document.form1.fieldstring.value = revalue;
    return true;
  }
  $(document).ready(function () {
    $("#dataType input").click(function(ele){
      if ($(ele.currentTarget).val() === "relation") {
        $("#_relation").show();
      } else {
        $("#_relation").hide();
      }
    })
  });
  </script>
</head>
<body>
<form name="form1" action="mychannel_field_add.php" method="post" onSubmit="return GetFields();">
<input type="hidden" name="action" value="save">
<input type="hidden" name="id" value="<?php echo $id?>">
<input type="hidden" name="fieldstring" value="">
<table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
    <tr> 
      <td bgcolor="#f8f8f8" colspan="2">
        <table width="98%" cellspacing="0" cellpadding="0" class="table table-borderless">
          <tr> 
            <td width="30%"><a href="mychannel_main.php"><?php echo Lang('mychannel_main');?></a> &gt; <?php echo Lang('mychannel_field_add');?></td>
            <td width="70%" align="right">
							<button type="button" name="ss1" onClick="location='mychannel_edit.php?id=<?php echo $id?>&dopost=edit';" class="btn btn-success btn-sm"><?php echo Lang('mychannel_current_channel');?></button>
							<button type="button" name="ss12" onClick="location='mychannel_main.php';" class="btn btn-success btn-sm"><?php echo Lang('mychannel_main');?></button>
						</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="2">
        <div class="alert alert-danger mb-0"><?php echo Lang('mychannel_current_channel_tip');?></div>
      </td>
    </tr>
    <tr> 
      <td width="30%"><?php echo Lang('mychannel_itemname');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_itemname_tip');?></span></td>
        <td><input type="text" name="itemname" id="itemname" class="pubinputs"> *</td>
    </tr>
    <tr> 
      <td><?php echo Lang('mychannel_fieldname');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_itemname_tip',array('link'=>"<a href='stepselect_main.php' target='_blank'>[组名称]</a>"));?></span></td>
      <td><input type="text" name="fieldname" id="fieldname" class="pubinputs"></td>
    </tr>
    <tr>
      <td><?php echo Lang('mychannel_autofield');?>：</td>
      <td>
	      <label><input type="radio" name="autofield" value="1" checked="checked"> <?php echo Lang('mychannel_autofield_1_tip');?></label>
        <label><input type="radio" name="autofield" value="0"> <?php echo Lang('mychannel_autofield_0_tip');?></label>
      </td>
    </tr>
    <tr>
      <td><?php echo Lang('mychannel_foreground_parameters');?>：</td>
      <td>
        <label><input type="checkbox" name="islist" id="islist" value="1"> <?php echo Lang('mychannel_field_islist');?></label><br>
        <label><input type="checkbox" name="notsend" id="notsend" value="1"> <?php echo Lang('mychannel_field_notsend');?></label>
     </td>
    </tr>
    <tr> 
      <td><?php echo Lang('mychannel_field_spage');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_field_spage_tip');?></span></td>
      <td>
      	<input type="hidden" name="isnull" value="1">
        <label><input type="radio" name="spage" value="split"> <?php echo Lang('yes');?></label>
        <label><input type="radio" name="spage" value="no" checked="1"> <?php echo Lang('no');?></label>
     </td>
    </tr>
    <tr> 
      <td><?php echo Lang('mychannel_datatype');?>：</td>
      <td id="dataType">
        <div class="nw"><label><input type="radio" name="dtype" id="dtype1" value="text" checked='1'> <?php echo Lang('mychannel_fieldtype_text');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype2" value="textchar"> <?php echo Lang('mychannel_fieldtype_textchar');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype3" value="multitext"> <?php echo Lang('mychannel_fieldtype_multitext');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype4" value="htmltext"> <?php echo Lang('mychannel_fieldtype_htmltext');?></label></div>
        <br class="cls">
        <div class="nw"><label><input type="radio" name="dtype" id="dtype5" value="textdata"> <?php echo Lang('mychannel_fieldtype_textdata');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype6" value="int"> <?php echo Lang('mychannel_fieldtype_int');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype7" value="float"> <?php echo Lang('mychannel_fieldtype_float');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype8" value="datetime"> <?php echo Lang('mychannel_fieldtype_datetime');?></label></div>
        <br class="cls">
        <div class="nw"><label><input type="radio" name="dtype" id="dtype9" value="img"> <?php echo Lang('mychannel_fieldtype_img');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype10" value="imgfile"> <?php echo Lang('mychannel_fieldtype_imgfile');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype11" value="media"> <?php echo Lang('mychannel_fieldtype_media');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype12" value="addon"> <?php echo Lang('mychannel_fieldtype_addon');?></label></div>
        <br class="cls">
        <div class="nw"><label><input type="radio" name="dtype" id="dtype13" value="select"> <?php echo Lang('mychannel_fieldtype_select');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype14" value="radio"> <?php echo Lang('mychannel_fieldtype_radio');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype15" value="checkbox"> <?php echo Lang('mychannel_fieldtype_checkbox');?></label></div>
        <div class="nw"><label><input type="radio" name="dtype" id="dtype16" value="stepselect"> <?php echo Lang('mychannel_fieldtype_stepselect');?></label></div>
        <br class="cls">
        <div class="nw"><label><input type="radio" name="dtype" id="dtype16" value="relation"> <?php echo Lang('mychannel_fieldtype_relation');?></label></div>
       </td>
    </tr>
    <tr id="_relation" style="display:none"> 
      <td><?php echo Lang('mychannel');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_select');?></span>
      </td>
      <td> 
        <select name="channeltype" id="channeltype" style="width:260px">
          <?php
            $channelid = 1;
            foreach($channelArray as $k=>$arr)
            {
              if ($k==$channelid) {
                  $nid = $arr['nid'];
                  echo "<option value='{$k}' selected>{$arr['typename']}|{$arr['nid']}</option>";
              } else {
                  echo "<option value='{$k}'>{$arr['typename']}|{$arr['nid']}</option>";
              }
            }
          ?>
        </select>
        <label><input type="checkbox" name="relation_automake" id="relation_automake" value="1"> <?php echo Lang('mychannel_field_relation_tip');?></label>
      </td>
    </tr>
    <tr> 
      <td><?php echo Lang('mychannel_field_vdefault');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_field_vdefault_tip');?></span></td>
      <td><textarea name="vdefault" id="vdefault" style="width:70%;height:60px"></textarea></td>
    </tr>
    <tr> 
      <td><?php echo Lang('mychannel_field_maxlength');?>：<br>
        <span class="style2"><?php echo Lang('mychannel_field_maxlength_tip');?></span></td>
      <td><input type="text" name="maxlength" id="maxlength" class="pubinputs" value="250" style="width:80px"></td>
    </tr>
    <tr>
      <td><?php echo Lang('mychannel_field_vinnertext');?>：</td>
      <td><?php echo Lang('mychannel_field_vinnertext_tip');?></td>
    </tr>
    <tr> 
      <td></td>
      <td><textarea name="vinnertext" cols="45" rows="5" id="vinnertext" style="width:70%;height:120px"></textarea></td>
    </tr>
    <tr> 
      <td align="center" colspan="2" bgcolor="#f8f8f8" class="py-2">
        <button type="submit" name="button1" id="button1" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
        <button type="reset" name="button2" id="button2" class="btn btn-success btn-sm"><?php echo Lang('reset');?></button>
      </td>
    </tr>
  </table>
</form>
</body>
</html>