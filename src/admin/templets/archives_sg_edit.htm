<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>修改分类模型</title>
		<link rel="stylesheet" href="/static/web/css/font-awesome.min.css">
		<link rel="stylesheet" href="/static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="/static/web/css/admin.css">
		<link rel="stylesheet" href="/static/web/css/daterangepicker.css">
		<link rel="stylesheet" href="/static/web/css/cropper.min.css">
		<script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut;?>';</script>
		<script src="/static/web/js/jquery.min.js"></script>
		<script src="/static/web/js/bootstrap.min.js"></script>
		<script src="/static/web/js/webajax.js"></script>
		<script src="/static/web/js/moment.min.js"></script>
		<script src="/static/web/js/daterangepicker.js"></script>
		<script src="/static/web/js/cropper.min.js"></script>
		<script src="/static/web/js/admin.main.js"></script>
	</head>
	<body>
		<form name="form1" action="archives_sg_edit.php" method="post" enctype="multipart/form-data" onSubmit="return checkSubmit();">
			<input type="hidden" name="channelid" value="<?php echo $channelid;?>">
			<input type="hidden" name="id" value="<?php echo $aid;?>">
			<input type="hidden" name="sortrank" value="<?php echo $addRow['senddate'];?>">
			<input type="hidden" name="dopost" value="save">
			<table width="98%" align="center" class="maintable my-3">
				<tr>
					<td bgcolor="#f8fafb" class="admin-td">修改分类文档</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table>
							<tr>
								<td width="120"><?php echo $cInfos['titlename'];?>：</td>
								<td><input type="text" name="title" id="title" value="<?php echo $addRow['title'];?>" class="admin-input-lg"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table>
							<tr>
								<td width="120">自定义属性：</td>
								<td>
									<?php
									$dsql->SetQuery("SELECT * FROM `#@__arcatt` WHERE att<>'j' AND att<>'p' ORDER BY sortid ASC");
									$dsql->Execute();
									while($trow = $dsql->GetObject())
									{
										if (preg_match("#".$trow->att."#", $addRow['flag']))
											echo "<label><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' checked='checked'> {$trow->attname}[{$trow->att}]</label> ";
										else
											echo "<label><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'> {$trow->attname}[{$trow->att}]</label> ";
									}
									?>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="pictable" style="<?php if ($cInfos['needpic']==0) echo 'display:none';?>">
					<td class="admin-td">
						<table>
							<tr>
								<td width="120">缩略图：</td>
								<td width="670">
									<input type="text" name="picname" id="picname" class="admin-input-lg" value="<?php echo $addRow['litpic']?>">
									<label><input type="checkbox" name="ddisremote" value="1" id="ddisremote"> 远程图片</label>
									<span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
									<button type="button" name="submit" onclick="SelectImage('form1.picname','');" class="btn btn-success btn-sm">选择图片</button>
									<button type="button" id="btnClearAll" class="btn btn-success btn-sm">清空</button>
								</td>
								<td><img src="<?php if ($addRow['litpic']!='') echo $addRow['litpic']; else echo '/static/web/img/thumbnail.jpg';?>" id="litPic" class="thumbnail-md"></td>
							</tr>
						</table>
					</td>
				</tr>
				<?php
				if ($cInfos['dfcid']>0) {
					echo "<input type='hidden' name='typeid' value='{$cInfos['dfcid']}'>";
				} else {
				?>
				<tr>
					<td class="admin-td">
						<table>
							<tr>
								<td width="120">发布栏目：</td>
								<td width="360">
									<?php
									$typeOptions = GetOptionList($addRow['typeid'],$cuserLogin->getUserChannel(),$channelid);
									echo "<select name='typeid' id='typeid' class='admin-input-sm'>";
									if ($addRow["typeid"]=="0") echo "<option value='0' selected>请选择文档栏目</option>";
									echo $typeOptions;
									echo "</select>";
									?>
									<a onclick="ShowCatMap(event,this,<?php echo $channelid;?>,'typeid','<?php echo $addRow['typeid'];?>')" title="选择主栏目" class="btn btn-success btn-sm"><i class="fa fa-search"></i></a>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table>
							<tr>
								<td width="120">浏览权限：</td>
								<td width="360">
									<select name="arcrank" id="arcrank" class="admin-input-sm">
										<option value='<?php echo $addRow["arcrank"];?>'><?php echo $addRow["rankname"];?></option>
										<?php
										$urank = $cuserLogin->getUserRank();
										$dsql->SetQuery("SELECT * FROM `#@__arcrank` where adminrank<='$urank' And `rank`<>'{$addRow["arcrank"]}' ");
										$dsql->Execute();
										while($row = $dsql->GetObject()) {
											echo "<option value='".$row->rank."'>".$row->membername."</option>";
										}
										?>
									</select>
									<span>（不支持静态）</span>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<?php }?>
				<?php PrintAutoFieldsEdit(stripslashes($cInfos['fieldset']),$addRow,'autofield');?>
				<tr>
					<td bgcolor="#f8fafb" align="center" class="admin-td">
						<button type="submit" class="btn btn-success btn-sm">保存</button>
						<button type="button" class="btn btn-outline-success btn-sm" onclick="location.reload();">重置</button>
					</td>
				</tr>
			</table>
		</form>
		<script>
			function checkSubmit() {
				if (document.form1.title.value == "") {
					ShowMsg("文档标题不能为空");
					document.form1.title.focus();
					return false;
				}
			}
		</script>
	</body>
</html>