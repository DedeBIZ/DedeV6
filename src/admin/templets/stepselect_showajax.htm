<?php
if ($action=='edit') {
	$arr = $dsql->GetOne("SELECT * FROM `#@__stepselect` WHERE id='$id' ");
	$sbjs = " onsubmit=\"alert('该分类是系统内置枚举，不允许修改'); return false;\" ";
	if ($arr['issystem']==0) $sbjs = '';
?>
<span class="float-left">修改类别</span>
<span class="float-right"><a class="btn btn-success btn-sm" href="javascript:;" onclick="javascript:CloseTWin();">关闭</a></span>
<br style="clear:both">
<form action="stepselect_main.php" method="post" <?php echo $sbjs;?>>
	<input type="hidden" name="action" value="edit_save">
	<input type="hidden" name="id" value="<?php echo $arr['id'];?>">
	<div class="py-2">类别名：<input type="text" name="itemname" value="<?php echo $arr['itemname'];?>" class="biz-input-md"></div>
	<div class="py-2">缓存组名：<input type="text" name="egroup" value="<?php echo $arr['egroup'];?>" class="biz-input-md"></div>
	<div class="py-2">缓存组名必须为英文或数字组合</div>
	<div><button type="submit" class="btn btn-success btn-sm">保存</button></div>
</form>
<?php
} else if ($action=='addnew') {
?>
<span class="float-left">新增类别</span>
<span class="float-right"><a class="btn btn-success btn-sm" href="javascript:;" onclick="javascript:CloseTWin();">关闭</a></span>
<br style="clear:both">
<form action="stepselect_main.php" method="post">
	<input type="hidden" name="action" value="addnew_save">
	<div class="py-2">类别名：<input type="text" name="itemname" class="biz-input-md"></div>
	<div class="py-2">缓存组名：<input type="text" name="egroup" class="biz-input-md"></div>
	<div class="py-2">缓存组名必须为英文或数字组合</div>
	<div><button type="submit" class="btn btn-success btn-sm">保存</button></div>
</form>
<?php
} else if ($action=='addenum') {
	$arr = $dsql->GetOne("SELECT * FROM `#@__stepselect` WHERE id='$id' ");
	$dsql->Execute('out',"SELECT evalue,ename FROM `#@__sys_enum` WHERE egroup='{$arr['egroup']}' AND (evalue mod 500)=0 ORDER BY disorder ASC,evalue ASC");
	$options = '';
	if ($arr['issign']==0)
	{
		while($row1 = $dsql->GetArray('out')) $options .= "<option value='{$row1['evalue']}'>{$row1['ename']}</option>";
	}
?>
<span class="float-left">添加枚举</span>
<span class="float-right"><a class="btn btn-success btn-sm" href="javascript:;" onclick="javascript:CloseTWin();">关闭</a></span>
<br style="clear:both">
<form action="stepselect_main.php" method="post">
	<input type="hidden" name="action" value="addenum_save">
	<input type="hidden" name="issign" value="<?php echo $arr['issign'];?>">
	<input type="hidden" name="egroup" value="<?php echo $arr['egroup'];?>">
	<div class="py-2">
		隶属枚举：<select name="topvalue" class="biz-input-md">
			<option value="0">保存一级枚举</option>
			<?php echo $options;?>
		</select>
	</div>
	<div class="py-2">枚举名：<input type="text" name="ename" class="biz-input-md"></div>
	<div class="py-2">排序值：<input type="text" name="disorder" class="biz-input-md"></div>
	<div class="py-2">如果不指定，默认以枚举添加先后来排序</div>
	<div><input type="submit" value="保存" class="btn btn-success btn-sm"></div>
</form>
<?php
} else if ($action=='view') {
		$arr = $dsql->GetOne("SELECT * FROM `#@__stepselect` WHERE id='$id' ");
		$dsql->Execute('out',"SELECT * FROM `#@__sys_enum` where egroup like '{$arr['egroup']}' order by disorder asc, evalue asc");
		$options = '';
	while($row1 = $dsql->GetArray('out')) 
	{
		if ($row1['evalue']%500==0 || $arr['issign']==1)
		{
			$options .= "<option value='{$row1['evalue']}'>└─ {$row1['ename']}</option>";
		} else {
			$options .= "<option value='{$row1['evalue']}'>└── {$row1['ename']}</option>";
		}
	}
?>
<span class="float-left">预览联动表单</span>
<span class="float-right"><a class="btn btn-success btn-sm" href="javascript:;" onclick="javascript:CloseTWin();">关闭</a></span>
<br style="clear:both">
<div class="py-2">
	类别关系：
	<select name="topvalue" class="biz-input-md">
		<option value="0">请选择</option>
		<?php echo $options;?>
	</select>
	<br>
	这里仅显示数据关系，实际应用中，二级联动生成的表单是支持级连的，并非全部列出
</div>
<br style="clear:both">
<?php }?>