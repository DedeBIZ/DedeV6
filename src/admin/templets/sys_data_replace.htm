<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title><?php echo Lang('sys_data_replace');?></title>
		<?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/admin.min.css">
		<script src="../static/web/js/jquery.min.js"></script>
		<script src="../static/web/js/bootstrap.bundle.min.js"></script>
		<script src="js/main.js"></script>
		<script src='../static/web/js/webajax.js'></script>
		<script>
			function ShowFields() {
				var exptable = $DE('exptable').options[$DE('exptable').selectedIndex].value;
				var queryUrl = "sys_data_replace.php?exptable=" + exptable + "&action=getfields";
				fetch(queryUrl).then(resp => {
					if (resp.ok) {
						return resp.text()
					}
					throw new Error('x');
				}).then((d) => {
					$DE('fields').innerHTML = d;
				}).catch((error) => {
					$DE('fields').innerHTML = errMsg;
				});
			}
			function CheckSubmit() {
				if ($DE('rpfield').value == "") {
					ShowMsg("<?php echo Lang('sys_data_err_rpfield');?>");
					return false;
				}
				if ($DE('rpstring').value == "") {
					ShowMsg("<?php echo Lang('sys_data_err_rpstring');?>");
					return false;
				}
				return true;
			}
			function pf(v) {
				$DE('rpfield').value = v;
			}
		</script>
	</head>
	<body>
		<table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
			<form action="sys_data_replace.php" name="form1" method="post" target="stafrm" onSubmit="return CheckSubmit()">
				<input type="hidden" name="action" value="apply">
				<tr>
					<td bgcolor="#f8f8f8"><?php echo Lang('sys_data_replace');?></td>
				</tr>
				<tr>
					<td>
						<table width="100%" cellpadding="2" cellspacing="2" class="table table-borderless">
							<tr>
								<td colspan="2">
									<div class="alert alert-info mb-0"><?php echo Lang('sys_data_replace_tip');?></div>
								</td>
							</tr>
							<tr id="datasel">
								<td width="260px"><?php echo Lang('sys_data_datasel');?>：</td>
								<td class="p-0">
									<table width="98%" cellspacing="0" cellpadding="0">
										<tr>
											<td id="tables">
												<?php
												$dsql->SetQuery("Show Tables");
												$dsql->Execute('t');
												if ($dsql->GetError()!=''){
													echo "<span class='text-danger'>".Lang('sys_data_err_noneexists')." $dbname</span><br>";
													echo $qbutton;
												}
												echo "<select name='exptable' id='exptable' style='width:60%' onchange='ShowFields()'>";
												while($row = $dsql->GetArray('t',PDO::FETCH_BOTH)){
													echo "<option value='{$row[0]}'>{$row[0]}</option>";
												}
												echo "</select>";
												$dsql->Close();
												?>
											</td>
										</tr>
										<tr>
											<td id="fields"></td>
										</tr>
										<tr>
											<td><?php echo Lang('sys_data_rpfield');?>：<input type="text" name="rpfield" id="rpfield"></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr bgcolor="#f8fcf2">
								<td><?php echo Lang('sys_data_rptype');?>：</td>
								<td>
									<label><input type="radio" name="rptype" id="ot1" value="replace" checked="1"> <?php echo Lang('sys_data_rptype_replace');?></label>
									<label><input type="radio" name="rptype" id="ot2" value="regex"> <?php echo Lang('sys_data_rptype_regex');?></label>
									<?php echo Lang('sys_data_keyfield');?>：<input type="text" name="keyfield" id="keyfield" style="width:60px"> <?php echo Lang('sys_data_keyfield_tip');?>
								</td>
							</tr>
							<tr>
								<td><?php echo Lang('sys_data_rpstring');?>：</td>
								<td><textarea name="rpstring" id="rpstring" style="width:60%;height:50px"></textarea></td>
							</tr>
							<tr>
								<td><?php echo Lang('sys_data_tostring');?>：</td>
								<td><textarea name="tostring" id="tostring" style="width:60%;height:50px"></textarea></td>
							</tr>
							<tr>
								<td><?php echo Lang('sys_data_condition');?>：</td>
								<td><input type="text" name="condition" id="condition" style="width:60%"><?php echo Lang('sys_data_condition_tip');?></td>
							</tr>
							<tr>
								<td><?php echo Lang('validate');?>：</td>
								<td>
									<input type="text" name="validate" style="width:80px;text-transform:uppercase">
									<img src="../apps/vdimgck.php" style="vertical-align:middle;cursor:pointer" onClick="this.src='../apps/vdimgck.php?'+new Date().getTime()+Math.round(Math.random() * 10000)" title="验证码">
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td align="center" bgcolor="#f8fcf2" class="py-2">
						<button type="submit" name="Submit" class="btn btn-success btn-sm"><?php echo Lang('sys_data_start');?></button>
					</td>
				</tr>
			</form>
			<tr>
				<td>
					<table width="100%" class="table table-borderless">
						<tr>
							<td width="30%"><?php echo Lang('result');?>：</td>
							<td width="70%" align="right"></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td id="mtd">
					<div id="mdv" style="width:100%;height:360px"><iframe name="stafrm" frameborder="0" id="stafrm" width="100%" height="100%"></iframe></div>
				</td>
			</tr>
		</table>
	</body>
</html>