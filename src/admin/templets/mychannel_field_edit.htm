<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('mychannel_field_edit');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <style>
    .style1 {
      color: #FF3300
    }
    .style2 {
      color: #545b62
    }
    .nw {
      float: left;
      width: 150px;
    }
    .cls {
      clear: both;
    }
  </style>
  <script>
    function GetFields() {
      var theform = document.form1;
      var itemname = theform.itemname.value;
      var fieldname = theform.fname.value;
      var dtype = theform.dtype.value;
      var isnull = theform.isnull.value;
      var vdefault = theform.vdefault.value;
      var maxlength = theform.maxlength.value;
      var vinnertext = theform.vinnertext.value;
      var spage = (theform.spage[0].checked ? theform.spage[0].value : theform.spage[1].value);
      var sisnull = (isnull == 0 ? "false" : "true");
      var autofield = (theform.autofield[0].checked ? theform.autofield[0].value : theform.autofield[1].value);
      var islist = (theform.islist.checked ? 1 : 0);
      var notsend = (theform.notsend.checked ? 1 : 0);
      if (itemname == "") {
        ShowMsg("<?php echo Lang('mychannel_err_itemname_isempty');?>");
        theform.itemname.focus();
        return false;
      }
      if ((dtype == "radio" || dtype == "select" || dtype == "checkbox") && vdefault == "") {
        ShowMsg("<?php echo Lang('mychannel_err_fieldname_dtype');?>");
        return false;
      }
      if (spage == "no") spage = "";
      relstr = "";
      if (dtype==="relation") {
        relstr = " automake=\""+automake+"\" channel=\""+$("#channeltype").val()+"\"";
      }
      revalue = "<field:" + fieldname + " itemname=\"" + itemname + "\" autofield=\"" + autofield + "\" notsend=\"" + notsend + "\" type=\"" + dtype + "\"";
      revalue += relstr + " isnull=\"" + sisnull + "\" islist=\"" + islist + "\" default=\"" + vdefault + "\" ";
      revalue += " maxlength=\"" + maxlength + "\" page=\"" + spage + "\">" + vinnertext + "</field:" + fieldname + ">";
      document.form1.fieldstring.value = revalue;
      return true;
    }
    $(document).ready(function () {
      $("#type").change(function (ele) {
        if ($(ele.currentTarget).val() === "relation") {
          $("#_relation").show();
        } else {
          $("#_relation").hide();
        }
      })
    });
  </script>
</head>
<body>
  <table width="98%" align="center" cellpadding="1" cellspacing="1" class="table maintable mt-3 mb-3">
    <form name="form1" action="mychannel_field_edit.php" method="post" onSubmit="return GetFields();">
      <input type="hidden" name="action" value="save">
      <input type="hidden" name="id" value="<?php echo $id?>">
      <input type="hidden" name="fname" value="<?php echo $fname?>">
      <input type="hidden" name="issystem" value="<?php echo $issystem?>">
      <input type="hidden" name="fieldstring" value="">
      <tr>
        <td bgcolor="#f8f8f8" colspan="2">
          <table width="98%" cellspacing="0" cellpadding="0" class="table table-borderless">
            <tr>
              <td width="30%"><a href="mychannel_main.php"><?php echo Lang('mychannel_main');?></a> &gt; <?php echo Lang('mychannel_field_edit');?></td>
              <td width="70%" align="right">
                <button type="button" name="ss1" class="btn btn-success btn-sm" onClick="location='mychannel_edit.php?id=<?php echo $id?>&dopost=edit';"><?php echo Lang('mychannel_current_channel');?></button>
                <button type="button" name="ss12" onClick="location='mychannel_main.php';" class="btn btn-success btn-sm"><?php echo Lang('mychannel_main');?></button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <?php if ($row['issystem']==1){?>
      <tr>
        <td colspan="2">
          <span class="style1"><?php echo Lang('mychannel_field_edit_issystem_tip');?></span>
        </td>
      </tr>
      <?php }?>
      <tr>
        <td><?php echo Lang('mychannel_itemname');?>：<br>
          <span class="style2"><?php echo Lang('mychannel_itemname_tip');?></span></td>
        <td><input type="text" name="itemname" id="itemname" value="<?php echo $ctag->GetAtt('itemname')?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td width="28%"><?php echo Lang('mychannel_fieldname');?>：<br>
          <span class="style2"><?php echo Lang('mychannel_fieldname_tip2');?></span></td>
        <td width="72%" style="table-layout:fixed;word-break:break-all"><?php echo $fname?></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_autofield');?>：</td>
        <td>
          <label><input type="radio" name="autofield" value="1" checked="checked" <?php echo ($ctag->GetAtt('autofield')==1 ? " checked":"");  ?>> <?php echo Lang('mychannel_autofield_1_tip');?></label>
          <label><input type="radio" name="autofield" value="0" <?php echo ( ($ctag->GetAtt('autofield')==''||$ctag->GetAtt('autofield')=='0') ? " checked":"");  ?>> <?php echo Lang('mychannel_autofield_0_tip');?></label></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_foreground_parameters');?>：</td>
        <td>
          <label><input type="checkbox" name="islist" id="islist" value="1" <?php echo ($ctag->GetAtt('islist')==1 ? " checked":"");  ?>> <?php echo Lang('mychannel_field_islist');?></label><br>
          <label><input type="checkbox" name="notsend" id="notsend" value="1" <?php echo ($ctag->GetAtt('notsend')==1 ? " checked":"");  ?> /> <?php echo Lang('mychannel_field_notsend');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_datatype');?>：</td>
        <td>
          <select name="dtype" id="type" style="width:260px">
            <?php 
            $dtype = $ctag->GetAtt('type');
            if ($dtype!='' && isset($fieldtypes[$dtype]))
            {
            	echo "<option value='{$dtype}'>{$fieldtypes[$dtype]}</option>";
            	$canchange = true;
            } else {
            	echo "<option value='{$dtype}'>".Lang('mychannel_field_system')."</option>";
            	$canchange = false;
            }
            if ($canchange)
            {
            ?>
            <option value="text"><?php echo Lang('mychannel_fieldtype_text');?></option>
            <option value="textchar"><?php echo Lang('mychannel_fieldtype_textchar');?></option>
            <option value="multitext"><?php echo Lang('mychannel_fieldtype_multitext');?></option>
            <option value="htmltext"><?php echo Lang('mychannel_fieldtype_htmltext');?></option>
            <option value="textdata"><?php echo Lang('mychannel_fieldtype_textdata');?></option>
            <option value="int"><?php echo Lang('mychannel_fieldtype_int');?></option>
            <option value="float"><?php echo Lang('mychannel_fieldtype_float');?></option>
            <option value="datetime"><?php echo Lang('mychannel_fieldtype_datetime');?></option>
            <option value="img"><?php echo Lang('mychannel_fieldtype_img');?></option>
            <option value="imgfile"><?php echo Lang('mychannel_fieldtype_imgfile');?></option>
            <option value="media"><?php echo Lang('mychannel_fieldtype_media');?></option>
            <option value="addon"><?php echo Lang('mychannel_fieldtype_addon');?></option>
            <option value="select"><?php echo Lang('mychannel_fieldtype_select');?></option>
            <option value="radio"><?php echo Lang('mychannel_fieldtype_radio');?></option>
            <option value="checkbox"><?php echo Lang('mychannel_fieldtype_checkbox');?></option>
            <option value="stepselect"><?php echo Lang('mychannel_fieldtype_stepselect');?></option>
            <option value="relation"><?php echo Lang('mychannel_fieldtype_relation');?></option>
            <?php }?>
          </select>
        </td>
      </tr>
      <tr id="_relation" <?php echo $dtype=="relation"? '' : 'style="display:none"';?>> 
        <td><?php echo Lang('mychannel');?>：<br>
          <span class="style2"><?php echo Lang('mychannel_select');?></span></td>
        <td> 
          <select name="channeltype" id="channeltype" style="width:260px">
            <?php
              $channelid = $ctag->GetAtt('channel') == "" ? 1 : $ctag->GetAtt('channel');
              
              foreach($channelArray as $k=>$arr)
              {
                if ($k==$channelid) {
                    $nid = $arr['nid'];
                    echo "<option value='{$k}' selected>{$arr['typename']}|{$arr['nid']}</option>";
                } else {
                    echo "<option value='{$k}'>{$arr['typename']}|{$arr['nid']}</option>";
                }
              }
            ?>
          </select>
          <label><input type="checkbox" name="relation_automake" id="relation_automake" value="1" <?php echo $ctag->GetAtt('automake')==1? "checked" : "";?>> <?php echo Lang('mychannel_field_relation_tip');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_field_spage');?>：<br>
          <span class="style2"><?php echo Lang('mychannel_field_spage_tip');?></span></td>
        <td>
          <input name="isnull" type="hidden" value="1">
          <label><input type="radio" name="spage" value="split" <?php if ($ctag->GetAtt('page')=='split') echo 'checked="1"';?>> <?php echo Lang('yes');?></label>
          <label><input type="radio" name="spage" value="no" <?php if ($ctag->GetAtt('page')=='no'||$ctag->GetAtt('page')=='') echo 'checked="1"';?>> <?php echo Lang('no');?>/label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_field_vdefault');?>：<br>
          <span class="style2"><?php echo Lang('mychannel_field_vdefault_tip');?></span></td>
        <td><textarea name="vdefault" id="vdefault" style="width:70%;height:60px"><?php echo $ctag->GetAtt('default');?></textarea></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_field_maxlength');?>：<br>
          <span class="style2"> <?php echo Lang('mychannel_field_maxlength_tip');?> </span></td>
        <td><input type="text" name="maxlength" id="maxlength" value="<?php echo $ctag->GetAtt('maxlength')?>" style="width:80px;height:24px;padding-top:3px;"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_field_vinnertext');?>：</td>
        <td><?php echo Lang('mychannel_field_vinnertext_tip');?></td>
      </tr>
      <tr>
        <td></td>
        <td><textarea name="vinnertext" cols="45" rows="5" id="vinnertext" style="width:70%;height:120px"><?php echo $ctag->GetInnerText();?></textarea></td>
      </tr>
      <tr>
        <td align="center" colspan="2" bgcolor="#f8f8f8" class="py-2">
          <button type="submit" name="button1" id="button1" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
          <button type="reset" name="button3" id="button3" class="btn btn-success btn-sm"><?php echo Lang('reset');?></button>
        </td>
      </tr>
    </form>
  </table>
</body>
</html>