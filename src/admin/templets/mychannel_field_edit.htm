<!DOCTYPE html>
<html>
<head>
  <meta charset="<?php echo $cfg_soft_lang;?>">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>内容模型修改字段</title>
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.css">
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <style>.nw{float:left;width:160px}.cls{clear:both}</style>
  <script>
    function GetFields() {
      var theform = document.form1;
      var itemname = theform.itemname.value;
      var fieldname = theform.fname.value;
      var dtype = theform.dtype.value;
      var isnull = theform.isnull.value;
      var vdefault = theform.vdefault.value;
      var maxlength = theform.maxlength.value;
      var vinnertext = theform.vinnertext.value;
      var spage = (theform.spage[0].checked ? theform.spage[0].value : theform.spage[1].value);
      var sisnull = (isnull == 0 ? "false" : "true");
      var autofield = (theform.autofield[0].checked ? theform.autofield[0].value : theform.autofield[1].value);
      var islist = (theform.islist.checked ? 1 : 0);
      var notsend = (theform.notsend.checked ? 1 : 0);
      if (itemname == "") {
        ShowMsg("表单提示名称不能为空");
        theform.itemname.focus();
        return false;
      }
      if ((dtype == "radio" || dtype == "select" || dtype == "checkbox") && vdefault == "") {
        ShowMsg("您选择的select或radio、checkbox类型，必须默认值设置选择的项目（用逗号[,]分开）");
        return false;
      }
      if (spage == "no") spage = "";
      relstr = "";
      if (dtype==="relation") {
        relstr = " automake=\""+automake+"\" channel=\""+$("#channeltype").val()+"\"";
      }
      revalue = "<field:" + fieldname + " itemname=\"" + itemname + "\" autofield=\"" + autofield + "\" notsend=\"" + notsend + "\" type=\"" + dtype + "\"";
      revalue += relstr + " isnull=\"" + sisnull + "\" islist=\"" + islist + "\" default=\"" + vdefault + "\" ";
      revalue += " maxlength=\"" + maxlength + "\" page=\"" + spage + "\">" + vinnertext + "</field:" + fieldname + ">";
      document.form1.fieldstring.value = revalue;
      return true;
    }
    $(document).ready(function () {
      $("#type").change(function (ele) {
        if ($(ele.currentTarget).val() === "relation") {
          $("#_relation").show();
        } else {
          $("#_relation").hide();
        }
      })
    });
  </script>
</head>
<body>
  <table width="98%" cellpadding="1" cellspacing="1" align="center" class="table maintable my-3">
    <form name="form1" action="mychannel_field_edit.php" method="post" onSubmit="return GetFields();">
      <input type="hidden" name="action" value="save">
      <input type="hidden" name="id" value="<?php echo $id?>">
      <input type="hidden" name="fname" value="<?php echo $fname?>">
      <input type="hidden" name="issystem" value="<?php echo $issystem?>">
      <input type="hidden" name="fieldstring" value="">
      <tr>
        <td bgcolor="#f8f8f8" colspan="2">
          <table width="98%" cellspacing="0" cellpadding="0" class="table table-borderless">
            <tr>
              <td width="30%"><a href="mychannel_main.php">内容模型管理</a> &gt; 查看修改字段</td>
              <td width="70%" align="right">
                <button type="button" name="ss1" class="btn btn-success btn-sm" onClick="location='mychannel_edit.php?id=<?php echo $id?>&dopost=edit';">当前模型信息</button>
                <button type="button" name="ss12" onClick="location='mychannel_main.php';" class="btn btn-success btn-sm">内容模型管理</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <?php if ($row['issystem']==1){?>
      <tr>
        <td colspan="2"><div class="alert alert-danger mb-0">您当前操作的字段属于系统模型字段：修改系统模型有风险，请不要随便改动系统模型的字段相关的属性</div></td>
      </tr>
      <?php }?>
      <tr>
        <td>表单提示文字：<br>
          <span>发布内容时显示的提示文字</span></td>
        <td><input type="text" name="itemname" id="itemname" value="<?php echo $ctag->GetAtt('itemname')?>"> *（发布内容时显示的项名字）</td>
      </tr>
      <tr>
        <td width="30%">字段名称：<br>
          <span>只能用英文字母或数字，数据表的真实字段名</span></td>
        <td width="70%" style="table-layout:fixed;word-break:break-all"><?php echo $fname?></td>
      </tr>
      <tr>
        <td>字段类型：</td>
        <td>
          <label><input type="radio" name="autofield" value="1" checked="checked" <?php echo ($ctag->GetAtt('autofield')==1 ? " checked":"");?>> 系统自动生成表单字段</label>
          <label><input type="radio" name="autofield" value="0" <?php echo ( ($ctag->GetAtt('autofield')==''||$ctag->GetAtt('autofield')=='0') ? " checked":"");?>> 已经固化在发布表单中字段</label></td>
      </tr>
      <tr>
        <td>前台参数：</td>
        <td>
          <label><input type="checkbox" name="islist" id="islist" value="1" <?php echo ($ctag->GetAtt('islist')==1 ? " checked":"");?>> 使字段可以在列表的底层模板中获得（自定义字段默认仅能在文档模板显示，启用此选项将使列表查询变慢，如无必要请不要选择）</label><br>
          <label><input type="checkbox" name="notsend" id="notsend" value="1" <?php echo ($ctag->GetAtt('notsend')==1 ? " checked":"");?> /> 前台投稿及采集规则禁用本字段</label>
        </td>
      </tr>
      <tr>
        <td>数据类型：</td>
        <td>
          <select name="dtype" id="type" class="biz-input-md">
            <?php 
            $dtype = $ctag->GetAtt('type');
            if ($dtype!='' && isset($fieldtypes[$dtype]))
            {
            	echo "<option value='{$dtype}'>{$fieldtypes[$dtype]}</option>";
            	$canchange = true;
            } else {
            	echo "<option value='{$dtype}'>系统专用类型</option>";
            	$canchange = false;
            }
            if ($canchange)
            {
            ?>
            <option value="text">单行文本(varchar)</option>
            <option value="textchar">单行文本(char)</option>
            <option value="multitext">多行文本</option>
            <option value="htmltext">HTML文本</option>
            <option value="textdata">文本保存HTML数据</option>
            <option value="int">整数类型</option>
            <option value="float">小数类型</option>
            <option value="datetime">时间类型</option>
            <option value="img">图片</option>
            <option value="imgfile">图片(仅网址)</option>
            <option value="media">多媒体文件</option>
            <option value="addon">附件类型</option>
            <option value="select">使用option下拉框</option>
            <option value="radio">使用radio选项卡</option>
            <option value="checkbox">checkbox多选框</option>
            <option value="stepselect">联动类型</option>
            <option value="relation">关联内容</option>
            <?php }?>
          </select>
        </td>
      </tr>
      <tr id="_relation" <?php echo $dtype=="relation"? '' : 'style="display:none"';?>> 
        <td>内容模型：<br>
          <span>选择关联内容对应的内容模型</span></td>
        <td> 
          <select name="channeltype" id="channeltype" class="biz-input-md">
            <?php
              $channelid = $ctag->GetAtt('channel') == "" ? 1 : $ctag->GetAtt('channel');
              
              foreach($channelArray as $k=>$arr)
              {
                if ($k==$channelid) {
                    $nid = $arr['nid'];
                    echo "<option value='{$k}' selected>{$arr['typename']}|{$arr['nid']}</option>";
                } else {
                    echo "<option value='{$k}'>{$arr['typename']}|{$arr['nid']}</option>";
                }
              }
            ?>
          </select>
          <label><input type="checkbox" name="relation_automake" id="relation_automake" value="1" <?php echo $ctag->GetAtt('automake')==1? "checked" : "";?>> 发布时候自动更新关联内容HTML</label>
        </td>
      </tr>
      <tr>
        <td>内容是否需要分页符：<br>
          <span>如果内容需要分页符，不论何种内容，都可以用#P#副标题#e#作为分页符号实现内容分页，但一个模型里仅允许一个这样的字段!</span></td>
        <td>
          <input name="isnull" type="hidden" value="1">
          <label><input type="radio" name="spage" value="split" <?php if ($ctag->GetAtt('page')=='split') echo "checked='1'";?>> 是</label>
          <label><input type="radio" name="spage" value="no" <?php if ($ctag->GetAtt('page')=='no'||$ctag->GetAtt('page')=='') echo "checked='1'";?>> 否</label>
        </td>
      </tr>
      <tr>
        <td>默认值：<br>
          <span>如果定义数据类型为select、radio、checkbox时，此处填写被选择的项目（用“,”分开，如“男,女,人妖”）如果为联动选框，这里填写联动选框项目名称</span></td>
        <td><textarea name="vdefault" id="vdefault" class="biz-textarea"><?php echo $ctag->GetAtt('default');?></textarea></td>
      </tr>
      <tr>
        <td>最大长度：<br>
          <span>文本数据必须填写，大于255为text类型</span></td>
        <td><input type="text" name="maxlength" id="maxlength" value="<?php echo $ctag->GetAtt('maxlength')?>" class="biz-input-xs"></td>
      </tr>
      <tr>
        <td>自定义表单HTML：</td>
        <td>自定义表单HTML用~name~表示提示文字，~form~表示表单元素</td>
      </tr>
      <tr>
        <td align="center"><br> </td>
        <td><textarea name="vinnertext" id="vinnertext" class="biz-textarea"><?php echo $ctag->GetInnerText();?></textarea></td>
      </tr>
      <tr>
        <td colspan="2" bgcolor="#f8f8f8" align="center" class="py-2">
          <button type="submit" name="button1" id="button1" class="btn btn-success btn-sm">保存</button>
          <button type="reset" name="button3" id="button3" class="btn btn-success btn-sm">重置</button>
        </td>
      </tr>
    </form>
  </table>
</body>
</html>