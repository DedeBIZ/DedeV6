<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('mychannel_edit');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <link rel="stylesheet" href="css/codemirror.css">
  <script src="js/codemirror.js"></script>
  <script src="js/mode/xml/xml.js"></script>
  <script src="js/mode/javascript/javascript.js"></script>
  <script src="js/mode/css/css.js"></script>
  <script src="js/mode/htmlmixed/htmlmixed.js"></script>
  <script>
    function Nav() {
      if (window.navigator.userAgent.indexOf("MSIE") >= 1) return 'IE';
      else if (window.navigator.userAgent.indexOf("Firefox") >= 1) return 'FF';
      else return "OT";
    }
    function $Obj(objname) {
      return document.getElementById(objname);
    }
    function ShowHide2(objname) {
      var obj = $Obj(objname);
      if (obj.style.display != 'block') { obj.style.display = 'block' }
      else { obj.style.display = 'none'; }
    }
    //删除
    function DelNote(gourl) {
      if (!window.confirm("<?php echo Lang('mychannel_confirm_delete_field');?>")) { return false; }
      location.href = gourl;
    }
    function ShowObj(objname) {
      var obj = document.getElementById(objname);
      if (Nav() == 'IE') { obj.style.display = "block"; obj.style.display = "block"; }
      else obj.style.display = "table";
    }
    function HideObj(objname) {
      var obj = document.getElementById(objname);
      obj.style.display = "none";
    }
    function ShowItem1() {
      ShowObj('head1'); ShowObj('needset');
      HideObj('head2'); HideObj('adset');
    }
    var editor = null;
    function ShowItem2() {
      setTimeout(() => {
        if (!editor) {
          editor = CodeMirror.fromTextArea(document.getElementById('fieldset'), {
          lineNumbers: true,
          lineWrapping: true,
          mode: 'text/html'
        });
        }
      }, 100);
      ShowObj('head2'); ShowObj('adset');
      HideObj('head1'); HideObj('needset');
    }
  </script>
</head>
<body>
  <form name="form1" action="mychannel_edit.php" method="post">
    <input type="hidden" name="id" value="<?php echo $id?>">
    <input type="hidden" name="dopost" value="save">
    <input type="hidden" name="issystem" value="<?php echo $row['issystem'];?>">
    <table width="98%" align="center" cellpadding="3" cellspacing="1" class="mt-3 mb-3">
      <tr>
        <td><i class="fa fa-map-marker"></i> <a href="mychannel_main.php"><?php echo Lang('mychannel_main');?></a> &gt; <?php echo Lang('mychannel_edit');?></td>
      </tr>
    </table>
    <table width="98%" align="center" cellspacing="0" id="head1" cellpadding="0" style="display:block">
      <tr>
        <td colspan="2">
          <table cellpadding="0" cellspacing="0">
            <tr>
              <td width="90" height="28" align="center" class="biz-itemnote1"><?php echo Lang('mychannel_basic_settings');?></td>
              <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem2()"><?php echo Lang('mychannel_field_main');?></a></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" align="center" cellspacing="0" id="head2" cellpadding="0" style="display:none">
      <tr>
        <td colspan="2">
          <table cellpadding="0" cellspacing="0">
            <tr>
              <td width="90" align="center" class="biz-itemnote2"><a href="javascript:;" onClick="ShowItem1()"><?php echo Lang('mychannel_basic_settings');?></a></td>
              <td width="90" height="28" align="center" class="biz-itemnote1"><?php echo Lang('mychannel_field_main');?></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" align="center" id="needset" cellpadding="3" cellspacing="1" class="table maintable">
      <?php if ($row['issystem'] == 1) {?>
      <tr>
        <td colspan="2"><div class="alert alert-danger mb-0"><?php echo Lang('mychannel_issystem_edit_tip');?></div></td>
      </tr>
      <?php }?>
      <tr>
        <td><?php echo Lang('mychannel_issystem');?><br>
          <span class="style2" id="help5"><?php echo Lang('mychannel_issystem_tip');?></span>
        </td>
        <td>
        <?php
        if ($row['issystem']==0) echo Lang('mychannel_issystem_0');
        else if ($row['issystem']==1) echo Lang('mychannel_issystem_1');
        else if ($row['issystem']==-1) echo Lang('mychannel_issystem_-1');
        ?>
        </td>
      </tr>
      <tr>
        <td width="30%"><?php echo Lang('mychannel_cid');?><br>
          <span class="style2" id='help1'><?php echo Lang('mychannel_cid_tip');?></span></td>
        <td width="70%"><?php echo $row['id'];?></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_nid');?><br>
          <span class="style2" id="help2"><?php echo Lang('mychannel_nid_tip');?> </span></td>
        <td><?php echo $row['nid'];?></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_typename');?><br><span class="style2" id="help3"><?php echo Lang('mychannel_typename_tip');?></span></td>
        <td><input type="text" name="typename" id="typename" value="<?php echo $row['typename'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('additional_table');?><br>
          <span class="style2" id="help4"><?php echo Lang('mychannel_additional_table_tip');?></span></td>
        <td><input type="text" name="addtable" id="addtable" value="<?php echo $row['addtable'];?>" class="pubinputs"><?php echo Lang('mychannel_addtable_namerule_tip2');?></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_issend');?></td>
        <td>
          <label><input type="radio" name="issend" value="0" <?php if ($row['issend']==0) echo 'checked="1"';?>> <?php echo Lang('unsupport');?></label>
          <label><input type="radio" name="issend" value="1" <?php if ($row['issend']==1) echo 'checked="1"';?>> <?php echo Lang('support');?></label>
         </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_sendrank');?></td>
        <td>
          <select name="sendrank" id="sendrank" style="width:160px">
            <option value="0"><?php echo Lang('tourist');?></option>
            <?php
            $urank = $cUserLogin->getUserRank();
            $dsql->SetQuery("SELECT * FROM `#@__arcrank` WHERE adminrank<='$urank' AND `rank`>=10");
            $dsql->Execute();
            while($row2 = $dsql->GetObject())
            {
              if ($row2->rank==$row['sendrank']) echo "<option value='".$row2->rank."' selected>".$row2->membername."</option>";
				      else echo "<option value='".$row2->rank."'>".$row2->membername."</option>";
            }
            ?>
          </select>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_usertype');?></td>
        <td>
        <?php
        $dsql->SetQuery("SELECT * FROM `#@__member_model`");
        $dsql->Execute();
        while($row3 = $dsql->GetObject())
        {
          echo "<label><input type='radio' name='usertype' value='".$row3->name."'".($row['usertype']==$row3->name? "checked" : "")."> ".$row3->name."</label> ";
        }
        ?>
       <label><input type="radio" name="usertype" value="" <?php if ($row['usertype']=='') echo 'checked="1"';?>> <?php echo Lang('unlimited');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_arcsta');?></td>
        <td>
          <label><input type="radio" name="arcsta" value="-1" <?php if ($row['arcsta']==-1) echo 'checked="1"';?>> <?php echo Lang('not_approved');?></label> 
          <label><input type="radio" name="arcsta" value="0" <?php if ($row['arcsta']==0) echo 'checked="1"';?>> <?php echo Lang('mychannel_arcsta_0');?></label> 
          <label><input type="radio" name="arcsta" value="1" <?php if ($row['arcsta']==1) echo 'checked="1"';?>> <?php echo Lang('mychannel_arcsta_1');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_addcon');?></td>
        <td><input type="text" name="addcon" id="addcon" value="<?php echo $row['addcon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_editcon');?></td>
        <td><input type="text" name="editcon" id="editcon" value="<?php echo $row['editcon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_mancon');?></td>
        <td><input type="text" name="mancon" id="mancon" value="<?php echo $row['mancon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_useraddcon');?></td>
        <td><input type="text" name="useraddcon" id="useraddcon" value="<?php echo $row['useraddcon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_usereditcon');?></td>
        <td><input type="text" name="usereditcon" id="usereditcon" value="<?php echo $row['usereditcon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_usermancon');?></td>
        <td><input type="text" name="usermancon" id="usermancon" value="<?php echo $row['usermancon'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_listfields');?><br>
          <span class="style2" id="help6"><?php echo Lang('mychannel_listfields_tip');?></span></td>
        <td><input type="text" name="listfields" id="listfields" size="50" value="<?php echo $row['listfields'];?>" class="pubinputs" style="width:80%"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_titlename');?></td>
        <td><input type="text" name="titlename" id="titlename" value="<?php echo $row['titlename'];?>" class="pubinputs"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_needdes');?><br>
          <span class="style2"><?php echo Lang('mychannel_needdes_tip');?></span></td>
        <td>
          <label><input type="radio" name="needdes" value="1" <?php if ($row['needdes']==1) echo 'checked="1"';?>> <?php echo Lang('use');?></label>
          <label><input type="radio" name="needdes" value="0" <?php if ($row['needdes']==0) echo 'checked="1"';?>> <?php echo Lang('not_used');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_needpic');?></td>
        <td>
          <label><input type="radio" name="needpic" value="1" <?php if ($row['needpic']==1) echo 'checked="1"';?>> <?php echo Lang('use');?></label>
          <label><input type="radio" name="needpic" value="0" <?php if ($row['needpic']==0) echo 'checked="1"';?>> <?php echo Lang('not_used');?></label>
        </td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_dfcid');?><br><span class="style2" id="help8"><?php echo Lang('mychannel_dfcid_tip');?></span></td>
        <td><input type="text" name="dfcid" id="dfcid" value="<?php echo $row['dfcid'];?>" class="pubinputs" style="width:160px"></td>
      </tr>
      <tr>
        <td><?php echo Lang('mychannel_onlyone');?><br>
          <span class="style2" id="help9"><?php echo Lang('mychannel_onlyone_tip');?></span></td>
        <td>
          <label><input type="radio" name="onlyone" value="1" <?php if ($row['onlyone']==1) echo 'checked="1"';?>> <?php echo Lang('yes');?></label>
          <label><input type="radio" name="onlyone" value="0" <?php if ($row['onlyone']==0) echo 'checked="1"';?>> <?php echo Lang('no');?></label>
        </td>
      </tr>
    </table>
    <table width="98%" align="center"  id="adset" cellpadding="3" cellspacing="1" class="table maintable" style='display:none'>
      <tr>
        <td><?php echo Lang('mychannel_adset');?></td>
        <td><button type="button" name="fset" id="fset" onClick="location.href='mychannel_field_add.php?id=<?php echo $id;?>'" class="btn btn-success btn-sm"><?php echo Lang('mychannel_add_field');?></button></td>
      </tr>
      <tr>
        <td colspan='2'>
          <table width="100%" align="center" cellpadding="1" cellspacing="1">
            <tr align="center" bgcolor="#f8fcf2">
              <td width="28%"><?php echo Lang('mychannel_itemname');?></td>
              <td width="18%"><?php echo Lang('mychannel_fieldname');?></td>
              <td width="20%"><?php echo Lang('mychannel_datatype');?></td>
              <td width="18%"><?php echo Lang('mychannel_fieldtype');?></td>
              <td><?php echo Lang('operation');?></td>
            </tr>
            <?php
            if ($row['issystem']==-1)
            {
            ?>
            <tr>
              <td colspan='5'><?php echo Lang('mychannel_edit_system_tip1');?></td>
            </tr>
            <?php
            } else {
            ?>
            <tr>
              <td colspan='5'><?php echo Lang('mychannel_edit_system_tip2');?></td>
            </tr>
            <?php
            }
            $ds = file(DEDEADMIN."/inc/fieldtype.txt");
            foreach($ds as $d){
              $dds = explode(',',trim($d));
              $fieldtypes[$dds[0]] = $dds[1];
            }
            $fieldset = stripslashes($row['fieldset']);
            $dtp = new DedeBIZ\Template\DedeTagParse();
            $dtp->SetNameSpace("field","<",">");
              $dtp->LoadSource($fieldset);
              if (is_array($dtp->CTags)){
                foreach($dtp->CTags as $ctag)
                {
                ?>
                <tr align="center" onmousemove="javascript:this.bgColor='#f8fcf2';" onmouseout="javascript:this.bgColor='#ffffff';">
                  <td>
                  <?php
                  $itname = $ctag->GetAtt('itemname');
                  if ($itname=='') echo Lang("not_specified");
                  else echo $itname;
                  ?>
                  </td>
                  <td><?php echo $ctag->GetTagName();?></td>
                  <td>
                  <?php
                  $ft = $ctag->GetAtt('type');
                  if (isset($fieldtypes[$ft])) echo Lang('mychannel_fieldtype_'.$ft);
                  else echo Lang("mychannel_field_system");
                  ?>
                  </td>
                  <td>
                  <?php
                  $ft = $ctag->GetAtt('autofield');
                  if ($ft=='' || $ft==0) {
                  echo Lang("mychannel_autofield_0");
                  } else {
                    echo Lang("mychannel_autofield_1");
                  }
                  ?>
                </td>
                <td>
                <?php
                if ($ft==1)
                {
                ?>
                <a href="mychannel_field_edit.php?id=<?php echo $id;?>&fname=<?php echo $ctag->GetTagName();?>&issystem=<?php echo $row['issystem'];?>"><i class="btn btn-sm fa fa-code" title="<?php echo Lang('edit');?>"></i></a>
                <?php if ($row['issystem']!=1){?>
                <a href="javascript:;" onClick="javascript:DelNote('mychannel_field_edit.php?id=<?php echo $id;?>&fname=<?php echo $ctag->GetTagName();?>&action=delete');"><i class="btn btn-sm fa fa-trash" title="<?php echo Lang('delete');?>"></i></a>
                <?php }?>
                <?php
                } else {
                  echo Lang("forbidden_edit");
                }
                ?>
              </td>
            </tr>
            <?php
            }
            }
            ?>
          </table>
        </td>
      </tr>
      <tr>
        <td width="30%"><?php echo Lang("mychannel_fieldset_custom");?><br>
          <?php echo Lang("mychannel_fieldset_custom_tip");?>
        </td>
        <td width="70%"><textarea name="fieldset" style="width:98%;height:300px" rows="10" id="fieldset"><?php echo stripslashes($row['fieldset']);?></textarea></td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="3" cellspacing="1" bgcolor="#f8f8f8" class="mb-3 biz-border border-top-0">
      <tr>
        <td align="center" class="py-2">
          <button type="submit" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
          <button type="button" class="btn btn-success btn-sm" onClick="location='mychannel_main.php';"><?php echo Lang('back');?></button>
        </td>
      </tr>
    </table>
  </form>
  <?php
if (!empty($openfield))
{
	echo "<script>ShowItem2();</script>";
}
?>
</body>
</html>