<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>新建/修改模板</title>
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="../static/web/css/admin.css">
		<link rel="stylesheet" href="css/codemirror.css">
		<script src="js/codemirror.js"></script>
		<script src="js/mode/xml/xml.js"></script>
		<script src="js/mode/javascript/javascript.js"></script>
		<script src="js/mode/css/css.js"></script>
		<script src="js/mode/htmlmixed/htmlmixed.js"></script>
		<style>.helpinfo{float:left;display:none;padding:10px;width:100%;background:#f5f5f5;border:1px solid #dee2e6;border-radius:0.5rem}</style>
	</head>
	<body>
		<form method="POST" action="tpl.php" name=form1 onSubmit="return Post()">
			<input type="hidden" name="action" value="saveedit">
			<input type="hidden" name="acdir" value="<?php echo $acdir;?>">
			<input type="hidden" name="_csrf_token" value="<?php echo $GLOBALS['csrf_token'];?>">
			<table align="center" class="table maintable my-3">
				<tr>
					<td bgcolor="#f5f5f5" colspan="2">新建/修改模板</td>
				</tr>
				<tr>
					<td width="260">文件名称</td>
					<td>
						<input name=filename value="<?php echo $filename;?>" class="admin-input-lg">
						<span>（不可以用小数点..表示路径）</span>
					</td>
				</tr>
				<tr>
					<td colspan="2">
					<?php
					foreach ($helps as $key => $help) {
						echo '<a href="javascript:;" onclick="showdiv(\''.$key.'\');" title="'.trim($help[0]).'" class="btn btn-light btn-sm">'.$key.'</a>'."";
					}
					?>
					</td>
				</tr>
				<tr>
					<td colspan="2">
						<?php
						foreach ($helps as $key => $help) {
							echo '<div id="'.$key.'" class="helpinfo"><span class="float-right"><a href="javascript:;" onclick="showdiv(\'\')" class="btn btn-success btn-sm">关闭</a></span><p>标签名称：'.$key.'</p><p>标签说明：'.trim($help[0]).'</p><p><textarea id="'.$key.'" class="admin-textarea-xl">'.trim($help[1]).'</textarea></p><span>'."";
							$parameters = explode("\n", $help[2]);
							foreach($parameters as $parameter)
							{
								$parameter = trim($parameter);
								if ($parameter == '') continue;
								else echo $parameter,'<br>';
							}
							echo '</span></div>'."";
						}
						?>
					</td>
				</tr>
				<tr>
					<td colspan="2" class="p-0">
						<textarea name="content" id="content"><?php echo $content;?></textarea>
					</td>
				</tr>
				<tr>
					<td bgcolor="#f5f5f5" colspan="2" align="center">
						<button type="submit" name="B1" class="btn btn-success btn-sm">保存</button>
						<button type="button" name="B4" class="btn btn-outline-success btn-sm" onclick="javascript:history.go(-1);">返回</button>
					</td>
				</tr>
			</table>
		</form>
		<script>
			function Post() {
				if (document.form1.filename.value == "") {
					alert("文件名不能为空");
					document.form1.filename.focus();
					return false;
				}
			}
			function showdiv(id) {
				hideobj = GETNAMES("helpinfo");
				for (i = 0; i < hideobj.length; i++) {
					hideobj[i].style.display = "none";
				}
				if (id != '') {
					document.getElementById(id).style.display = "block";
				}
			}
			function GETNAMES(name) {
				var returns = document.getElementsByClassName(name);
				if (returns.length > 0) return returns;
				returns = new Array();
				var e = document.getElementsByTagName("div");
				for (i = 0; i < e.length; i++) {
					if (e[i].getAttribute("name") == name) {
						returns[returns.length] = e[i];
					}
				}
				return returns;
			}
			var editor = CodeMirror.fromTextArea(document.getElementById("content"), {
				lineNumbers: true,
				lineWrapping: true,
				mode: 'text/html',
			});
		</script>
	</body>
</html>