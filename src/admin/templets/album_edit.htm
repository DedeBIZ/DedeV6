<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>修改图片</title>
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="../static/web/css/admin.css">
		<link rel="stylesheet" href="../static/web/css/daterangepicker.css">
		<link rel="stylesheet" href="../static/web/css/cropper.min.css">
		<link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
		<link rel="stylesheet" href="css/albumupload.min.css">
		<script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut;?>';</script>
		<script src="../static/web/js/jquery.min.js"></script>
		<script src="../static/web/js/bootstrap.bundle.min.js"></script>
		<script src="../static/web/js/webajax.js"></script>
		<script src="../static/web/js/moment.min.js"></script>
		<script src="../static/web/js/daterangepicker.js"></script>
		<script src="js/main.js"></script>
		<script src="js/album.js"></script>
		<script src="js/handlers.js"></script>
		<script src="../static/web/js/cropper.min.js"></script>
		<style>table{border-collapse:inherit}</style>
		<script>
			var swfu = null;
			var vcc = 0;
			var albums = [];
			$(document).ready(function () {
				//添加图片
				$("#iptAlbumImages").change(function (event) {
					var files = event.target.files;
					for (var i = 0, f; f = files[i]; i++) {
						//如果不是图片忽略
						if (!f.type.match('image.*')) {
							continue;
						}
						//图片渲染到浏览器
						var reader = new FileReader();
						reader.onload = (function (theFile) {
							return function (e) {
								litpicImgSrc = e.target.result;
								addImage(litpicImgSrc, 0);
							};
						})(f);
						reader.readAsDataURL(f);
					}
					$("#iptAlbumImages").val("");
				});
			});
		</script>
	</head>
	<body>
		<form name="form1" action="album_edit.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmitAlb();">
			<input type="hidden" name="channelid" value="<?php echo $channelid?>">
			<input type="hidden" name="id" value="<?php echo $aid?>">
			<input type="hidden" name="imagebody" value="">
			<input type="hidden" name="dopost" value="save">
			<input type="hidden" id="albums" name="albums" value="">
			<table width="98%" align="center" cellpadding="0" cellspacing="0" id="head1" class="mt-3">
				<tr>
					<td>
						<table cellpadding="0" cellspacing="0">
							<tr>
								<td width="80" align="center" class="admin-itemnote1">常规文档</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<table width="98%" align="center" cellpadding="2" cellspacing="2" id="needset" class="admin-border">
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">图片标题：</td>
								<td width="400"><input type="text" name="title" id="title" value="<?php echo $arcRow['title'];?>" class="admin-input-lg"></td>
								<td width="90">简略标题：</td>
								<td><input type="text" name="shorttitle" id="shorttitle" value="<?php echo $arcRow['shorttitle'];?>" class="admin-input-sm"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">自定义属性：</td>
								<td>
									<?php
									$dsql->SetQuery("SELECT * FROM `#@__arcatt` ORDER BY sortid ASC");
									$dsql->Execute();
									while($trow = $dsql->GetObject())
									{
										if ($trow->att=='j') $jumpclick = " onclick='ShowUrlTr()'";
										else $jumpclick = '';
										if (preg_match("#".$trow->att."#", $arcRow['flag']))
											echo "<label class='mr-2'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' {$jumpclick} checked='checked'> {$trow->attname}[{$trow->att}]</label>";
										else
											echo "<label class='mr-2'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'{$jumpclick} /> {$trow->attname}[{$trow->att}]</label>";
									}
									?>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td" id="redirecturltr" style="display:<?php echo (empty($addRow['redirecturl']) ? 'none' : 'block');?>">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">跳转网址：</td>
								<td><input type="text" name="redirecturl" id="redirecturl" value="<?php echo $addRow['redirecturl']?>" class="admin-input-md"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">标签：</td>
								<td><input type="text" name="tags" id="tags" value="<?php echo $tags;?>" class="admin-input-md">（英文逗号分开，如“DedeBIZ,得德”）</td>
								<td width="60">权重：</td>
								<td><input type="text" name="weight" id="weight" value="<?php echo $arcRow['weight'];?>" class="admin-input-sm">（越小越靠前）</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="pictable">
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">缩略图：</td>
								<td width="620">
									<input type="text" name="picname" id="picname" value="<?php echo $arcRow['litpic']?>" class="admin-input-md">
									<label><input type="checkbox" name="ddisremote" value="1" id="ddisremote"> 远程</label>
									<span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
									<button type="button" name="Submit" onClick="SelectImage('form1.picname','');" class="btn btn-success btn-sm">选择图片</button>
									<button type="button" id="btnClearAll" class="btn btn-success btn-sm">清空</button>
								</td>
								<td><img src="<?php if ($arcRow['litpic']!='') echo $arcRow['litpic']; else echo '../static/web/img/thumbnail.jpg';?>" id="litPic" class="thumbnail-md"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">来源：</td>
								<td width="260">
									<input type="text" name="source" id="source" value="<?php echo $arcRow['source']?>" class="admin-input-sm">
									<button type="button" name="selsource" id="selsource" class="btn btn-success btn-sm">选择</button>
								</td>
								<td width="90">作者：</td>
								<td>
									<input type="text" name="writer" id="writer" value="<?php echo $arcRow['writer']?>" class="admin-input-sm">
									<button type="button" name="selwriter" id="selwriter" class="btn btn-success btn-sm">选择</button>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">发布栏目：</td>
								<td width="360">
									<?php
									$typeOptions = GetOptionList($arcRow['typeid'],$cuserLogin->getUserChannel(),$channelid);
									echo "<select name='typeid' id='typeid' class='admin-input-sm'>";
									if ($arcRow['typeid']=='0') echo "<option value='0' selected>请选择主分类</option>";
									echo $typeOptions;
									echo '</select>';
									?>
									<i class="btn btn-sm fa fa-search" onClick="ShowCatMap(event,this,<?php echo $channelid;?>,'typeid','<?php echo $arcRow['typeid'];?>')" title="快捷选择"></i>
								</td>
								<td width="90">需要金币：</td>
								<td><input type="text" name="money" id="money" value="<?php echo $arcRow['money']?>" class="admin-input-sm"></td>
							</tr>
						</table>
					</td>
				</tr>
				<?php if ($cfg_need_typeid2=='Y') {?>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">副栏目：</td>
								<td>
									<span id="typeid2ct"></span>
									<input type="text" name="typeid2" id="typeid2" value="<?php echo ($arcRow['typeid2']=='0' ? '' : $arcRow['typeid2']);?>" class="admin-input-sm">
									<i class="btn btn-sm fa fa-search" onClick="ShowCatMap(event,this,<?php echo $channelid;?>,'typeid2','<?php echo $arcRow['typeid2'];?>')" title="选择副栏目"></i>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">关键词：</td>
								<td><input type="text" name="keywords" id="keywords" value="<?php echo $arcRow['keywords']?>" class="admin-input-md"></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">描述：</td>
								<td><textarea name="description" id="description" class="admin-textarea-sm"><?php echo $arcRow['description']?></textarea></td>
							</tr>
						</table>
					</td>
				</tr>
				<?php }?>
				<tr>
					<td><?php PrintAutoFieldsEdit(stripslashes($cInfos['fieldset']),$addRow,'autofield');?></td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">表现方式：</td>
								<td>
									<label><input type="radio" name="pagestyle" id="pagestyle1" onClick="checkMuList()" value="1" <?php if ($pagestyle==1) echo " checked='checked'";?>> <img src="../static/web/img/alb2.jpg" title="单页多图样式"></label>
									<label><input type="radio" name="pagestyle" id="pagestyle2" onClick="checkMuList()" value="2" <?php if ($pagestyle==2) echo " checked='checked'";?>> <img src="../static/web/img/alb1.jpg" title="幻灯片样式"></label>
									<label><input type="radio" name="pagestyle" id="pagestyle3" onClick="checkMuList()" value="3" <?php if ($pagestyle==3) echo " checked='checked'";?>> <img src="../static/web/img/alb3.jpg" title="多缩略图样式"></label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="cfgmulist" style="<?php if ($pagestyle!=3) echo 'display:none';?>">
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">多列式参数：</td>
								<td>
									行 <input type="text" name="row" id="row" value="<?php echo $irow;?>" size="6">
									列 <input type="text" name="col" id="col" value="<?php echo $icol;?>" size="6">
									缩略图宽度限制：<input type="text" name="ddmaxwidth" id="ddmaxwidth" value="<?php echo $ddmaxwidth;?>" size="6"> 像素
								</td>
							</tr>
							<tr>
								<td></td>
								<td>（系统仅是每页输出&quot;行x列&quot;张图片，实现需自行控制样式表）</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="spagelist" style="<?php if ($pagestyle!=1) echo 'display:none';?>">
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">每页图片数：</td>
								<td><input name="pagepicnum" id="pagpicnum" size="10" value="<?php echo $pagepicnum;?>"> 单页多图显示需要设置此参数，这种模式下系统不会为每张图单独生成缩略图</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr style="display:none">
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">限制宽度：</td>
								<td><input type="text" name="maxwidth" id="maxwidth" size="10" value="<?php echo $maxwidth?>">（防止图片太宽在模板页中溢出）</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr id="htmlfield" style="display:none">
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">网上复制：</td>
								<td>
									复制的源网址：<input type="text" name="copysource" value="http://" class="admin-input-md">（防盗链网站需填写您复制图片的其中一个网页网址）<br>
									把图片从别的网页复制，在这里用Ctrl+V粘贴，提交后程序可直接获取这个区域的所有图片
									<input type="button" name="button" id="button" value="预览" onClick="LoadTestDiv()"><br>
									<div id="copyhtml" style="margin:10px 0;padding:10px;width:98%;height:200px;border:1px solid #ccc" contenteditable="true">粘贴到这里</div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table width="100%">
							<tr>
								<td>
									<div id="thumbnailsEdit">
										<?php
										$j = 1;
										if ($imgurls!=""){
											$dtp = new DedeTagParse();
											$dtp->LoadSource($imgurls);
											if (is_array($dtp->CTags)) {
												foreach($dtp->CTags as $ctag)
												{
													if ($ctag->GetName()=="img") {
														$bigimg = trim($ctag->GetInnerText());
														if ($ctag->GetAtt('ddimg') != $bigimg && $ctag->GetAtt('ddimg')!='') {
															$litimg = $ctag->GetAtt('ddimg');
														} else {
															$litimg = 'swfupload.php?dopost=ddimg&img='.$bigimg;
														}
														$fhtml = '';
														$fhtml .= "<div class='albCt albEdit' id='albold{$j}'>";
														$fhtml .= "<input type='hidden' name='imgurl{$j}' value='{$bigimg}'>";
														$fhtml .= "<input type='hidden' name='imgddurl{$j}' value='{$litimg}'>";
														$fhtml .= "<img src='{$litimg}'>";
														$fhtml .= "<div class='mt-2'><a href=\"javascript:delAlbPicOld('$bigimg',$j)\" class=\"btn btn-success btn-sm mt-2\">删除</a></div>";
														$fhtml .= "<div class='mt-2'>名称：<input type='text' name='imgmsg{$j}' value='".$ctag->GetAtt('text')."' class='admin-input-sm'></div>";
														$fhtml .= "<div class='mt-2'>更换：<input type='file' name='imgfile{$j}' class='admin-input-sm'></div>";
														$fhtml .= "</div>";
														echo $fhtml;
														$j++;
													}
												}
											}
											$dtp->Clear();
										}
										?>
									</div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">增加新图片：</td>
								<td><span class="btn btn-success btn-sm fileinput-button"><i class="glyphicon glyphicon-plus"></i> 选择本地图片（支持多选）<input type="file" name="files[]" id="iptAlbumImages" multiple></span></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table width="100%">
							<tr>
								<td>
									<div id="divFileProgressContainer"></div>
									<div id="thumbnails"></div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">图片文档：</td>
								<td><?php GetEditor("body",$body,400,"Diy");?></td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">评论选项：</td>
								<td width="260">
									<label><input type="radio" name="notpost" value="0" <?php if ($arcRow['notpost']==0) echo "checked='1'";?>> 允许评论</label>
									<label><input type="radio" name="notpost" value="1" <?php if ($arcRow['notpost']==1) echo "checked='1'";?>> 禁止评论</label>
								</td>
								<td width="90">发布选项：</td>
								<td>
									<label><input type="radio" name="ishtml" value="1" <?php if ($arcRow["ismake"]!=-1) echo "checked";?>> 生成网页</label>
									<label><input type="radio" name="ishtml" value="0" <?php if ($arcRow["ismake"]==-1) echo "checked";?>> 仅动态浏览</label>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">文档排序：</td>
								<td width="260">
									<select name="sortup" id="sortup" class="admin-input-sm">
										<?php
										$subday = SubDay($arcRow["sortrank"],$arcRow["pubdate"]);
										echo "<option value='0'>正常排序</option>";
										if ($subday>0) echo "<option value='$subday' selected>置顶<span class='text-primary'>$subday</span>天</option>";
										?>
										<option value="7">置顶一周</option>
										<option value="30">置顶一个月</option>
										<option value="90">置顶三个月</option>
										<option value="180">置顶半年</option>
										<option value="360">置顶一年</option>
									</select>
								</td>
								<td width="90">标题颜色：</td>
								<td>
									<input type="text" name="color" id="color" value="<?php echo $arcRow['color']?>" class="admin-input-sm">
									<button type="button" name="modcolor" id="modcolor" class="btn btn-success btn-sm" onClick="ShowColor(event,this)">选取</button>
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">阅读权限：</td>
								<td width="260">
									<select name="arcrank" id="arcrank" class="admin-input-sm">
										<option value="<?php echo $arcRow['arcrank']?>"><?php echo $arcRow["rankname"]?></option>
										<?php
										$urank = $cuserLogin->getUserRank();
										$dsql->SetQuery("SELECT * FROM #@__arcrank where adminrank<='$urank'");
										$dsql->Execute();
										while($row = $dsql->GetObject()){
											echo "<option value='".$row->rank."'>".$row->membername."</option>";
										}
										?>
									</select>
								</td>
								<td width="90">文件名称：</td>
								<td><input type="text" name="filename" id="filename" value="<?php echo $arcRow['filename']?>" class="admin-input-sm">（不包括后缀名如.html等）
								</td>
							</tr>
						</table>
					</td>
				</tr>
				<tr>
					<td class="admin-td">
						<table cellspacing="0" cellpadding="0">
							<tr>
								<td width="90">发布时间：</td>
								<td width="260">
									<?php
									$nowtime = GetDateTimeMk(time());
									echo "<input type='text' name='pubdate' value='$nowtime' id='pubdate' class='datepicker' class='admin-input-sm'>";
									?>
								</td>
								<td width="90">浏览次数：</td>
								<td><input type="text" name="click" value="<?php echo $arcRow['click'];?>" class="admin-input-sm"></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
			<table width="98%" cellspacing="0" cellpadding="0" align="center" class="admin-border border-top-0 mb-3">
				<tr>
					<td bgcolor="#f5f5f5" align="center" class="py-2">
						<button type="submit" class="btn btn-success btn-sm">保存</button>
						<button type="button" class="btn btn-outline-success btn-sm" onClick="location.reload();">重置</button>
					</td>
				</tr>
			</table>
		</form>
		<script>InitPage();</script>
	</body>
</html>