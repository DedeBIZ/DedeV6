<!DOCTYPE html>
<html>
<head>
  <meta charset="<?php echo $cfg_soft_lang; ?>">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>修改图片集</title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.css">
  <link rel="stylesheet" href="css/albumupload.css">
  <link rel="stylesheet" href="../static/web/css/daterangepicker.css">
  <link rel="stylesheet" href="../static/web/css/cropper.min.css">
  <link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
  <script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut; ?>';</script>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/webajax.js"></script>
  <script src="../static/web/js/moment.min.js"></script>
  <script src="../static/web/js/daterangepicker.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script src="js/album.js"></script>
  <script src="js/handlers.js"></script>
  <script src="../static/web/js/cropper.min.js"></script>
  <script>
  var swfu = null;
  var vcc = 0;
  var albums = [];
  $(document).ready(function () {
    //添加图片
    $("#iptAlbumImages").change(function (event) {
      var files = event.target.files;
      for (var i = 0, f; f = files[i]; i++) {
        //如果不是图片忽略
        if (!f.type.match('image.*')) {
          continue;
        }
        //将图片渲染到浏览器
        var reader = new FileReader();
        reader.onload = (function (theFile) {
          return function (e) {
            litpicImgSrc = e.target.result;
            addImage(litpicImgSrc, 0);
          };
        })(f);
        reader.readAsDataURL(f);
      }
      $("#iptAlbumImages").val("");
    });
  });
  </script>
  <style>
img{margin:0 10px;vertical-align:baseline}
table{border-collapse:separate}
.albEdit {height:auto}
  </style>
</head>
<body>
<form name="form1" action="album_edit.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmitAlb();">
  <input type="hidden" name="channelid" value="<?php echo $channelid?>">
  <input type="hidden" name="id" value="<?php echo $aid?>">
  <input type="hidden" name="imagebody" value="">
  <input type="hidden" name="dopost" value="save">
  <input type="hidden" id="albums" name="albums" value="">
  <table width="98%" align="center" cellpadding="0" cellspacing="0" class="mt-3">
    <tr>
      <td width="70%"><i class="fa fa-book"></i> <a href="catalog_do.php?cid=<?php echo $arcRow['typeid']?>&dopost=listArchives">图集列表</a> &gt; 修改图集</td>
      <td width="30%" align="right"><?php echo $backurl; ?><a class="btn btn-success btn-sm" href="catalog_main.php">栏目管理</a></td>
    </tr>
  </table>
  <table width="98%" align="center" cellpadding="0" cellspacing="0" id="head1">
    <tr>
      <td colspan="2">
        <table width="168" cellpadding="0" cellspacing="0">
          <tr>
            <td width="84" height="28" align="center" background="../static/web/img/itemnote1.gif">常规内容</td>
            <td width="84" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem2()">图集图片</a></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <table width="98%" align="center" cellpadding="0" cellspacing="0" id="head2" style="display:none">
    <tr>
      <td colspan="2">
        <table width="168"  cellpadding="0" cellspacing="0">
          <tr>
            <td width="84" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem1()">常规内容</a></td>
            <td width="84" height="28" align="center" background="../static/web/img/itemnote1.gif">图集图片</td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <table width="98%" align="center" cellpadding="2" cellspacing="2" id="needset" style="border:1px solid #dee2e6;">
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 图集标题：</td>
            <td width="400"><input type="text" name="title" id="title" value="<?php echo $arcRow['title']; ?>" style="width:390px"></td>
            <td width="90"> 简略标题：</td>
            <td><input type="text" name="shorttitle" id="shorttitle" value="<?php echo $arcRow['shorttitle']; ?>" style="width:160px"></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td width="100%" colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 自定义属性：</td>
            <td>
            <?php
            $dsql->SetQuery("SELECT * FROM `#@__arcatt` ORDER BY sortid ASC");
            $dsql->Execute();
            while($trow = $dsql->GetObject())
            {
              if($trow->att=='j') $jumpclick = " onclick='ShowUrlTr()'";
              else $jumpclick = '';
              if(preg_match("#".$trow->att."#", $arcRow['flag']))
              echo "<label class='mr-1'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' {$jumpclick} checked='checked'> {$trow->attname}[{$trow->att}]</label>";
              else
              echo "<label class='mr-1'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'{$jumpclick} /> {$trow->attname}[{$trow->att}]</label>";
            }
            ?></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline" id="redirecturltr" style="display:<?php echo (empty($addRow['redirecturl']) ? 'none' : 'block'); ?>">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 跳转网址：</td>
            <td><input type="text" name="redirecturl" id="redirecturl" value="<?php echo $addRow['redirecturl']?>" style="width:300px"></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td width="100%" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> Tag标签：</td>
            <td><input type="text" name="tags" id="tags" value="<?php echo $tags; ?>" style="width:300px">（','号分开，单个标签小于12字节）</td>
            <td width="60">权重：</td>
            <td><input type="text" name="weight" id="weight" value="<?php echo $arcRow['weight']; ?>" style="width:60px">（越小越靠前）</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr id="pictable">
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90" height="80"> 缩略图：</td>
            <td>
              <input type="text" name="picname" id="picname" value="<?php echo $arcRow['litpic']?>" style="width:300px">
              <label><input type="checkbox" name="ddisremote" value="1" id="ddisremote"> 远程</label>
              <span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
              <button type="button" name="Submit" onClick="SelectImage('form1.picname','');" class="btn btn-success btn-sm">选择图片</button>
              <button type="button" id="btnClearAll" class="btn btn-success btn-sm delete">清空</button>
            </td>
            <td align="center"><img id="litPic" src="<?php if($arcRow['litpic']!='') echo $arcRow['litpic']; else echo '../static/web/img/defaultpic.jpg'; ?>" style="max-width:100px;max-height:80px"></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 来源：</td>
            <td width="260">
              <input type="text" name="source" id="source" value="<?php echo $arcRow['source']?>" style="width:160px">
              <button type="button" name="selsource" id="selsource" class="btn btn-success btn-sm">选择</button>
            </td>
            <td width="90">作者：</td>
            <td>
              <input type="text" name="writer" id="writer" value="<?php echo $arcRow['writer']?>" style="width:160px">
              <button  type="button"name="selwriter" id="selwriter" class="btn btn-success btn-sm">选择</button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 发布栏目：</td>
            <td width="360">
              <?php
           	  $typeOptions = GetOptionList($arcRow['typeid'],$cuserLogin->getUserChannel(),$channelid);
           	  echo "<select name='typeid' id='typeid' style='width:160px'>";
              if($arcRow['typeid']=='0') echo "<option value='0' selected>请选择主分类</option>";
              echo $typeOptions;
              echo '</select>';
			        ?>
              <i class="btn btn-sm fa fa-search" style="cursor:pointer" onClick="ShowCatMap(event,this,<?php echo $channelid; ?>,'typeid','<?php echo $arcRow['typeid']; ?>')" title="快捷选择"></i>
            </td>
            <td width="90">消费金币：</td>
            <td><input type="text" name="money" id="money" value="<?php echo $arcRow['money']?>" style="width:160px"></td>
          </tr>
        </table>
      </td>
    </tr>
    <?php
    if($cfg_need_typeid2=='Y') {
    ?>
    <tr>
      <td class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 副栏目：</td>
            <td>
              <span id="typeid2ct"></span>
              <input type="text" name="typeid2" id="typeid2" value="<?php echo ($arcRow['typeid2']=='0' ? '' : $arcRow['typeid2']); ?>" style="width:160px">
              <i class="btn btn-sm fa fa-search" style="cursor:pointer" onClick="ShowCatMap(event,this,<?php echo $channelid; ?>,'typeid2','<?php echo $arcRow['typeid2']; ?>')" title="选择副栏目"></i>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 关键词：</td>
            <td><input type="text" name="keywords" id="keywords" value="<?php echo $arcRow['keywords']?>" style="width:360px"></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 描述：</td>
            <td><textarea name="description" id="description" style="width:360px;height:50px"><?php echo $arcRow['description']?></textarea></td>
          </tr>
        </table>
      </td>
    </tr>
    <?php
    }
    ?>
    <tr>
      <td>
        <?php
        PrintAutoFieldsEdit(stripslashes($cInfos['fieldset']),$addRow,'autofield');
        ?>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 图集内容：</td>
            <td><?php GetEditor("body",$body,450,"Diy"); ?></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td bgcolor="#f8f8f8" class="bline2"> 高级属性：</td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
      <table width="900" cellspacing="0" cellpadding="0">
        <tr>
          <td width="90"  width="260"> 评论选项：</td>
          <td width="260">
            <label><input type="radio" name="notpost" value="0" <?php if($arcRow['notpost']==0) echo "checked='1'"; ?>> 允许评论</label>
            <label><input type="radio" name="notpost" value="1" <?php if($arcRow['notpost']==1) echo "checked='1'"; ?>> 禁止评论</label>
          </td>
          <td width="90">发布选项：</td>
          <td>
            <label><input type="radio" name="ishtml" value="1" <?php if($arcRow["ismake"]!=-1) echo "checked"; ?>> 生成网页</label>
            <label><input type="radio" name="ishtml" value="0" <?php if($arcRow["ismake"]==-1) echo "checked"; ?>> 仅动态浏览</label>
          </td>
        </tr>
      </table>
    </tr>
    <tr>
      <td class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 文档排序：</td>
            <td width="260">
              <select name="sortup" id="sortup" style="width:160px">
                <?php
                $subday = SubDay($arcRow["sortrank"],$arcRow["pubdate"]);
                echo "<option value='0'>正常排序</option>";
                if($subday>0) echo "<option value='$subday' selected>置顶 $subday 天</option>";
                ?>
                <option value="7">置顶一周</option>
                <option value="30">置顶一个月</option>
                <option value="90">置顶三个月</option>
                <option value="180">置顶半年</option>
                <option value="360">置顶一年</option>
              </select></td>
            <td width="90">标题颜色：</td>
            <td>
              <input type="text" name="color" id="color" value="<?php echo $arcRow['color']?>" style="width:160px">
              <button type="button" name="modcolor" id="modcolor" class="btn btn-success btn-sm" onClick="ShowColor(event,this)">选取</button>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 阅读权限：</td>
            <td width="260">
              <select name="arcrank" id="arcrank" style="width:160px">
              <option value="<?php echo $arcRow['arcrank']?>"> <?php echo $arcRow["rankname"]?> </option>
              <?php
              $urank = $cuserLogin->getUserRank();
              $dsql->SetQuery("Select * from #@__arcrank where adminrank<='$urank'");
              $dsql->Execute();
              while($row = $dsql->GetObject()){
              	echo "<option value='".$row->rank."'>".$row->membername."</option>";
              }
              ?>
              </select>
            </td>
            <td width="90">文件名称：</td>
            <td><input type="text" name="filename" id="filename" value="<?php echo $arcRow['filename']?>" style="width:160px">（不包括后缀名如.html等）</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td height="70" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 发布时间：</td>
            <td width="260">
            <?php
			      $nowtime = GetDateTimeMk(time());
			      echo "<input type='text' name='pubdate' value='$nowtime' id='pubdate' class='datepicker' style='width:160px'>";
			      ?>
            </td>
            <td width="90">浏览次数：</td>
            <td><input type="text" name="click" value="<?php echo $arcRow['click']; ?>" style="width:160px"></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <!--高级参数-->
  <table width="98%" align="center" cellpadding="2" cellspacing="2" id="adset" style="border:1px solid #dee2e6;display:none">
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 表现方式：</td>
            <td>
              <label><input type="radio" name="pagestyle" id="pagestyle1" onClick="checkMuList()" value="1" <?php if($pagestyle==1) echo " checked='checked'"; ?>> <img src="../static/web/img/alb2.jpg" title="单页多图样式"></label>
              <label><input type="radio" name="pagestyle" id="pagestyle2" onClick="checkMuList()" value="2" <?php if($pagestyle==2) echo " checked='checked'"; ?>> <img src="../static/web/img/alb1.jpg" title="幻灯片样式"></label>
              <label><input type="radio" name="pagestyle" id="pagestyle3" onClick="checkMuList()" value="3" <?php if($pagestyle==3) echo " checked='checked'"; ?>> <img src="../static/web/img/alb3.jpg" title="多缩略图样式"></label>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr id="cfgmulist" style="<?php if($pagestyle!=3) echo 'display:none'; ?>">
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="260"> 多列式参数：</td>
            <td>
              行&nbsp;<input type="text" name="row" id="row" value="<?php echo $irow; ?>" size="6">
              列&nbsp;<input type="text" name="col" id="col" value="<?php echo $icol; ?>" size="6">
              缩略图宽度限制：<input type="text" name="ddmaxwidth" id="ddmaxwidth" value="<?php echo $ddmaxwidth; ?>" size="6"> 像素
            </td>
          </tr>
          <tr>
            <td width="84"></td>
            <td>（系统仅是每页输出&quot;行x列&quot;张图片，实现需自行控制样式表）</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr id="spagelist" style="<?php if($pagestyle!=1) echo 'display:none'; ?>">
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 每页图片数：</td>
            <td><input name="pagepicnum" id="pagpicnum" size="10" value="<?php echo $pagepicnum; ?>"> 单页多图显示需要设置此参数，这种模式下系统不会为每张图单独生成缩略图</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr style="display:none">
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 限制宽度：</td>
            <td><input type="text" name="maxwidth" id="maxwidth" size="10" value="<?php echo $maxwidth?>">（防止图片太宽在模板页中溢出）</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 上传方式：</td>
            <td><input type="hidden" name="isrm" id="isrm" value="1">
              <label><input type="checkbox" name="byhand" id="byhand" value="1" disabled="ture" checked> 手工上传</label>
              <label><input type="checkbox" name="formzip" id="formzip" value="1" onClick="showZipField(this,'zipff','htmlfield')"> 从ZIP压缩包中解压图片</label>
          </tr>
        </table>
      </td>
    </tr>
    <tr id="zipff" style="display:none">
      <td colspan="4" class="bline"><table width="900" cellspacing="0" cellpadding="0" height="100">
          <tr>
            <td width="90"> 压缩包文件：</td>
            <td><input type="text" name="zipfile" id="zipfile" style="width:260px">
              <button type="button" name="addon_bt" class="btn btn-success btn-sm" onClick="SelectSoft('form1.zipfile')">浏览</button>
              <label><input type="checkbox" name="delzip" id="delzip" value="1" checked="checked"> 处理后删除压缩文件</label>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr id="htmlfield" style="display:none">
      <td colspan="4" class="bline"><table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 网上复制：</td>
            <td>复制的源网址：
              <input type="text" name="copysource" value="http://" style="width:260px">（防盗链网站需填写您复制图片的其中一个网页网址）<br>
              把图片从别的网页复制，在这里用Ctrl+V粘贴，提交后程序可直接获取这个区域的所有图片
              <input type="button" name="button" id="button" value="预览" onClick="LoadTestDiv()"><br>
              <div id="copyhtml" style="margin:10px 0;border:solid 1px #CCCCCC;width:96%;padding:6px;height:260px;width:100%" contenteditable="true">粘贴到这里</div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4" class="bline">
        <table width="100%">
          <tr>
            <td>
              <div id="thumbnailsEdit">
                <?php
                $j = 1;
                if($imgurls!=""){
                  $dtp = new DedeTagParse();
                  $dtp->LoadSource($imgurls);
                  if(is_array($dtp->CTags))
                  {
                    foreach($dtp->CTags as $ctag)
                    {
                      if($ctag->GetName()=="img")
                      {
                        $bigimg = trim($ctag->GetInnerText());
                        if($ctag->GetAtt('ddimg') != $bigimg && $ctag->GetAtt('ddimg')!='')
                        {
                          $litimg = $ctag->GetAtt('ddimg');
                        } else {
                          $litimg = 'swfupload.php?dopost=ddimg&img='.$bigimg;
                        }
                        $fhtml = '';
                        $fhtml .= "<div class='albCt albEdit' id='albold{$j}'>";
                        $fhtml .= "<input type='hidden' name='imgurl{$j}' value='{$bigimg}'>";
                        $fhtml .= "<input type='hidden' name='imgddurl{$j}' value='{$litimg}'>";
                        $fhtml .= "<img src='{$litimg}'style='width:120px'><a href=\"javascript:delAlbPicOld('$bigimg',$j)\" class=\"btn btn-success btn-sm\">删除</a>";
                        $fhtml .= "<div style='margin-top:10px'>名称：<input type='text' name='imgmsg{$j}' value='".$ctag->GetAtt('text')."'></div>";
                        $fhtml .= "<div style='margin-top:10px'>更换：<input type='file' name='imgfile{$j}' style='width:160px'></div>";
                      $fhtml .= "</div>";
                      echo $fhtml;
                      $j++;
                    }
                  }
                }
                $dtp->Clear();
              }
              ?>
              </div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td bgcolor="#f8f8f8" colspan="4" class="bline">
        <table width="900" cellspacing="0" cellpadding="0">
          <tr>
            <td width="90"> 增加新图片：</td>
            <td><span class="btn btn-success btn-sm fileinput-button"><i class="glyphicon glyphicon-plus"></i> 选择本地图片（支持多选）<input type="file" name="files[]" id="iptAlbumImages" multiple></span></td>
          </tr>
        </table>
      </td>
    </tr>
    <tr>
      <td colspan="4">
        <table width="100%">
          <tr>
            <td>
              <div id="divFileProgressContainer"></div>
              <div id="thumbnails"></div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <table width="98%" cellspacing="0" cellpadding="0" align="center" bgcolor="#f8f8f8" style="border:1px solid #dee2e6;border-top:0" class="mb-3">
    <tr>
      <td align="center" class="py-2">
        <button type="submit" class="btn btn-success btn-sm">保存</button>
        <button type="button" onClick="location.reload();" class="btn btn-success btn-sm">重置</button>
      </td>
    </tr>
  </table>
</form>
<script>InitPage();</script>
</body>
</html>