<!DOCTYPE html>
<html>
<head>
  <meta charset="<?php echo $cfg_soft_lang; ?>">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title>发布专题</title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.css">
  <link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
  <link rel="stylesheet" href="../static/web/css/daterangepicker.css">
  <link rel="stylesheet" href="../static/web/css/cropper.min.css">
  <script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut; ?>';</script>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/webajax.js"></script>
  <script src="../static/web/js/moment.min.js"></script>
  <script src="../static/web/js/daterangepicker.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script src="../static/web/js/cropper.min.js"></script>
  <script>
    function checkSubmit() {
      if (document.form1.title.value == "") {
        ShowMsg("专题名称不能为空");
        return false;
      }
      for (i = 1; i <= 6; i++) {
        $val = CheckVal(i);
        if ($val == false) {
          return false;
        }
      }
    }
    function SelectArcList(fname) {
      var pos = GetWinPos(800,600);
      window.open("content_select_list.php?f=" + fname, "selArcList", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
    }
    function SelectImage(fname, vlist) {
      var pos = GetWinPos(800,600);
      window.open("./dialog/select_images.php?f=" + fname + "&imgstick=" + vlist, "popUpImagesWin", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
    }
    function SelectTemplets(fname) {
      var pos = GetWinPos(800,600);
      window.open("./dialog/select_templets.php?f=" + fname, "poptempWin", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
    }
    function CheckVal(id) {
      var notename = $DE('notename' + id);
      var arcid = $DE('arcid' + id);
      if (arcid.value != "") {
        if (notename.value == "") {
          $DE('notename' + id).focus();
          ShowMsg('您的节点' + id + '名称不能为空');
          return false;
        }
      }
    }
  </script>
<style>
body{background:#fff}
img{vertical-align:baseline}
table{border-collapse:separate}
</style>
</head>
<body>
  <form name="form1" action="spec_add.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmit();">
    <input type="hidden" name="dopost" value="save">
    <input type="hidden" name="channelid" value="<?php echo $channelid?>">
    <input type="hidden" name="arcrank" value="0">
    <input type="hidden" name="source" value="本站">
    <table width="98%" align="center" cellpadding="0" cellspacing="0" class="mt-3">
      <tr>
        <td width="85%" ><i class="fa fa-book"></i> <a href="content_s_list.php">专题列表</a><a href="catalog_do.php?cid=<?php echo $cid?>&channelid=<?php echo $channelid?>&dopost=listArchives"></a> &gt; 发布专题</td>
        <td width="10%" align="right"> <a href="makehtml_spec.php" class="btn btn-success btn-sm">更新专题</a></td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="0" cellspacing="0" id="head1">
      <tr>
        <td colspan="2">
          <table width="168" cellpadding="0" cellspacing="0">
            <tr>
              <td width="84" height="28" align="center" background="../static/web/img/itemnote1.gif">常规参数</td>
              <td width="84" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem2()">专题文档</a></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="0" cellspacing="0" id="head2" style="display:none">
      <tr>
        <td colspan="2">
          <table width="168"  cellpadding="0" cellspacing="0">
            <tr>
              <td width="84" align="center" background="../static/web/img/itemnote2.gif"><a href="javascript:;" onClick="ShowItem1()">常规参数</a></td>
              <td width="84" height="28" align="center" background="../static/web/img/itemnote1.gif">专题文档</td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="2" cellspacing="2" id="needset" style="border:1px solid #dee2e6">
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 专题名称：</td>
              <td width="400"><input type="text" name="title" id="title" value="" style="width:390px"></td>
              <td width="90"> 简略标题：</td>
              <td><input type="text" name="shorttitle" id="shorttitle" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 自定义属性：</td>
              <td><?php
            	$dsql->SetQuery("Select * From `#@__arcatt` order by sortid asc");
            	$dsql->Execute();
            	while($trow = $dsql->GetObject())
            	{
            		if($trow->att!='j')
            		{
            			echo "<label class='mr-1'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'> {$trow->attname}[{$trow->att}]</label>";
            		}
            	}
            	?></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id="pictable">
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 缩略图：</td>
              <td>
                <input type="text" name="picname" id="picname" style="width:300px">
                <label><input type="checkbox" name="ddisremote" value="1" id="ddisremote"> 远程</label>
                <span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
                <button type="button" name="Submit2" onClick="SelectImage('form1.picname','small');" class="btn btn-success btn-sm">选择图片</button>
                <button type="button" id="btnClearAll" class="btn btn-success btn-sm delete">清空</button>
              </td>
              <td width="260" align="center"><img id="litPic" src="../static/web/img/defaultpic.jpg" style="height:80px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 责任编辑：</td>
              <td><input type="text" name="writer" id="writer" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 内容排序：</td>
              <td width="260">
                <select name="sortup" id="sortup" style="width:160px">
                  <option value="0" selected>默认排序</option>
                  <option value="7">置顶一周</option>
                  <option value="30">置顶一个月</option>
                  <option value="90">置顶三个月</option>
                  <option value="180">置顶半年</option>
                  <option value="360">置顶一年</option>
                </select>
              </td>
              <td width="90">标题颜色：</td>
              <td>
                <input type="text" name="color" id="color" style="width:160px">
                <button type="button" name="modcolor" id="modcolor" class="btn btn-success btn-sm" onClick="ShowColor(event,this)">选取</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 主分类：</td>
              <td>
                <?php
                $typeOptions = GetOptionList($cid, $cuserLogin->getUserChannel(), 0);
                echo "<select name='typeid' id='typeid' style='width:160px'>";
                echo "<option value='0'>请选择主分类</option>";
                echo $typeOptions;
                echo "</select>";
					      ?>
                <i class="btn btn-sm fa fa-search" onClick="ShowCatMap(event,this,0,'typeid')" title="快捷选择" style="cursor:pointer"></i>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 关键词：</td>
              <td>
                <input type="text" name="keywords" id="keywords" value="" style="width:360px">
                <button type="button" name="Submit" class="btn btn-success btn-sm" onClick="SelectKeywords('form1.keywords');">浏览</button>
              </td>
              <td><label><input type="checkbox" name="autokey" onClick="ShowHide('keywords');" ; id="autokey" value="1" <?php if($cfg_arc_autokeyword=='Y') echo 'checked="1"'; ?> />自动获取，手动填写用","分开</label></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 专题简介：</td>
              <td><textarea name="description" id="description" style="width:360px;height:50px"></textarea></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"  width="260"> 评论选项：</td>
              <td width="260">
                <label><input type="radio" name="notpost" value="0" <?php if($cfg_feedback_forbid=='N') echo "checked='1'"; ?>> 允许评论</label>
                <label><input type="radio" name="notpost" value="1" <?php if($cfg_feedback_forbid=='Y') echo "checked='1'"; ?>> 禁止评论</label>
              </td>
              <td width="90">发布选项：</td>
              <td>
                <label><input type="radio" name="ishtml" value="1" checked="1"> 生成网页</label>
                <label><input type="radio" name="ishtml" value="0"> 仅动态浏览</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 专题模板：</td>
              <td  width="260">
                <input type="text" name="templet" id="templet" value="<?php echo $cfg_df_style?>/article_spec.htm" style="width:160px">
                <button type="button" name="set3" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.templet');">浏览</button>
              </td>
              <td width="90">文件名称：</td>
              <td><input type="text" name="filename" id="filename" style="width:160px">（不包括后缀名如.html等）</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> 发布时间：</td>
              <td  width="260"><?php
              $nowtime = GetDateTimeMk(time());
              echo "<input name='pubdate' value='$nowtime' type='text' id='pubdate' class='datepicker' style='width:160px'>";
              ?>
              </td>
              <td width="90">浏览次数：</td>
              <td><input type="text" name="click" value="<?php echo ($cfg_arc_click=='-1' ? mt_rand(50,200):$cfg_arc_click); ?>" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><?php PrintAutoFieldsAdd(stripslashes($cInfos['fieldset']),'autofield'); ?></td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="2" cellspacing="2" id="adset" style="display:none;border:1px solid #dee2e6">
      <tr>
        <td class="bline2">专题节点列表： <br>
          1、文章列表用ID1,ID2,ID3这样形式分开，系统会自动排除不同节点的相同文章；<br>
          2、关于单条记录模板里的[field:fieldname/]标记的使用，请参考关于系统帮助关于 arclist 标记的说明；<br>
          3、节点ID是节点的唯一标识，专题模板中用{dede:field.note noteid='标识'/}这样来表示单个节点，不指定noteid时为所有节点列表<br>
          4、正常的情况下，每个节点显示的是“节点文章列表”里的文档，如果您指定为“自动获取模式”，那么必须指定关键词和栏目ID </td>
      </tr>
      <tr>
        <td>
          <table width="98%" cellspacing="2" cellpadding="2">
            <?php
            $speclisttmp = GetSysTemplets("spec_arclist.htm");
            $nodename = $nodeid = '';
            for($i=1;$i<=$cfg_specnote;$i++)
            {
		  			 if($i==1)
		  			 {
		  				$nodename = '默认节点';
		  				$nodeid = 'default';
		  			 } else {
		  			 $nodename = $nodeid = '';
		  		  }
		        ?>
            <tr bgcolor="#F8FCF1">
              <td width="260">节点<?php echo $i?>名称：</td>
              <td colspan="2">
                <table width="900" cellspacing="0" cellpadding="0">
                  <tr>
                    <td width="310"><input type="text" name="notename<?php echo $i?>" value="<?php echo $nodename; ?>" id="notename<?php echo $i?>" style="width:300px"></td>
                    <td width="90">节点标识：</td>
                    <td><input type="text" name="noteid<?php echo $i?>" value="<?php echo $nodeid; ?>" id="noteid<?php echo $i?>" style="width:160px"></td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td>节点文章列表：</td>
              <td><textarea name="arcid<?php echo $i?>" onblur='CheckVal(<?php echo $i ?>)' rows="3" id="arcid<?php echo $i?>" style="width:90%"></textarea></td>
              <td><button name="selarc<?php echo $i?>" type="button" id="selarc<?php echo $i?>2" class="btn btn-success btn-sm" onClick="SelectArcList('form1.arcid<?php echo $i?>');">选择节点文章</button></td>
            </tr>
            <tr>
              <td>文档来源：</td>
              <td colspan="2">
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="0" checked> 按文章列表</label>
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="1"> 自动获取文档</label>
                <label>关键词：<input type="text" name="keywords<?php echo $i?>" id="keywords<?php echo $i?>" value="" size="16">（逗号分开）</label>
                栏目ID：<label><input type="text" name="typeid<?php echo $i?>" id="_typeid<?php echo $i?>" value="0" size="4"></label>
              </td>
            </tr>
            <tr>
              <td height="50" rowspan="2">节点布局：</td>
              <td colspan="2">
                列数：<input type="text" name="col<?php echo $i?>" id="col<?php echo $i?>" value="1" size="3">
                图片宽：<input type="text" name="imgwidth<?php echo $i?>" id="imgwidth<?php echo $i?>" value="120" size="3">
                图片高：<input type="text" name="imgheight<?php echo $i?>" id="imgheight<?php echo $i?>" value="90" size="3">
                标题长：<input type="text" name="titlelen<?php echo $i?>" id="titlelen<?php echo $i?>" value="60" size="3">
                简介长：<input type="text" name="infolen<?php echo $i?>" id="infolen<?php echo $i?>" value="160" size="3">
                文档数：<input type="text" name="rownum<?php echo $i?>" id="rownum<?php echo $i?>" value="10" size="3">
              </td>
            </tr>
            <tr>
              <td colspan="2">单条记录的模板：<br>
                <textarea name="listtmp<?php echo $i?>" rows="3" id="listtmp<?php echo $i?>" style="width:60%"><?php echo $speclisttmp?></textarea></td>
            </tr>
            <tr>
              <td>节点容器模板：</td>
              <td colspan="2">
                <input type="text" name="notetemplet<?php echo $i?>" id="notetemplet<?php echo $i?>" value="system/channel_spec_note.htm" style="width:300px">
                <button type="button" name="selno<?php echo $i?>" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.notetemplet<?php echo $i?>');">浏览</button>
              </td>
            </tr>
            <?php
            }
		        ?>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" cellspacing="0" cellpadding="0" align="center" bgcolor="#f8f8f8" style="border:1px solid #dee2e6;border-top:0">
      <tr>
        <td align="center" class="py-3">
          <button type="submit" class="btn btn-success btn-sm">保存</button>
          <button type="button" onClick="location.reload();" class="btn btn-success btn-sm">重置</button>
        </td>
      </tr>
    </table>
  </form>
  <script>InitPage();</script>
</body>
</html>