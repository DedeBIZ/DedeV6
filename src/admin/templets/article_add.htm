<!DOCTYPE html>
<html>
<head>
<meta charset="<?php echo $cfg_soft_lang; ?>">
<title>增加文章</title>
<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
<link rel="stylesheet" href="../static/web/css/admin.css">
<link rel="stylesheet" href="../static/web/css/daterangepicker.css">
<link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
<link rel="stylesheet" href="../static/web/css/cropper.min.css">
<script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut; ?>';</script>
<script src="../static/web/js/jquery.min.js"></script>
<script src="../static/web/js/webajax.js"></script>
<script src="../static/web/js/moment.min.js"></script>
<script src="../static/web/js/daterangepicker.js"></script>
<script src="js/main.js"></script>
<script src="js/handlers.js"></script>
<script src="../static/web/js/bootstrap.bundle.min.js"></script>
<script src="../static/web/js/cropper.min.js"></script>
<script>
var arctype = 'article';
function checkSubmit() {
  if (document.form1.title.value == '') {
    ShowMsg('文章标题不能为空');
    return false;
  }
  if (document.form1.typeid.value == 0) {
    ShowMsg('请选择档案的主类别');
    return false;
  }
}
</script>
<style>
body{background:#fff}
img{vertical-align:baseline}
table{border-collapse:separate}
.albCt img{cursor:pointer}
.multipic{border:1px dashed #FC6}
.albCt{border-bottom:1px dashed #FC0;margin-bottom:10px;padding-bottom:10px}
</style>
</head>
<body>
  <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" class="mt-3">
    <tr>
      <td width="60%" height="30"><img src="../static/web/img/book1.gif"><a href="catalog_do.php?cid=<?php echo $cid?>&channelid=<?php echo $channelid?>&dopost=listArchives">文章列表</a> &gt; 发布文章</td>
      <td width="30%" align="right"><?php echo $backurl; ?><a class="btn btn-success btn-sm" href="catalog_main.php">栏目管理</a></td>
    </tr>
  </table>
  <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" id="head1">
    <tr>
      <td colspan="2">
        <table width="800" border="0" cellpadding="0" cellspacing="0">
          <tr>
            <td width="86" height="26" align="center" background="../static/web/img/itemnote1.gif">常规信息</td>
            <td><a href="javascript:;" class="btn btn-success btn-sm" onClick="ShowHide('getone')">单页采集</a></td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
  <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" bgcolor="#FBFCE2" id="getone" class="table table-borderless" style="<?php if(empty($geturl)) echo 'display:none'; ?>;margin:0">
    <form name="getonepage" action="article_add.php" method="get">
      <input type="hidden" name="channelid" value="<?php echo $channelid; ?>">
      <input type="hidden" name="cid" value="<?php echo $cid; ?>">
      <tr>
        <td colspan="2">
          <table width="100%" border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td width="160" height="30"><a name="downurl"></a>采集单个网页：</td>
              <td width="360" align="center"><input name="geturl" type="text" id="geturl" style="width:260px" value="<?php echo $geturl; ?>"></td>
              <td>
                <button type="submit" class='btn btn-success btn-sm' name="Submit3">抓取</button>
                <button type="button" class='btn btn-success btn-sm' name="setrule" onClick="OpenMyWinCoOne('article_coonepage_rule.php')">规则管理</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </form>
  </table>
  <form name="form1" action="article_add.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmit()">
    <input type="hidden" name="channelid" value="<?php echo $channelid?>">
    <input type="hidden" name="dopost" value="save">
    <table width="98%" border="0" align="center" cellpadding="2" cellspacing="2" id="needset" style="border:1px solid #dee2e6;background:#ffffff">
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;文章标题：</td>
              <td width="400"><input name="title" type="text" id="title" value="<?php echo $title; ?>" style="width:380px"></td>
              <td width="90">&nbsp;简略标题：</td>
              <td><input name="shorttitle" type="text" id="shorttitle" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;自定义属性：</td>
              <td align="left">
              <?php
            	$dsql->SetQuery("Select * From `#@__arcatt` order by sortid asc");
            	$dsql->Execute();
            	while($trow = $dsql->GetObject())
            	{
            		if($trow->att=='j')
            		echo "<label><input class='np' type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' onclick='ShowUrlTr()'>&nbsp;{$trow->attname}[{$trow->att}]</label>&nbsp;";
            		else
            		echo "<label><input class='np' type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'>&nbsp;{$trow->attname}[{$trow->att}]</label>&nbsp;";
            	}
            	?>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline" id="redirecturltr" style="display:none">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;跳转网址：</td>
              <td><input name="redirecturl" type="text" id="redirecturl" value="" style="width:300px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td width="400%" height="26" colspan="2" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;Tag标签：</td>
              <td><input name="tags" type="text" id="tags" value="" onChange="$Obj('keywords').value=this.value;" style="width:300px">（','号分开，单个标签小于12字节）</td>
              <td width="60">权重：</td>
              <td><input name="weight" type="text" id="weight" value="<?php echo $maxWright['cc']; ?>" style="width:60px">（越小越靠前）</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id="pictable">
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;缩略图：</td>
              <td>
                <input name="picname" type="text" id="picname" style="width:300px">
                <label><input type='checkbox' class='np' name='ddisremote' value='1' id='ddisremote'>&nbsp;远程</label>
                <span class="btn btn-success btn-sm fileinput-button">上传图片<input type="file" name="files[]" id="iptAddImages"></span>
                <button type="button" name="Submit2" onClick="SelectImage('form1.picname','small');" class="btn btn-success btn-sm">选择图片</button>
                <button id="btnClearAll" type="button" class="btn btn-success btn-sm delete">清空</button>
              </td>
              <td width="160" align="center"><img id="litPic" src="../static/web/img/defaultpic.jpg" style="height:80px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;来源：</td>
              <td width="250">
                <input name="source" type="text" id="source" value="<?php echo $source; ?>" style="width:160px">
                <button name="selsource" type="button" id="selsource" class="btn btn-success btn-sm">选择</button>
              </td>
              <td width="60">&nbsp;作者：</td>
              <td>
                <input name="writer" type="text" id="writer" value="<?php echo $writer; ?>" style="width:160px">
                <button name="selwriter" type="button" id="selwriter" class="btn btn-success btn-sm">选择</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="600" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;发布栏目：</td>
              <td>
                <span id="typeidct">
                  <?php
                  $typeOptions = GetOptionList($cid,$cuserLogin->getUserChannel(),$channelid);
                  echo "<select name='typeid' id='typeid' style='width:160px'>";
                  echo "<option value='0'>请选择栏目</option>";
                  echo $typeOptions;
                  echo "</select>";
                  ?>
                </span>
                <img src="../static/web/img/menusearch.gif" style="cursor:pointer" onClick="ShowCatMap(event,this,<?php echo $channelid; ?>,'typeid')" title="快捷选择">
                <?php
                if($cfg_need_typeid2=='Y')
                {
				          echo "<a href='javascript:AddTypeid2();' class='btn btn-success btn-sm'>选择副栏目</a>";
                }
                ?>
              </td>
              <td width="90">消费金币：</td>
              <td><input name="money" type="text" id="money" value="0" style="width:120px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id="typeid2tr" style="display:none">
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;副栏目：</td>
              <td>
                <span id="typeid2ct"></span>
                <input type="text" name="typeid2" id="typeid2" value="" style="width:260px">
                <img src="../static/web/img/menusearch2.gif" style="cursor:pointer" onClick="ShowCatMap(event,this,<?php echo $channelid; ?>,'typeid2')" title="选择副栏目">
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;关键词：</td>
              <td>
                <input type="text" name="keywords" id="keywords" value="<?php echo $keywords; ?>" style="width:360px">
                <button type="button" name="Submit" onClick="SelectKeywords('form1.keywords');" class="btn btn-success btn-sm">浏览</button>
              </td>
              <td>
                <label><input name="autokey" type="checkbox" onClick="ShowHide('keywords');" class="np" id="autokey" value="1" <?php if($cfg_arc_autokeyword=='Y') echo ' checked="1" '; ?>>&nbsp;自动获取，手动填写用","分开</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="5" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;描述：</td>
              <td><textarea name="description" id="description" style="width:360px;height:50px"><?php echo $description; ?></textarea></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="2"><?php PrintAutoFieldsAdd(stripslashes($cInfos['fieldset']),'autofield'); ?></td>
      </tr>
      <tr>
        <td width="100%" height="26" colspan="2" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;附加选项：</td>
              <td>
                <label><input name="remote" type="checkbox" class="np" id="remote" value="1" <?php if($cfg_rm_remote=='Y') echo ' checked="1" '; ?>>&nbsp;下载远程图片和资源&nbsp;</label>
                <label><input name="dellink" type="checkbox" class="np" id="dellink" value="1" <?php if($cfg_arc_dellink=='Y') echo ' checked="1" '; ?>>&nbsp;删除非站内链接</label>
                <a href="javascript:OpenMyWin('article_allowurl_edit.php')" class="btn btn-success btn-sm">设置</a>&nbsp;
                <label><input name="autolitpic" type="checkbox" class="np" id="autolitpic" value="1" <?php if($cfg_arc_autopic=='Y') echo ' checked="1" '; ?>>&nbsp;提取第一个图片为缩略图&nbsp;</label>
                <label><input type='checkbox' name='needwatermark' value='1' class='np' <?php if($photo_markup=='1') echo "checked"; ?>>&nbsp;图片是否加水印</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td width="100%" height="26" colspan="2" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;分页方式：</td>
              <td>
                <label><input name="sptype" type="radio" class="np" value="hand" <?php if($cfg_arcautosp=='N') echo " checked='1' "?>>&nbsp;手动&nbsp;</label>
                <label><input type="radio" name="sptype" value="auto" class="np" <?php if($cfg_arcautosp=='Y') echo " checked='1' "?>>&nbsp;自动&nbsp;</label>
                大小：<input name="spsize" type="text" id="spsize" value="<?php echo $cfg_arcautosp_size?>" style="width:60px"> K（分页符为：#p#分页标题#e#）
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td width="100%" id="arcBody">
        <?php
        GetEditor("body",$body,450);
        ?>
        </td>
        <td width="250" align="center" valign="top" bgcolor="#FFFFCC" id="mPic" style="display:none"></td>
      </tr>
    </table>
    <!--高级参数-->
    <table width="98%" border="0" align="center" cellpadding="0" cellspacing="0" id="head1" style="margin-top:10px">
      <tr>
        <td>
          <table border="0" cellpadding="0" cellspacing="0">
            <tr>
              <td width="86" height="26" align="center" background="../static/web/img/itemnote1.gif"><a href='javascript:ShowHideT("adset")'>高级参数</a></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" border="0" align="center" cellpadding="2" cellspacing="2" id="adset" style="border:1px solid #dee2e6;background:#ffffff">
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90" height="26">&nbsp;评论选项：</td>
              <td width="250">
                <label><input type="radio" name="notpost" class="np" value="0" <?php if($cfg_feedback_forbid=='N') echo "checked='1' "; ?>>&nbsp;允许评论&nbsp;</label>
                <label><input type="radio" name="notpost" class="np" value="1" <?php if($cfg_feedback_forbid=='Y') echo "checked='1' "; ?>>&nbsp;禁止评论&nbsp;</label>
              </td>
              <td width="90">发布选项：</td>
              <td width="380">
                <label><input name="ishtml" type="radio" class="np" value="1" checked="1">&nbsp;生成HTML&nbsp;</label>
                <label><input type="radio" name="ishtml" class="np" value="0">&nbsp;仅动态浏览</label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90" height="26">&nbsp;文章排序：</td>
              <td width="250">
                <select name="sortup" id="sortup" style="width:160px">
                  <option value="0" selected>默认排序</option>
                  <option value="7">置顶一周</option>
                  <option value="30">置顶一个月</option>
                  <option value="90">置顶三个月</option>
                  <option value="180">置顶半年</option>
                  <option value="360">置顶一年</option>
                </select> </td>
              <td width="90">标题颜色：</td>
              <td>
                <input name="color" type="text" id="color" style="width:120px">
                <button class="btn btn-success btn-sm" name="modcolor" type="button" id="modcolor" onClick="ShowColor(event, this)">选取</button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;阅读权限：</td>
              <td width="250">
                <select name="arcrank" id="arcrank" style="width:160px">
                <?php
                $urank = $cuserLogin->getUserRank();
                $dsql->SetQuery("Select * from `#@__arcrank` where adminrank<='$urank'");
                $dsql->Execute();
                while($row = $dsql->GetObject())
                {
                	echo "<option value='".$row->rank."'>".$row->membername."</option>";
                }
                ?>
                </select>
              </td>
              <td width="90">文件名称：</td>
              <td><input type="text" name="filename" id="filename" style="width:120px">（不包括后缀名如.html等）</td>
              <td>
                <?php
                if(isset($cfg_tamplate_rand) && $cfg_tamplate_rand==1)
                {
                ?>
                随机选择模板：
                <select name='templet' id='templet' style='width:120px'>
                <?php
                $rndsel = mt_rand(1, count($cfg_tamplate_arr)) - 1;
                foreach($cfg_tamplate_arr as $k=>$v)
                {
                  $v = trim($v);
                  echo ($k==$rndsel ? "<option value='$v' selected>$v</option>" : "<option value='$v'>$v</option>");
                }
                ?>
                </select>
                <?php
                } else {
                  echo "<input type='hidden' name='templet' value=''>";
                }
                ?>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td height="26" colspan="4" class="bline">
          <table width="800" border="0" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90">&nbsp;发布时间：</td>
              <td width="250">
                <?php
                $nowtime = GetDateTimeMk(time());
                echo "<input  type='text' name='pubdate' value='$nowtime'id='pubdate' class='datepicker' style='width:160px'>";
                ?>
              </td>
              <td width="90">浏览次数：</td>
              <td><input type="text" name="click" value="<?php echo ($cfg_arc_click=='-1' ? mt_rand(50, 200) : $cfg_arc_click); ?>" style="width:120px"></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" border="0" cellspacing="0" cellpadding="0" align="center" bgcolor="#f8f8f8" style="border:1px solid #dee2e6;border-top:0" class="mb-3">
      <tr height="36">
        <td align="center" class="py-3">
          <button type="submit" class="btn btn-success">保存</button>
          <button type="button" onClick="location.reload();" class="btn btn-success">重置</button>
        </td>
      </tr>
    </table>
  </form>
  <div id="__tmpbody" style="display:none"></div>
  <script>InitPage();</script>
</body>
</html>