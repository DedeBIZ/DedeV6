<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <title><?php echo Lang('spec_edit');?></title>
  <link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
  <link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
  <link rel="stylesheet" href="../static/web/css/admin.min.css">
  <link rel="stylesheet" href="../static/web/css/daterangepicker.css">
  <link rel="stylesheet" href="../static/web/css/jquery.fileupload.css">
  <link rel="stylesheet" href="../static/web/css/cropper.min.css">
  <script>const cfg_uplitpic_cut = '<?php echo $cfg_uplitpic_cut;?>';</script>
  <?php include_once(DEDEADMIN.'/templets/_widget_lang.htm');?>
  <script src="../static/web/js/jquery.min.js"></script>
  <script src="../static/web/js/webajax.js"></script>
  <script src="../static/web/js/moment.min.js"></script>
  <script src="../static/web/js/daterangepicker.js"></script>
  <script src="../static/web/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script src="../static/web/js/cropper.min.js"></script>
  <style>
  table{border-collapse:separate}
  </style>
  <script>
    function SelectTemplets(fname) {
      var pos = GetWinPos(800,600);
      window.open("./dialog/select_templets.php?f=" + fname, "poptempWin", "scrollbars=yes,resizable=yes,statebar=no,width=800,height=600,left=" + pos.left + ", top=" + pos.top);
    }
    function SelectArcList(fname) {
      var pos = GetWinPos(800,600);
      window.open("content_select_list.php?f=" + fname, "selArcList", "scrollbars=yes,resizable=yes,statebar=no,width=700,height=500,left=" + pos.left + ", top=" + pos.top);
    }
    function checkSubmit() {
      if (document.form1.title.value == "") {
        ShowMsg("<?php echo Lang('spec_err_title_isempty');?>");
        return false;
      }
      for (i = 1; i <= 6; i++) {
        $val = CheckVal(i);
        if ($val == false) {
          return false;
        }
      }
    }
    function CheckVal(id) {
      var notename = $DE('notename' + id);
      var arcid = $DE('arcid' + id);
      if (arcid.value != "") {
        if (notename.value == "") {
          $DE('notename' + id).focus();
          ShowMsg('[' + id + ']<?php echo Lang("spec_err_node_isempty");?>');
          return false;
        }
      }
    }
  </script>
</head>
<body>
  <form name="form1" action="spec_edit.php" enctype="multipart/form-data" method="post" onSubmit="return checkSubmit();">
    <input type="hidden" name="id" value="<?php echo $arcRow['id']?>">
    <input type="hidden" name="channelid" value="<?php echo $channelid?>">
    <input type="hidden" name="arcrank" value="<?php echo $arcRow['arcrank']?>">
    <input type="hidden" name="source" value="本站">
    <input type="hidden" name="dopost" value="save">
    <table width="98%" align="center" cellpadding="0" cellspacing="0" class="mt-3 mb-3">
      <tr>
        <td width="70%"><i class="fa fa-map-marker"></i> <a href="content_s_list.php"><?php echo Lang("spec_list");?></a><a href="catalog_do.php?cid=<?php echo $cid?>&channelid=<?php echo $channelid?>&dopost=listArchives"></a> &gt; <?php echo Lang('spec_edit');?></td>
        <td width="30%" align="right"><a href="makehtml_spec.php" class="btn btn-success btn-sm"><?php echo Lang("spec_makehtml");?></a></td>
      </tr>
    </table>
    <table width="98%" align="center" cellpadding="2" cellspacing="2" class="biz-border">
      <tr>
        <td class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('spec_title');?>：</td>
              <td width="400"><input type="text" name="title" id="title" value="<?php echo $arcRow['title'];?>" style="width:390px"></td>
              <td width="90"><?php echo Lang('content_short_title');?>：</td>
              <td><input type="text" name="shorttitle" id="shorttitle" value="<?php echo $arcRow['shorttitle'];?>" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"> <?php echo Lang('content_flags');?>：</td>
              <td>
                <?php
                $dsql->SetQuery("SELECT * FROM `#@__arcatt` ORDER BY sortid ASC");
                $dsql->Execute();
                while($trow = $dsql->GetObject())
                {
                  if ($trow->att=='j') continue;
                  if (preg_match("#".$trow->att."#", $arcRow['flag']))
                  echo "<label class='mr-1'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}' checked='checked'> {$trow->attname}[{$trow->att}]</label>";
                  else
                  echo "<label class='mr-1'><input type='checkbox' name='flags[]' id='flags{$trow->att}' value='{$trow->att}'> {$trow->attname}[{$trow->att}]</label>";
                }
                ?>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr id="pictable">
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90" height="90"> <?php echo Lang('litpic');?>：</td>
              <td>
                <input type="text" name="picname" id="picname" value="<?php echo $arcRow['litpic']?>" style="width:300px">
                <label><input type="checkbox" name="ddisremote" value='1'> <?php echo Lang('remote');?></label>
                <span class="btn btn-success btn-sm fileinput-button"><?php echo Lang('upload');?><input type="file" name="files[]" id="iptAddImages"></span>
                <button type="button" name="Submit" onClick="SelectImage('form1.picname','');" class="btn btn-success btn-sm"><?php echo Lang('select');?></button>
                <button type="button" id="btnClearAll" class="btn btn-success btn-sm delete"><?php echo Lang('clean_up');?></button>
              </td>
              <td align="center"><img id="litPic" src="<?php if ($arcRow['litpic']!='') echo $arcRow['litpic']; else echo '../static/web/img/thumbnail.jpg';?>" style="height:80px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('source');?>：</td>
              <td><input type="text" name="writer" id="writer" value="<?php echo $arcRow['writer']?>" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('content_sortup');?>：</td>
              <td width="260">
                <select name="sortup" id="sortup" style="width:160px">
                  <?php
                  $subday = SubDay($arcRow["sortrank"],$arcRow["senddate"]);
                  echo "<option value='0'>".Lang('default')."</option>";
                  if ($subday>0) echo "<option value='$subday' selected>".Lang('content_ontop_day',array('subday'=>$subday))."</option>";
                  ?>
                  <option value="7"><?php echo Lang('content_sortup_7');?></option>
                  <option value="30"><?php echo Lang('content_sortup_30');?></option>
                  <option value="90"><?php echo Lang('content_sortup_90');?></option>
                  <option value="180"><?php echo Lang('content_sortup_180');?></option>
                  <option value="360"><?php echo Lang('content_sortup_360');?></option>
                </select>
              </td>
              <td width="90"><?php echo Lang('content_title_color');?>：</td>
              <td>
                <input type="text" name="color" id="color" style="width:160px" value="<?php echo $arcRow['color']?>">
                <button type="button" name="modcolor" id="modcolor" value="" onClick="ShowColor(event,this)" class="btn btn-success btn-sm"><?php echo Lang('select');?></button>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('catalog_select');?>：</td>
              <td>
                <?php
              	$typeOptions = GetOptionList($arcRow["typeid"],$cUserLogin->getUserChannel(),0);
           	    echo "<select name='typeid' style='width:160px'>";
                if ($arcRow["typeid"]=="0") echo "<option value='0' selected='1'>".Lang('content_typeid')."</option>";
                echo $typeOptions;
                echo "</select>";
			          ?>
                <i class="btn btn-sm fa fa-search" onClick="ShowCatMap(event,this,0,'typeid')" title="<?php echo Lang('quick_selection');?>" style="cursor:pointer"></i>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('keywords');?>：</td>
              <td><label><input type="text" name="keywords" rows="3" id="keywords" value="<?php echo $arcRow['keywords']?>" style="width:360px"></label></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('description');?>：</td>
              <td><textarea name="description" id="textarea" style="width:360px;height:50px"><?php echo $arcRow['description']?></textarea></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td><?php PrintAutoFieldsEdit(stripslashes($cInfos['fieldset']),$addRow,'autofield');?></td>
      </tr>
      <tr>
        <td class="bline2"> <?php echo Lang('spec_node_list_tip');?></td>
      </tr>
      <tr>
        <td class="bline">
          <table width="100%" cellspacing="2" cellpadding="2">
            <?php
            $speclisttmp = GetSysTemplets("spec_arclist.htm");
            $i = 1;
            $dtp = new DedeBIZ\Template\DedeTagParse();
            $dtp->LoadSource($addRow["note"]);
            if (is_array($dtp->CTags)){
            foreach($dtp->CTags as $tagid=>$ctag)
            {
              if ($ctag->GetName()!="specnote") continue;
              $notename = $ctag->GetAtt('name');
              $col = $ctag->GetAtt('col');
              $idlist = $ctag->GetAtt('idlist');
              $imgwidth = $ctag->GetAtt('imgwidth');
              $imgheight = $ctag->GetAtt('imgheight');
              $titlelen = $ctag->GetAtt('titlelen');
              $infolen = $ctag->GetAtt('infolen');
              $temp = trim($ctag->GetInnerText());
              $noteid = $ctag->GetAtt('noteid');
              if (empty($noteid)) $noteid = $i;
              $isauto = $ctag->GetAtt('isauto');
              if (empty($isauto)) $isauto = 0;
              $keywords = $ctag->GetAtt('keywords');
              $typeid = $ctag->GetAtt('typeid');
              if (empty($typeid)) $typeid = 0;
              $rownum = $ctag->GetAtt('rownum');
              if (empty($rownum)) $rownum = 40;
            ?>
            <tr bgcolor="#f8fcf2">
              <td width="260"><?php echo Lang('node');?><?php echo $i?>：</td>
              <td colspan="2">
                <table width="900" cellspacing="0" cellpadding="0">
                  <tr>
                    <td width="310"><input type="text" name="notename<?php echo $i?>" id="notename<?php echo $i?>" style="width:300px" value="<?php echo $notename?>"></td>
                    <td width="90"><?php echo Lang('node_id');?>：</td>
                    <td><input type="text" name="noteid<?php echo $i?>" id="noteid<?php echo $i?>" value="<?php echo $noteid?>" style="width:160px"></td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('content_article_list');?>：</td>
              <td><textarea name="arcid<?php echo $i?>" rows="3" onblur="CheckVal(<?php echo $i ?>)" id="arcid<?php echo $i?>" style="width:90%"><?php echo $idlist?></textarea></td>
              <td><button type="button" class="btn btn-success btn-sm"  name="selarc<?php echo $i?>" id="selarc<?php echo $i?>2" onClick="SelectArcList('form1.arcid<?php echo $i?>');"><?php echo Lang('spec_select_node_content');?></button></td>
            </tr>
            <tr>
              <td><?php echo Lang('source');?>：</td>
              <td colspan="2">
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="0" <?php if ($isauto==0) echo "checked";?>> <?php echo Lang('spec_isauto_0');?></label>
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="1" <?php if ($isauto==1) echo "checked";?>> <?php echo Lang('spec_isauto_1');?></label>
                <label><?php echo Lang('keywords');?>：<input type="text" name="keywords<?php echo $i?>" value="<?php echo $keywords?>" id="keywords<?php echo $i?>" value="" size="16"><?php echo Lang('spec_keywords_tip');?></label>
                <label><?php echo Lang('typeid');?>：<input type="text" name="typeid<?php echo $i?>" value="<?php echo $typeid?>" id="typeid<?php echo $i?>" value="0" size="4"></label>
              </td>
            </tr>
            <tr>
              <td height="50" rowspan="2"><?php echo Lang('layout');?>：</td>
              <td colspan="2">
                <?php echo Lang('spec_node_layout_col');?>：<input type="text" name="col<?php echo $i?>" id="col<?php echo $i?>" value="<?php echo $col?>" size="3">
                <?php echo Lang('spec_node_layout_imgwidth');?>：<input type="text" name="imgwidth<?php echo $i?>" id="imgwidth<?php echo $i?>" value="<?php echo $imgwidth?>" size="3">
                <?php echo Lang('spec_node_layout_imgheight');?>：<input type="text" name="imgheight<?php echo $i?>" id="imgheight<?php echo $i?>" value="<?php echo $imgheight?>" size="3">
                <?php echo Lang('spec_node_layout_titlelen');?>：<input type="text" name="titlelen<?php echo $i?>" id="titlelen<?php echo $i?>" value="<?php echo $titlelen?>" size="3">
                <?php echo Lang('spec_node_layout_infolen');?>：<input type="text" name="infolen<?php echo $i?>" id="infolen<?php echo $i?>" value="<?php echo $infolen?>" size="3">
                <?php echo Lang('spec_node_layout_rownum');?>：<input type="text" name="rownum<?php echo $i?>" id="rownum<?php echo $i?>" value="<?php echo $rownum?>" size="3">
              </td>
            </tr>
            <tr>
              <td colspan="2"><?php echo Lang('spec_node_listtmp');?>：<br><textarea name="listtmp<?php echo $i?>" rows="3" id="listtmp<?php echo $i?>" style="width:60%"><?php echo $temp?></textarea></td>
            </tr>
            <?php
            $i++;
            }}
            $dtp->Clear();
            for($i;$i<=$cfg_specnote;$i++)
            {
            ?>
            <tr bgcolor="#f8fcf2">
              <td width="90"><?php echo Lang('node');?><?php echo $i?>：</td>
              <td colspan="2">
                <table width="900" cellspacing="0" cellpadding="0">
                  <tr>
                    <td width="310"><input type="text" name="notename<?php echo $i?>" id="notename<?php echo $i?>" style="width:300px"></td>
                    <td width="90"><?php echo Lang('node_id');?>：</td>
                    <td><input type="text" name="noteid<?php echo $i?>" id="noteid<?php echo $i?>" style="width:100px"></td>
                  </tr>
                </table>
              </td>
            </tr>
            <tr>
              <td><?php echo Lang('content_article_list');?>：</td>
              <td><textarea name="arcid<?php echo $i?>" rows="3" onblur="CheckVal(<?php echo $i ?>)" id="arcid<?php echo $i?>" style="width:90%"></textarea></td>
              <td><button name="selarc<?php echo $i?>" type="button" id="selarc<?php echo $i?>2" class="btn btn-success btn-sm" onClick="SelectArcList('form1.arcid<?php echo $i?>');"><?php echo Lang('spec_select_node_content');?></button></td>
            </tr>
            <tr>
              <td><?php echo Lang('source');?>：</td>
              <td colspan="2">
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="0" checked> <?php echo Lang('spec_isauto_0');?></label>
                <label><input type="radio" name="isauto<?php echo $i?>" id="isauto<?php echo $i?>" value="1"> <?php echo Lang('spec_isauto_1');?></label>
                <label><?php echo Lang('keywords');?>：<input type="text" name="keywords<?php echo $i?>" id="keywords<?php echo $i?>" value="" size="16"><?php echo Lang('spec_keywords_tip');?></label>
                <label><?php echo Lang('typeid');?>：<input type="text" name="typeid<?php echo $i?>" id="_typeid<?php echo $i?>" value="0" size="4"></label>
              </td>
            </tr>
            <tr>
              <td height="50" rowspan="2"><?php echo Lang('layout');?>：<br></td>
              <td colspan="2"><?php echo Lang('spec_node_layout_col');?>：<input type="text" name="col<?php echo $i?>" id="col<?php echo $i?>" value="1" size="3">
                <?php echo Lang('spec_node_layout_imgheight');?>：<input type="text" name="imgheight<?php echo $i?>" id="imgheight<?php echo $i?>" value="90" size="3">
                <?php echo Lang('spec_node_layout_imgwidth');?>：<input type="text" name="imgwidth<?php echo $i?>" id="imgwidth<?php echo $i?>" value="120" size="3">
                <?php echo Lang('spec_node_layout_titlelen');?>：<input type="text" name="titlelen<?php echo $i?>" id="titlelen<?php echo $i?>" value="60" size="3">
                <?php echo Lang('spec_node_layout_infolen');?>：<input type="text" name="infolen<?php echo $i?>" id="infolen<?php echo $i?>" value="160" size="3">
                <?php echo Lang('spec_node_layout_rownum');?>：<input type="text" name="rownum<?php echo $i?>" id="rownum<?php echo $i?>" value="40" size="3">
              </td>
            </tr>
            <tr>
              <td colspan="2"><?php echo Lang('spec_node_listtmp');?>：<br><textarea name="listtmp<?php echo $i?>" rows="3" id="listtmp<?php echo $i?>" style="width:60%"><?php echo $speclisttmp?></textarea></td>
            </tr>
            <?php }?>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"  width="260"> <?php echo Lang('comment_options');?>：</td>
              <td width="260">
                <label><input type="radio" name="notpost" value="0" <?php if ($arcRow['notpost']==0) echo 'checked="1"';?>> <?php echo Lang('enable');?></label>
                <label><input type="radio" name="notpost" value="1" <?php if ($arcRow['notpost']==1) echo 'checked="1"';?>> <?php echo Lang('disable');?></label>
              <td width="90"><?php echo Lang('publish_options');?>：</td>
              <td>
                <label><input type="radio" name="ishtml" value="1" <?php if ($arcRow["ismake"]!=-1) echo 'checked="1"';?>> <?php echo Lang('content_ishtml_1');?></label>
                <label><input type="radio" name="ishtml" value="0" <?php if ($arcRow["ismake"]==-1) echo 'checked="1"';?>> <?php echo Lang('content_ishtml_0');?></label>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('content_select_templet');?>：</td>
              <td width="260">
                <input type="text" name="templet" id="templet" value="<?php echo $addRow['templet']?>" style="width:160px">
                <button type="button" name="set3" class="btn btn-success btn-sm" onClick="SelectTemplets('form1.templet');"><?php echo Lang('browser');?></button>
              </td>
              <td width="90"><?php echo Lang('content_filename');?>：</td>
              <td><input type="text" name="filename" id="filename" value="<?php echo $arcRow['filename']?>" style="width:160px"><?php echo Lang('content_filename_tip');?></td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('content_pubdate');?>：</td>
              <td>
              <?php
			        $addtime = GetDateTimeMk($arcRow["senddate"]);
			        echo "$addtime".Lang('content_addtime_tip')." <input type='hidden' name='senddate' value='".$arcRow["senddate"]."' style='width:160px'>";
			        ?>
              </td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td colspan="4" class="bline">
          <table width="900" cellspacing="0" cellpadding="0">
            <tr>
              <td width="90"><?php echo Lang('content_pubdate');?>：</td>
              <td width="260">
              <?php
			        $nowtime = GetDateTimeMk($arcRow["pubdate"]);
			        echo "<input name='pubdate' value='$nowtime' type='text' id='pubdate' class='datepicker' style='width:160px'>";
		          ?>
              </td>
              <td width="90"><?php echo Lang('content_click');?>：</td>
              <td><input type="text" name="click" value="<?php echo $arcRow['click'];?>" style="width:160px"></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    <table width="98%" align="center" cellspacing="0" cellpadding="0" bgcolor="#f8f8f8" class="mb-3 biz-border border-top-0">
      <tr>
        <td align="center" class="py-2">
          <button type="submit" class="btn btn-success btn-sm"><?php echo Lang('save');?></button>
          <button type="button" onClick="location.reload();" class="btn btn-success btn-sm"><?php echo Lang('reset');?></button>
        </td>
      </tr>
    </table>
    <script>InitPage();</script>
  </form>
</body>
</html>