<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
		<title>安装DedeV<?php echo $cfg_version_detail;?></title>
		<link rel="stylesheet" href="../static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="../static/web/css/bootstrap.min.css">
		<link rel="shortcut icon" href="../static/web/img/favicon.ico">
		<script src="../static/web/js/jquery.min.js"></script>
		<script src="../static/web/js/bootstrap.min.js"></script>
		<script src="../static/web/js/style.js"></script>
		<style>body{line-height:1.6;letter-spacing:.6px;font-size:14px;font-family:Helvetica Neue,Helvetica,PingFang SC,Tahoma,Arial,sans-serif;color:#545b62;background:#f5f5f5}a{color:#545b62}a:hover{color:#ff8400;text-decoration:none}h2,legend{line-height:1.6;font-size:18px;font-weight:600;color:#393d49}label{margin-bottom:10px;line-height:18px}input,select,.btn{font-size:14px!important}.install-box{margin:0 auto;width:800px}.admin-head{padding:1rem 0;background:#fff}.admin-nav{height:36px;line-height:36px}.admin-nav-a{padding-right:30px}.dropdown-menu{min-width:8rem;font-size:14px}.dropdown-item{padding:0 1rem;height:36px;line-height:36px;font-size:14px;color:#545b62!important}.fa{font-size:14px!important;color:inherit;cursor:pointer}.logo,.form-control{height:36px}.form-control,.btn-md,.card,.alert,.rounded{border-radius:.5rem!important}.card-header:first-child{border-radius:.5rem .5rem 0 0}.input-group:not(.has-validation)>.custom-file:not(:last-child) .custom-file-label,.input-group:not(.has-validation)>.custom-file:not(:last-child) .custom-file-label::after,.input-group:not(.has-validation)>.custom-select:not(:last-child),.input-group:not(.has-validation)>.form-control:not(:last-child){border-top-right-radius:0!important;border-bottom-right-radius:0!important}.input-group>.input-group-append>.btn,.input-group>.input-group-append>.input-group-text,.input-group>.input-group-prepend:first-child>.btn:not(:first-child),.input-group>.input-group-prepend:first-child>.input-group-text:not(:first-child),.input-group>.input-group-prepend:not(:first-child)>.btn,.input-group>.input-group-prepend:not(:first-child)>.input-group-text{border-top-left-radius:0!important;border-bottom-left-radius:0!important}@media (max-width:760px){.install-box{width:100%}.admin-head{padding:1rem 15px}.admin-nav-a{display:none!important}}</style>
	</head>
	<body>
		<div class="d-flex flex-md-row align-items-center shadow-sm admin-head mb-3">
			<div class="container">
				<div class="row">
					<div class="col-6 col-md-4"><img src="../static/web/img/logo.png" title="<?php echo $cfg_soft_enname;?>" class="logo"></div>
					<div class="col-6 col-md-8 text-right d-flex justify-content-end admin-nav">
						<a href="https://www.dedebiz.com/help" target="_blank" class="admin-nav-a"><i class="fa fa-info-circle"></i> 帮助中心</a>
						<a href="https://www.dedebiz.com/service" target="_blank" class="admin-nav-a"><i class="fa fa-handshake-o"></i> 技术服务</a>
					</div>
				</div>
			</div>
		</div>
		<div class="container install-box">
			<div class="row">
				<div class="col-md-12">
					<?php if (count($arrMsg) > 0) {foreach($arrMsg as $msg){?>
					<div class="alert alert-warning"><?php echo $msg ?></div>
					<?php }}?>
					<div class="alert alert-warning">请先阅读<a href="https://www.dedebiz.com/license?from=install" target="_blank" class="text-primary">《站点授权协议》</a></div>
					<div class="card shadow-sm mb-3">
						<div class="card-header bg-success">
							<h2 class="text-center text-white my-0">安装DedeV<?php echo $cfg_version_detail;?></h2>
						</div>
						<div class="card-body">
							<form action="../install/index.php" method="post" name="form1">
								<input type="hidden" name="step" value="2">
								<input type="hidden" name="cookieencode" value="<?php echo $rnd_cookieEncode;?>">
								<input type="hidden" name="adminmail" value="admin@dedebiz.com">
								<legend class="text-success">数据库设置</legend>
								<hr>
								<div class="form-group">
									<label for="dbtype" class="form-label">数据库类型</label>
									<select id="dbtype" name="dbtype" class="form-control form-select">
										<option value="mysql" selected>MySQL</option>
										<?php if (extension_loaded("sqlite3")) {;?><option value="sqlite">SQLite</option><?php }?>
									</select>
									<div class="form-text">数据库类型一般为MySQL，则SQLite用于开发调试</div>
								</div>
								<div class="form-group server">
									<label for="dbhost" class="form-label">数据库地址</label>
									<input type="text" name="dbhost" id="dbhost" class="form-control" placeholder="localhost">
								</div>
								<div class="form-group server">
									<label for="dbuser" class="form-label">数据库用户名</label>
									<input type="text" name="dbuser" id="dbuser" class="form-control" placeholder="root">
								</div>
								<div class="form-group server">
									<label for="exampleInputPassword1" class="form-label">数据库密码</label>
									<input type="text" name="dbpwd" id="dbpwd" class="form-control" placeholder="请输入数据库密码">
								</div>
								<div class="form-group">
									<label for="dbprefix" class="form-label">数据表前缀</label>
									<input type="text" name="dbprefix" id="dbprefix" class="form-control" placeholder="biz_">
									<div class="form-text text-danger">注意DedeV<?php echo $cfg_version_detail;?>数据表前缀默认为biz_</div>
								</div>
								<div class="form-group">
									<label for="dbname" class="form-label">数据库名称</label>
									<div class="input-group">
										<input id="dbname" name="dbname" type="text" class="form-control" placeholder="DedeBIZ">
										<div class="input-group-append"><button type="button" id="btnCheckConnect" class="btn btn-success btn-md">检查</button></div>
									</div>
								</div>
								<div id="alertConnect"></div>
								<legend class="text-success">站点设置</legend>
								<hr>
								<div class="form-group">
									<label for="baseurl" class="form-label">网站网址</label>
									<input type="text" name="baseurl" id="baseurl" class="form-control" placeholder="<?php echo $baseurl;?>">
								</div>
								<div class="form-group">
									<label for="webname" class="form-label">网站名称</label>
									<input type="text" name="webname" id="webname" class="form-control" placeholder="我的网站">
								</div>
								<div class="form-group">
									<label for="adminuser" class="form-label">管理员账号</label>
									<input type="text" name="adminuser" id="adminuser" class="form-control" placeholder="admin">
									<div class="form-text">使用[0-9a-zA-Z_@!.-]范围以内字符</div>
								</div>
								<div class="form-group">
									<label for="adminpwd" class="form-label">管理员密码</label>
									<input type="text" name="adminpwd" id="adminpwd" class="form-control" placeholder="admin">
									<div class="form-text">使用[0-9a-zA-Z_@!.-]范围以内字符</div>
								</div>
								<div class="form-group">
									<label for="cmspath" class="form-label">安装目录</label>
									<input type="text" name="cmspath" id="cmspath" class="form-control" value="<?php echo $basepath;?>" placeholder="<?php echo $basepath;?>">
									<div class="form-text">在根目录安装不需要填写此项</div>
								</div>
								<div class="text-right"><button type="submit" class="btn btn-success btn-md">安装</button></div>
							</form>
						</div>
					</div>
					<p><a href="https://www.dedebiz.com" target="_blank">Powered by DedeBIZ开发团队</a></p>
				</div>
			</div>
		</div>
		<script>
			$("#btnCheckConnect").click(function() {
			    let dbhost = $('#dbhost').val();
			    let dbuser = $('#dbuser').val();
			    let dbpwd = $('#dbpwd').val();
			    if (!dbhost) dbhost = "localhost";
			    if (!dbuser) dbuser = "root";
			    $.get('index.php?step=10&dbhost=' + dbhost + '&dbuser=' + dbuser + '&dbpwd=' + dbpwd,
			    function(rs) {
			        let result = JSON.parse(rs);
			        if (result.code === 200) {
			            ShowAlert("#alertConnect", result.data, "success", 5000)
			        } else {
			            ShowAlert("#alertConnect", result.data, "danger", 5000)
			        }
			    })
			});
			$("#dbtype").change(function() {
			    if ($(this).val() === 'sqlite') {
			        $(".form-group.server").hide()
			    } else {
			        $(".form-group.server").show()
			    }
			});
		</script>
	</body>
</html>