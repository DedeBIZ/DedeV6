<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
		<title>{dede:field.title/}-{dede:global.cfg_webname/}</title>
		<meta name="keywords" content="{dede:field.keywords/}">
		<meta name="description" content="{dede:field.description function='html2text(@me)'/}">
		<script>const PHPURL = '{dede:field name="phpurl"/}';</script>
		<script src="{dede:global.cfg_cmsurl/}/static/web/js/jquery.min.js"></script>
		<script src="{dede:global.cfg_cmsurl/}/static/web/js/bootstrap.bundle.min.js"></script>
		<link rel="stylesheet" href="{dede:global.cfg_cmsurl/}/static/web/css/bootstrap.min.css">
		<link rel="stylesheet" href="{dede:global.cfg_cmsurl/}/static/web/font/css/font-awesome.min.css">
		<link rel="stylesheet" href="{dede:global.cfg_cmsurl/}/static/web/css/style.css">
		<link rel="shortcut icon" href="{dede:global.cfg_cmsurl/}/static/web/img/favicon.ico">
		<script>
			var shortname = "{dede:global.art_shortname/}";
			var npage = parseInt("{dede:field name = 'nowpage'/}");
			var totalpage = parseInt("{dede:field name = 'totalpage'/}");
			var namehand = "{dede:field name='namehand'/}";
			var displaytype = "{dede:field name='displaytype'/}";
			var gtimer = null;
			//大图
			function dPlayBig() {
				var imgObj = document.getElementById("bigimg");
				window.open(imgObj.src);
			}
			//停止幻灯
			function dStopPlay() {
				if (gtimer) clearTimeout(gtimer);
				else dPlayNext();
			}
			//开始幻灯
			function dStartPlay() {
				if (npage != totalpage) {
					gtimer = setTimeout("dPlayNext()", 10000);
				}
			}
			//上一张
			function dPlayPre() {
				if (npage < 2) {
					ShowMsg("这是第一页");
				} else {
					if (npage == 2) {
						if (namehand != '') location.href = namehand + shortname;
						else location.href = "view.php?aid={dede:field name='id'/}";
					} else if (displaytype == 'st' && namehand != '') {
						location.href = namehand + "_" + (npage - 1) + shortname;
					} else {
						location.href = "view.php?aid={dede:field name='id'/}&pageno=" + (npage - 1);
					}
				}
			}
			//下一张
			function dPlayNext() {
				if (npage == totalpage) {
					ShowMsg("没有了哦");
			} 	else {
					if (displaytype == 'st' && namehand != '') location.href = namehand + "_" + (npage + 1) + shortname;
					else location.href = "view.php?aid={dede:field name='id'/}&pageno=" + (npage + 1);
				}
			}
		</script>
	</head>
	<body>
		{dede:include filename='top.htm'/}
		{dede:include filename='head.htm'/}
		<div class="container py-3">
			<div class="row">
				<div class="col-md-12">
					<div class="position rounded">
						<nav aria-label="breadcrumb">
							<ol class="breadcrumb">
								<li class="breadcrumb-item">当前位置</li>
								{dede:field name='position'/}
							</ol>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<main class="container py-3">
			<div class="row">
				<div class="col-md-9 article-main">
					<h2>{dede:field.title/}</h2>
					<div class="article-meta">
						<span>时间：{dede:field.pubdate function="MyDate('Y-m-d',@me)"/}</span>
						<span>来源：{dede:field.source/}</span>
						<span>作者：{dede:field.writer/}</span>
						<span>点击：<i id="_count">...</i>次</span>
					</div>
					<div class="picbox py-3">
						{dede:field name='pagestyle' alt='根据不同的页面风格输出不同的头信息' runphp='yes'}
						if (@me==3) {
						@me = '<ul class="e8">';
							}
							else if (@me==2) {
							@me = "
							<div class='text-center mb-3'>
								<a href='javascript:dPlayBig();' class='btn btn-success'>原始图片</a>
								<a href='javascript:dPlayPre();' class='btn btn-success'>上一张</a>
								<a href='javascript:dPlayNext();' class='btn btn-success'>下一张</a>
								<a href='javascript:dStopPlay();' class='btn btn-success'>自动 / 暂停播放</a>
							</div>
							";
							} else {
							@me = '';
							}
							{/dede:field}
							<!-- 如果使用的是多页单图模式幻灯，把href里的链接改为 javascript:dPlayNext(); 表示点击看下一页 -->
							{dede:field name='imgurls' alt='图片输出区'}
								[field:pagestyle runphp='yes'] @me= (@me==3 ? '<li>' : '');[/field:pagestyle]
								<a href='[field:linkurl/]' [field:pagestyle runphp='yes' ] @me=(@me==3 ? 'class="pic"' : '' ); [/field:pagestyle]><img src='[field:imgsrc/]' id='bigimg' [field:imgwidth/] alt='[field:alttext/]'></a>
								<a href='[field:linkurl/]' [field:pagestyle runphp='yes' ]@me=(@me==3 ? 'class="title"' : '' );[/field:pagestyle]>[field:title/]</a>
								[field:pagestyle runphp='yes'] @me = (@me==3 ? '</li>' : ''); [/field:pagestyle]
							{/dede:field}
							{dede:field name='pagestyle' alt='根据不同的风格输出不同的结尾信息' runphp='yes'}
							if (@me==3) {
							@me = '
						</ul>';
						}
						else if (@me==2) {
						@me = "
						<script>
							dStartPlay();
						</script>";
						} else {
						@me = '';
						}
						{/dede:field}
					</div>
					<div class="py-3">{dede:field.body/}</div>
					<div class="py-3">作者：{dede:adminname/}</div>
					<div class="clearfix"></div>
					<div class="row">
						<div class="col-md-4 prenext">
							<div class="pagination-previous mb-3">{dede:prenext get='pre'/}</div>
							<div class="pagination-next">{dede:prenext get='next'/}</div>
						</div>
						<div class="col-md-8">
							<div class="row actbox">
								<ul>
									<li><i class="fa fa-star-o mr-2"></i><a href="{dede:field name='phpurl'/}/stow.php?aid={dede:field.id/}" target="_blank">收藏</a></li>
									<li><i class="fa fa-bug mr-2"></i><a href="javascript:ErrorAddSave({dede:field.id/}, '{dede:field.title/}');">挑错</a></li>
									<li><i class="fa fa-thumbs-o-up mr-2"></i><a href="{dede:field name='phpurl'/}/recommend.php?aid={dede:field.id/}" target="_blank">推荐</a></li>
									<li><i class="fa fa-print mr-2"></i><a href="javascript:;" onClick="window.print();">打印</a></li>
								</ul>
							</div>
						</div>
					</div>
					{dede:include comment='文档顶踩模块' filename='widget_article_digg.htm'/}
					{dede:include comment='文档评论模块' file='widget_article_feedback.htm'/}
				</div>
				<div class="col-md-3">
					<div class="pb-3">
	                    <form class="search" name="formsearch" action="{dede:global.cfg_cmsurl/}/apps/search.php">
	                        <input type="hidden" name="kwtype" value="0">
	                        <div class="input-group">
		                        <input name="q" type="text" class="form-control" placeholder="请输入...">
		                        <button type="submit" class="btn"><i class="fa fa-search"></i></button>
		                    </div>
	                    </form>
                    </div>
					{dede:include comment='推荐文档' filename='widget_recommend.htm'/}
					{dede:include comment='热点文档' filename='widget_hot.htm'/}
				</div>
			</div>
		</main>
		{dede:include filename='foot.htm'/}
		<script>
			//页面加载触发
			$(document).ready(function() {
				//获取文档点击数统计
				$.get("{dede:field name='phpurl'/}/count.php?format=json&view=yes&aid={dede:field.id/}&mid=1&cid={dede:field.channel/}",
					function(data) {
						let result = JSON.parse(data);
						$("#_count").html(result.data.click);
					})
			});
		</script>
	</body>
</html>